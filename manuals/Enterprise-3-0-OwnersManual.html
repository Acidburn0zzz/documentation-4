<html lang="en">
<head>
<title>CFEngine Enterprise 3.0 Owner's Manual</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="CFEngine Enterprise 3.0 Owner's Manual">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
@font-face {
    font-family: 'CFE_FONT';
    src: url('fonts/eot/opensans-regular-webfont.eot');
    src: local('â˜º'),  url('fonts/ttf/opensans-regular-webfont.ttf') format('truetype'), url('fonts/svg/opensans-regular-webfont.svg') format('svg');
    font-weight: normal;
    font-style: normal;
}    
pre {
    background-color: #EEFFDD;
    border: 1px solid #CCCCCC;
    font-family: courier;
    margin-bottom: 10px;
    margin-top: 10px;
    padding: 5px;
    font-size: 90%;
    }
pre.display { font-family:inherit }
pre.format  { font-family:inherit }
pre.smallexample
pre.smalllisp,
pre.smallformat,
pre.smalldisplay {
  font-size: 90%;
} 

span.sc    { font-variant:small-caps }
span.roman { font-family:serif; font-weight:normal; } 
span.sansserif { font-family:sans-serif; font-weight:normal; } 

body {
    font:  90%  'CFE_FONT', arial, Helvetica,sans-serif; 
    color: #646464;
    padding: 10px 20px;
    width: 960px;
    margin: 0 auto;
}
.node
{
    text-align: right;
    padding: 2px;
    font-size: smaller;
}
.node hr {
    border: 0;
    width: 100%;
    color: #CCC;
    background-color: #CCC;
    height: 5px;
}
.section {
    padding-right: 0px;
    padding-bottom: 0px;
    padding-left: 0px;
}

h1 {
    font-size: 26px;
    font-weight: normal;
    line-height: 32px;
    margin: 32px 0 16px;
    text-align: left;
    text-transform: uppercase;
}

h2 {
    color: #9E9981 !important;
    font-size: 16px;
    line-height: 18px;
    font-weight: normal;
    margin: 16px 0 26px;
    text-align: left;
}
h3 {
    margin-top: 3px;
    margin-right: 0px;
    margin-bottom: 10px;
    margin-left: 0px;
    line-height: 20px;
    font-size: 16px;
    font-weight: normal;
}

.contents
{
    background-color: #CCC;
    padding-top: 2px;
    padding-right: 2px;
    padding-bottom: 2px;
    padding-left: 10px;
}

.index-cp
{  
background: #fff url(index-cp.png) right repeat-y;
}

.index-vr
{  
background: #fff url(index-vr.png) right repeat-y;
}

.index-mb
{  
background: #eee url(index-faq.png) right repeat-y;
}

table.border
{
	border-color: #666;
	border-width: 0px;
}

FONT.liten {font-size: 80%; }
 
.tynn {
    font-family: Arial, Helvetica, sans-serif;
    font-size: smaller;
    font-style: normal;
    font-weight: lighter;
    margin-bottom: 0em;
    font-size: 11pt;
}
.verbatim {
    color: #000;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 20px;
    margin-left: 0px;
}
.example {
    color: #000;
    width: 100%;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 20px;
    margin-left: 0px;
}
.smallexample {
    color: #000;
    padding-top: 10px;
    padding-right: 30px;
    padding-bottom: 5px;
    padding-left: 30px;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 0px;
    margin-left: 0px;
}
.cartouche {
    padding: 5px;
    font-style: italic;
    font-size: 85%;
}

table.cartouche {
    border: none !important;
}

 .cartouche td  {
    background: none !important;
    border: none !important;
    padding: 5px; 

/*    background-color: #ddd;
    border: 1px solid #ccc;
    padding: 5px;*/
}

A:link { color: #2c2e70 }
A:visited { color: black }
A:active { color: #600041 }
dt em {font-weight: bold}
/* don't change this rule */    
pre.sp {
    background: none !important;   
    border:none !important
}
/* --- */
/*code hightlight*/
.red { color: #b80047; font-weight: bold; }

.blue { color: blue;  /*font-weight: bold;*/ }

.green { color: darkgreen; }

.comment { font-style: italic; }
--></style>
</head>
<body>
<h1 class="settitle">CFEngine Enterprise 3.0 Owner's Manual</h1>
Updated 15. February 2013
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Introduction">Introduction</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#dir">(dir)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">CFEngine Enterprise 3.0 Owner's Manual</h2>

   <p><a href="#Contents"><h1>COMPLETE TABLE OF CONTENTS</h1></a>
<h2>Summary of contents</h2>

<ul class="menu">
<li><a accesskey="1" href="#Introduction">Introduction</a>
<li><a accesskey="2" href="#Requirements">Requirements</a>
<li><a accesskey="3" href="#Installing-CFEngine-Enterprise">Installing CFEngine Enterprise</a>
<li><a accesskey="4" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>
<!-- * Quickstart - CFEngine Policies:: -->
<li><a accesskey="5" href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>
<li><a accesskey="6" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>:     <!-- * Mission Portal:: -->
<li><a accesskey="7" href="#Windows_002dspecific-features-in-CFEngine-Enterprise">Windows-specific features in CFEngine Enterprise</a>
<li><a accesskey="8" href="#REST-API">REST API</a>
<li><a accesskey="9" href="#Call_002dCollect">Call-Collect</a>
<li><a href="#Monitoring-extensions">Monitoring extensions</a>
<li><a href="#File-Access-Control-Lists">File Access Control Lists</a>
<li><a href="#Server-extensions">Server extensions</a>:            <!-- * Environments and workflows:: -->
<li><a href="#Upgrading-CFEngine-Enterprise">Upgrading CFEngine Enterprise</a>
<li><a href="#Frequently-Asked-Questions">Frequently Asked Questions</a>
<li><a href="#Troubleshooting">Troubleshooting</a>
<li><a href="#Configuration-of-external-authentication">Configuration of external authentication</a>
<li><a href="#SQLite-Database-Schema">SQLite Database Schema</a>
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Introduction"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Requirements">Requirements</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">1 Introduction</h2>

<p>Welcome to CFEngine Enterprise 3.0, the next generation of enterprise configuration management software! This document will take you through the necessary steps to get CFEngine Enterprise 3.0 up and running and show additional features of CFEngine Enterprise compared to CFEngine Community. The following links will take you to commonly used sections, see above for a complete table of contents:

     <ul>
<li><a href="#Requirements">Requirements</a>
<li><a href="#Installing-CFEngine-Enterprise">Installing CFEngine Enterprise</a>
<li><a href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>
<!-- @item @ref{Quickstart - CFEngine Policies} -->
<li><a href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>
<li><a href="#Virtualization-and-Cloud">Virtualization and Cloud</a>
<!-- Compliance -->
<li><a href="#Windows_002dspecific-features-in-CFEngine-Enterprise">Windows-specific features in CFEngine Enterprise</a>
<li><a href="#REST-API">REST API</a>
<li><a href="#Upgrading-CFEngine-Enterprise">Upgrading CFEngine Enterprise</a>
</ul>

   <p>We have made big changes to the Mission Portal to accommodate the needs of infrastructure engineers and IT managers alike. The front page consists of a list of applications, or apps, that give insight into different aspects of your infrastructure. Focus on a more intuitive UI with enhanced help functions has made the Mission Portal both easier and more powerful to use.

   <p>CFEngine 3 Free Enterprise is our commercial enterprise product offered for free for up to 25 managed hosts. It differs from our commercial offer in that it has different licensing terms, different support and it is limited to a maximum of 25 hosts. This product is described in full detail at <a href="http://cfengine.com/enterprise-download">http://cfengine.com/enterprise-download</a>. Please note that CFEngine Enterprise should not be installed as an upgrade to CFEngine Community. In that case uninstall CEngine Community, do a clean install of CFEngine Enterprise and then move your existing policies to the new Enterprise hub. See the <a href="http://cfengine.com/enterprise/faq">Enterprise FAQ</a> for more information.

<ul class="menu">
<li><a accesskey="1" href="#About-CFEngine-Enterprise">About CFEngine Enterprise</a>
</ul>

<!--  -->
<div class="node">
<a name="About-CFEngine-Enterprise"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Introduction">Introduction</a>

</div>

<h3 class="section">1.1 About CFEngine Enterprise</h3>

<p>CFEngine Enterprise is a commercially licensed version of the core CFEngine
software<a rel="footnote" href="#fn-1" name="fnd-1"><sup>1</sup></a> with enterprise library extensions. All of
the documentation for CFEngine 3 applies to CFEngine Enterprise.

   <p>The aim of CFEngine Enterprise is to offer a knowledge-enhanced framework for configuration management that goes beyond mere technical configuration to support the needs of businesses. Features include compliance management, reporting and business integration, and tools for handling necessary complexity. CFEngine Enterprise has features to support Cloud Computing for public and private clouds, as well as greater integration facilities with database resources.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Installing-CFEngine-Enterprise">Installing CFEngine Enterprise</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Introduction">Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">2 Requirements</h2>

<ul class="menu">
<li><a accesskey="1" href="#Hardware-requirements">Hardware requirements</a>
<li><a accesskey="2" href="#Operating-system-support">Operating system support</a>
</ul>

<div class="node">
<a name="Hardware-requirements"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Operating-system-support">Operating system support</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Requirements">Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Requirements">Requirements</a>

</div>

<h3 class="section">2.1 Hardware requirements</h3>

<p>The default CFEngine Enterprise architecture uses a single hub, or policy server, to publish changes of policy
and to aggregate knowledge about the environment, but you can set up as many as you like to manage
different parts of your organization independently. The CFEngine technology is not centralized by
nature. Most users choose to centralize updating of policy and report aggregation for convenience
however.

   <p>The default architecture and configuration skeleton of CFEngine Enterprise is expected to scale to a few thousand hosts with a dedicated policy hub. For the hub (policy server) we recommend that you have at least 2 GB of memory and a modern 64 bit cpu. For a large number of clients we recommend, as a rule of thumb, to have 8 GB of memory available per 500 hosts bootstrapped to the hub. Please contact your sales representative if you have any questions regarding these numbers.

   <p>For machines under CFEngine's management (clients), a full installation of CFEngine Enterprise requires about 25 MB of disk storage. Otherwise disk usage depends on your specific policies, especially those that concern reporting. Each software component (agent) typically uses under 10 MB of memory, but spikes in memory usage can occur if several agents run simultaneously. CFEngine recommends to have at least 256 MB available memory on the clients.

<!--  -->
<div class="node">
<a name="Operating-system-support"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Hardware-requirements">Hardware requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Requirements">Requirements</a>

</div>

<h3 class="section">2.2 Operating system support</h3>

<p>CFEngine can be made to run on most operating systems. For efficiency
CFEngine only supports packages for a number of recent popular operating systems,
which should be up to date with patches. If we don't have packages for
your particular operating systems we can usually make packages by
special arrangement, please contact your sales representative.

   <p>CFEngine 3 Free Enterprise is only available for Linux Operating Systems (both hub and client). Commercial CFEngine Enterprise customers have access to all the Operating Systems listed in <samp><span class="file">&lt;VERSION-NUMBER&gt;-Release_Notes_CFEngine_3_Enterprise.txt</span></samp> (found in the software download directory on <a href="cfengine.com">cfengine.com</a>).

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
See <samp><span class="file">&lt;VERSION-NUMBER&gt;-Release_Notes_CFEngine_3_Enterprise.txt</span></samp> (found in the software download directory on <a href="cfengine.com">cfengine.com</a>) for details on supported architectures. 
</td></tr></table>

   <p>The hub (policy server) is only available for derivatives of the
top GNU/Linux distributions (Debian, Red Hat, SuSE, Ubuntu), as these make available
software that the hub relies on for data storage and processing.

   <p>CFEngine Enterprise provides a version of CFEngine running natively on Windows, with support for registry management, Windows services and file security, See <a href="#Windows_002dspecific-features-in-CFEngine-Enterprise">Windows-specific features in CFEngine Enterprise</a>. Support for Solaris zones has been added through automated zone detection and process model adaptation.

   <p>A working package manager is required on the hub/policy server to install an Apache Web Server, php module, MongoDB, etc. You should start from a blank system (i.e. with none of these components installed) to avoid potential interference with the installation process. No special software is otherwise required on machines in your network, CFEngine bundles all critical dependencies in the CFEngine Enterprise package.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Installing-CFEngine-Enterprise"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Requirements">Requirements</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">3 Installing CFEngine Enterprise</h2>

<ul class="menu">
<li><a accesskey="1" href="#Installation-procedure">Installation procedure</a>
<li><a accesskey="2" href="#How-to-assess-success-of-this-procedure">How to assess success of this procedure</a>
</ul>

<div class="node">
<a name="Installation-procedure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#How-to-assess-success-of-this-procedure">How to assess success of this procedure</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-CFEngine-Enterprise">Installing CFEngine Enterprise</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-Enterprise">Installing CFEngine Enterprise</a>

</div>

<h3 class="section">3.1 Installation procedure</h3>

<p>CFEngine Enterprise is designed to be simple to install in its default configuration. The installation
process has two phases (or three phases for commercial customers who need to obtain a license):

     <ul>
<li>Unpack the software
<li>For commercial customers (skip for CFEngine 3 Free Enterprise): Obtain a license
<li>Bootstrap the agents to a hub (the hub serves as a policy server and report collector)
</ul>

   <p>The following procedure counts for a fresh install, please see <a href="#Upgrading-CFEngine-Enterprise">Upgrading CFEngine Enterprise</a> for how to upgrade from earlier versions of CFEngine.

   <p>You should start from a blank system (see also <a href="#Hardware-requirements">Hardware requirements</a>). If you have been using CFEngine Community Edition and you have
already developed a policy, set aside this policy during the installation process. You will be able
to integrate it back later.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
CFEngine Enterprise 3.0 is provided in three packages (two hub packages and one client package), please make sure to install them on the corresponding machines (e.g. one machine intended to serve as hub (policy server) and other machines intended to serve as clients). 
</td></tr></table>

<p class="noindent">These are the three packages (inside the respective hub and client directories found under each platform in the software download directory):
     <ul>
<li><samp><span class="file">hub/cfengine-nova-3.0.xxx.[rpm|deb]</span></samp>
<li><samp><span class="file">hub/cfengine-nova-expansion-3.0.xxx.[rpm|deb]</span></samp>
<li><samp><span class="file">client/cfengine-nova-3.0.xxx.[rpm|deb]</span></samp>
</ul>

   <p>The difference between the hub and client <samp><span class="file">cfengine-nova-3.0.xxx</span></samp> packages is that the agent binaries for the hub are linked to the MongoDB library while the binary for clients are not. Installing a client package on the hub will result in a database connection error, the Mission Portal will not be available and reports will not be collected. Installing the hub package on clients will result in error reports stating that the agent failed to connect to MongoDB (because it is not existent in client packages; danger of filling up error logs), but otherwise functionality will be assured. Please take care to install the correct packages on the corresponding nodes.

   <p>References to package managers assume that additional packages might need to be installed on the hub (policy server). Root privilege is required for the installation.

     <ol type=1 start=1>
<li>Verify that the machine's network connection is working and that port 5308 (used by CFEngine) and port 80 (used for the Mission Portal) is open for both incoming and outgoing connections. 
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
A common problem is that iptables are active by default on some operating systems. Remember to stop this service or adapt it to allow for communication on the above ports. If applicable:
<pre class="verbatim">      $ /etc/init.d/iptables stop
      $ chkconfig iptables off
</pre>
</td></tr></table>

     <p>On the hub, verify that package managers <code>yum</code>,
<code>zypper</code> or <code>apt-get</code> are working. They will be used to
install a web server, database and php server. If you are not able to set up a package manager and
repository on the hub, please see <a href="#How-do-I-install-the-prerequisites-for-the-hub-manually_003f">How do I install the prerequisites for the hub manually?</a>

     <li>Copy the CFEngine Enterprise packages to the system. On the hub (policy server):
     <pre class="example">          cfengine-nova-3.0.<var>xxx.[rpm|deb]</var> (NOTE: use hub package)
          cfengine-nova-expansion-3.0.<var>xxx.[rpm|deb]</var>
</pre>
     <p class="noindent">On all other machines:
     <pre class="example">          cfengine-nova-3.0.<var>xxx.[rpm|deb]</var> (NOTE: use client package)
</pre>
     <li>Unpack the software:
          <dl>
<dt><i>Red Hat family</i><dd>
          <pre class="example">               host# rpm -ihv <var>packages</var>
</pre>
          <br><dt><i>SUSE family</i><dd>
          <pre class="example">               host# rpm -ihv <var>packages</var>
</pre>
          <br><dt><i>Debian family</i><dd>
          <pre class="example">               host# dpkg --install  <var>packages</var>
</pre>
          </dl>

     <li>Skip this step for installation of CFEngine 3 Free Enterprise. On the hub, a public key has now been created in <samp><span class="file">/var/cfengine/ppkeys/localhost.pub</span></samp> as part of the
package installation. Commercial customers should send this public key to CFEngine Support<a rel="footnote" href="#fn-2" name="fnd-2"><sup>2</sup></a> as an attachment in the ticket system,
to obtain a license file <samp><span class="file">license.dat</span></samp>.

     <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Save the returned license file to <samp><span class="file">/var/cfengine/masterfiles/license.dat</span></samp>
on the hub before continuing. 
</td></tr></table>

     <li>The remaining steps apply to all hosts, but you should <b>install the hub (policy server) first</b>. For large systems (&gt; 1000 hosts) we recommend increasing the memory limit in php.ini on the hub (for instance to 128 MB).

     <p>Find the hostname or IP address of the hub (policy server), here we assume &lsquo;<samp><span class="samp">123.456.789.123</span></samp>&rsquo; is the address. 
<pre class="verbatim">      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.123
</pre>
Use the same command on all hosts, i.e. <b>do not bootstrap the policy server with a localhost address</b>. 
If you mistype the address of the hub, we recommend doing the following steps to re-boostrap. 
<pre class="verbatim">      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.124
      hub # killall cf-execd cf-serverd cf-monitord cf-hub
      hub # rm -rf /var/cfengine/inputs/*
      hub # rm -f /var/cfengine/policy_server.dat
      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.123
</pre>

     <p>CFEngine will output diagnostic information upon bootstrap (written to command line and syslog; cf-agent will also return a value: ERROR: 1, SUCCESS: 0). Error messages will be displayed if bootstrapping failed, pursue these to get an indication of what went wrong and correct accordingly. If all is well you should see the following in the output:

     <pre class="verbatim">     
     -> Bootstrap to 123.456.789.123 completed successfully
     
</pre>

     <p class="noindent">See Troubleshooting - <a href="#Problems-bootstrapping">Problems bootstrapping</a> if you have issues with this step.

     <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Commercial customers: Did you bootstrap before obtaining a license? See <a href="#I-did-bootstrap-the-hub-before-obtaining-a-license-file-_002d-what-should-I-do_003f">I did bootstrap the hub before obtaining a license file - what should I do?</a>
</td></tr></table>

     <li>CFEngine should now be up and running on your system. The Mission Portal will not be immediately accessible, you should wait approximately 15 minutes for the system to converge before attempting to connect to the hub IP-address through your web browser (the convergence process can take up to 30 minutes). CFEngine will copy its default policy files into <samp><span class="file">/var/cfengine/masterfiles/</span></samp> on the hub (policy server) provided that the directory is empty (fresh install). When the clients are bootstrapped, they will contact the hub and copy them to their <samp><span class="file">/var/cfengine/inputs/</span></samp> directory.

     <li>To complete licensing setup, you should make a promise to accept the license
terms by editing <samp><span class="file">/var/cfengine/masterfiles/promises.cf</span></samp> and <br> <samp><span class="file">/var/cfengine/masterfiles/failsafe/failsafe.cf</span></samp>
on the hub (policy server), changing the line &lsquo;<samp><span class="samp">host_licenses_paid =&gt; "&lt;NUMBER&gt;";</span></samp>&rsquo;
in &lsquo;<samp><span class="samp">body common control</span></samp>&rsquo; to reflect the correct number of licenses that you have subscribed to. For Free Enterprise &lt;NUMBER&gt; should be 25 (the maximum number of clients that can be bootstrapped without obtaining a license).

        </ol>

<!--  -->
<div class="node">
<a name="How-to-assess-success-of-this-procedure"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installation-procedure">Installation procedure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Installing-CFEngine-Enterprise">Installing CFEngine Enterprise</a>

</div>

<h3 class="section">3.2 How to assess success of this procedure</h3>

     <ol type=1 start=1>
<li>Look at the process list on the systems with &lsquo;<samp><span class="samp">ps waux | grep cf-</span></samp>&rsquo;. 
You should be able to see <code>cf-execd</code> running, and eventually other processes from
the CFEngine suite like <code>cf-monitord</code> <code>cf-serverd</code>. On the hub, you should
also eventually see <code>cf-hub</code>. Note that it may take 5&ndash;10 minutes before all the
processes get started.

     <li>Look for files in <samp><span class="file">/var/cfengine/inputs</span></samp> (Unix)
or <samp><span class="file">C:\Program Files\Cfengine\inputs</span></samp> (Windows). If you are a commercial customer (not using the Free Enterprise edition) the license file will be copied out from the policy server to the clients as part
of the normal distribution of policy. Each machine should get a
copy of the <samp><span class="file">license.dat</span></samp> file in <samp><span class="file">/var/cfengine/inputs</span></samp>
(Unix) or <samp><span class="file">C:\Program Files\Cfengine\inputs</span></samp> (Windows).

     <li>On the hub, the file <samp><span class="file">/var/cfengine/promise_knowledge.cf</span></samp> should have been
created, and should contain data.

     <li>Finally, after 10&ndash;15 minutes<a rel="footnote" href="#fn-3" name="fnd-3"><sup>3</sup></a>, try to connect to the hub (policy server) with your web browser (from the installation example: http://123.456.789.123, replace with your real IP address). You should see a login page like the one shown in the figure below:

     <pre class="sp">
     
     </pre>
     <div align="center"><img src="img-login-3-0.png" alt="Mission Portal login"></div>
     <div align="center">Figure: Mission Portal login screen</div>
     <pre class="sp">
     
     </pre>
     </ol>

   <p>Please see <a href="#Frequently-Asked-Questions">Frequently Asked Questions</a> or <a href="#Troubleshooting">Troubleshooting</a> if you have any problems.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<!-- @node Quickstart - The Mission Portal, Quickstart - CFEngine Policies, Installing CFEngine Enterprise, Top -->
<div class="node">
<a name="Quickstart---The-Mission-Portal"></a>
<a name="Quickstart-_002d-The-Mission-Portal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Installing-CFEngine-Enterprise">Installing CFEngine Enterprise</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">4 Quickstart - The Mission Portal</h2>

<ul class="menu">
<li><a accesskey="1" href="#Hosts-App">Hosts App</a>
<li><a accesskey="2" href="#SQL-Reports-App">SQL Reports App</a>
<li><a accesskey="3" href="#Docs-App">Docs App</a>
<!-- * Services App:: -->
<li><a accesskey="4" href="#Policies-App">Policies App</a>
<li><a accesskey="5" href="#Knowledge-App">Knowledge App</a>
<!-- * Goals App:: -->
<!-- * Compliance App:: -->
<li><a accesskey="6" href="#User-Management">User Management</a>
<li><a accesskey="7" href="#Settings">Settings</a>
</ul>

<p>The Mission Portal is the centerpiece
of user interaction with CFEngine Enterprise. It can be accessed by connecting to the hub (policy server) with your web browser (from the installation example: http://123.456.789.123, replace with your real IP address). You should see a login page, the default user name and password is <i>admin</i> and <i>admin</i>. <a rel="footnote" href="#fn-4" name="fnd-4"><sup>4</sup></a> Once you have logged in you will see the Mission Portal home page:

   <div class="block-image"><img src="img-mission-portal-3-0.png" alt="Mission Portal"></div>
<div align="center">Figure: The Mission Portal</div>

<p class="noindent">By default there are only three applications, or apps, shown on the home page (the above image also shows the <i>Policy</i> and <i>Knowledge</i> apps, these can be made visible by enabling them in <a href="#Settings">Settings</a>). Each app offers insight into different aspects of operations:

     <ul>
<li>Hosts - A place to see the current state of system repair <!-- (@ref{Hosts App}) -->
<li>SQL Reports - Create reports based on a simple customizable SQL interface <!-- (@ref{SQL Reports App}) -->
<li>Docs - Access to both offline and online CFEngine documentation <!-- (@ref{Docs App}) -->
<!-- @item Services - Browse current host capacity providing services in your environment -->
<li>Policies - Show the promises that the system is currently trying to keep
<li>Knowledge - A knowledge bank that connects information together
<!-- @item Goals - Connect promises to high level organizational goals and key performance indicators -->
<!-- @item Compliance - Overview of the current state and history of compliance across your system, through the lens of different compliance standards -->
</ul>

   <p>In addition all Mission Portal apps have a top menu containing at least the <i>App Selector</i> on the left and the <i>Settings Menu</i> on the right:

   <pre class="sp">

</pre>
<div align="center"><img src="img-top-menu-3-0.png" alt="Top Menu"></div>
<div align="center">Figure: Top Menu</div>
   <pre class="sp">

</pre>
     <ul>
<li>App Selector - A shortcut to other available apps in the Mission Portal (no need to pass through the Mission Portal home page)
<li>Settings Menu - Log out, access to Mission Portal settings, user management and roles (see separate sections)
</ul>

   <p>The apps labeled beta are under development and may not have a complete functionality set. We still choose to include them in the product to show the potential of CFEngine Enterprise and get feedback from our customers. A Mission Portal administrator can configure which apps will be available to other users through <a href="#Settings">Settings</a>.

   <p>If you go on directly to explore the different apps, please note that some of the displays in the Mission Portal may be blank when you log in just after installation. It may take some time for the system to fully converge, do not get troubled if initially there are some promises repaired or not kept (yellow and red colors).

   <p>The following will take you through the different Mission Portal apps and settings.

<!--  -->
<!-- @node  Mission Portal Apps, Finders, Mission Portal, Mission Portal -->
<!-- @section Mission Portal Apps -->
<!--  -->
<div class="node">
<a name="Hosts-App"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SQL-Reports-App">SQL Reports App</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>

</div>

<h3 class="section">4.1 Hosts App</h3>

<ul class="menu">
<li><a accesskey="1" href="#Policy-Context-Selector">Policy Context Selector</a>
<li><a accesskey="2" href="#Navigation-Tree">Navigation Tree</a>
<li><a accesskey="3" href="#Status-tab">Status tab</a>
<li><a accesskey="4" href="#Reports-tab">Reports tab</a>
<li><a accesskey="5" href="#Events-tab">Events tab</a>
<li><a accesskey="6" href="#Vitals-tab">Vitals tab</a>
<li><a accesskey="7" href="#Host-Info-tab">Host Info tab</a>
</ul>

<p>The Hosts App illustrates the state of the system in relation to the desired state at different scales. Zoom in to specific areas and examine the impact of promises, query data, extract reports and examine compliance relative to the policy/promises you have made. Speak authoritatively on resources and avoid the cost of maintaining disconnected monitoring/reporting.

   <pre class="sp">

</pre>
<img src="img-hosts-app-3-0.png" alt="Hosts App">
<div align="center">Figure: Hosts App</div>
<pre class="sp">

</pre>

The app has three main areas of user interaction:

     <ul>
<li>Policy Context Selector: In addition to the <i>App Selector</i> and <i>Settings Menu</i>, the top menu contains the <i>Policy Context Selector</i>. Use this to choose between three different policy contexts and see information for <i>{All}</i>, <i>{User}</i> or <i>{System}</i> (internal CFEngine) promises (<a href="#Policy-Context-Selector">Policy Context Selector</a>)
     <pre class="sp">
     
     </pre>
     <div align="center"><img src="img-policy-context-selector-3-0.png" alt="Policy Context Selector"></div>
     <div align="center">Figure: Policy Context Selector</div>
     <pre class="sp">
     
     </pre>
     
<li>Navigation Tree: Hosts can be grouped and organized in a hierarchy defined by classes (<a href="#Navigation-Tree">Navigation Tree</a>)
     <pre class="sp">
     
     </pre>
     <div align="center"><img src="img-navigation-tree-3-0.png" alt="Navigation Tree"></div>
     <div align="center">Figure: Navigation Tree</div>
     <pre class="sp">
     
     </pre>
     
<li>Content Area: Context sensitive area (affected by the selection made in the <i>Policy Context Selector</i> and <i>Navigation Tree</i>). The header/title shows the selected context from the navigation tree and underneath you will find five different content tabs:
          <ul>
<li>Status: Overview of host compliance and operational status (<a href="#Status-tab">Status tab</a>)
<li>Reports: Access to default reports (<a href="#Reports-tab">Reports tab</a>)
<li>Events: Track events based on (patterns in) promise handles (<a href="#Events-tab">Events tab</a>)
<li>Vitals: Monitor host parameters (<a href="#Vitals-tab">Vitals tab</a>)
<li>Host Info: Detailed information about each host (inventory) (<a href="#Host-Info-tab">Host Info tab</a>)
</ul>
     </ul>

<p class="noindent">In general we use colors to show the status of host compliance and operational status:
     <ul>
<li>Red: If less than 80% of promises were kept
<li>Yellow: If 20% or more of promises were repaired and host is now compliant
<li>Green: If more than 80% of promises were kept
<li>Blue: If there has not been any contact between the hub and the client within a set time interval (host unreachable; default value is set to 15 minutes, see <a href="#Mission-Portal-Settings">Mission Portal Settings</a>). 
<li>Black: If <code>cf-agent</code> has not executed policy normally for the last three runs. This could be due to CFEngine's scheduling daemon, <code>cf-execd</code>, not running or an error in policy which aborts execution. The hub will still able to contact the client to collect reports but the client will return stale data since it has not completed runs at regular intervals. 
</ul>

<!--  -->
<div class="node">
<a name="Policy-Context-Selector"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Navigation-Tree">Navigation Tree</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Hosts-App">Hosts App</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Hosts-App">Hosts App</a>

</div>

<h4 class="subsection">4.1.1 Policy Context Selector</h4>

<p>The <i>Policy Context Selector</i> affects all content related to host and promise status in the <i>Hosts App</i>. There are three alternatives:

   <pre class="sp">

</pre>
<div align="center"><img src="img-policy-context-selector-3-0.png" alt="Policy Context Selector"></div>
<div align="center">Figure: Policy Context Selector</div>
   <pre class="sp">

</pre>
     <ul>
<li>All: Navigation Tree, graphs, reports and events will contain data from all promises in you policy. 
<li>User: Navigation Tree, graphs, reports and events will contain data from promises that users have added. 
<li>System: Navigation Tree, graphs, reports and events will contain data from CFEngine system promises (labeled with a promise handle prefix <i>cfe_internal_</i> in the default policies located under <samp><span class="file">/var/cfengine/inputs/cfe_internal/</span></samp>). 
</ul>

   <p><i>System</i> promises reside in bundles whos name is prefixed by <code>cfe_internal_</code>. Their promise handle names are also prefixed by <code>cfe_internal_</code>. Bundles/promise handles that do not have this prefix will be categorized as <i>User</i> bundles/promises. <i>All</i> shows the union of <i>User</i> and <i>System</i> bundles/promises.

   <p>In addition, the <code>cf-agent</code> verbose output of promise compliance has changed format to accomodate the policy context feature:

     <ul>
<li>Old style verbose output:
<pre class="verbatim">     nova> Outcome of version Promises.cf 2.2.3 (agent-0): Promises observed to be kept 100%, Promises repaired 0%, Promises not repaired 0%
</pre>

     <li>New style verbose output:
<pre class="verbatim">     enterprise> Outcome of version Promises.cf 3.0.0 (agent-0): Promises observed - Total promise compliance: 100% kept, 0% repaired, 0% not kept (out of 6418 events). User promise compliance: 100% kept, 0% repaired, 0% not kept (out of 29 events). CFEngine system compliance: 100% kept, 0% repaired, 0% not kept (out of 6389 events).
</pre>
</ul>

   <p>The promise_summary.log file has undergone similar format changes to include results for the different policy contexts.

<!--  -->
<div class="node">
<a name="Navigation-Tree"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Status-tab">Status tab</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Policy-Context-Selector">Policy Context Selector</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Hosts-App">Hosts App</a>

</div>

<h4 class="subsection">4.1.2 Navigation Tree</h4>

<p>The Navigation Tree allows the user to group and organize hosts in a hierarchy defined by CFEngine classes (boolean classifiers that describe context).

   <pre class="sp">

</pre>
<div align="center"><img src="img-navigation-tree-3-0.png" alt="Navigation Tree"></div>
<div align="center">Figure: Navigation Tree</div>
   <pre class="sp">

</pre>

The tree consists of two main parts:

     <ul>
<li>The Tree Selector (top drop down menu): Choose between default trees or custom trees defined by the user. Each tree can have a different subset of nodes. Type a name in the <i>Add Tree</i> text field at the bottom of dropdown menu and press enter to add your own tree. Click <code>X</code> next to a tree name to delete it. 
<li>The tree itself, grouped by classes. The user can add up to four sublevels in the Navigation Tree and edit or delete existing nodes.

     <pre class="sp">
     
     </pre>
     <div align="center"><img src="img-navigation-tree-expanded-3-0.png" alt="Navigation Tree Expanded"></div>
     <div align="center">Figure: Navigation Tree Expanded</div>
     <pre class="sp">
     
     </pre>
          <ul>
<li> To add a node:
               <ol type=1 start=1>
<li>Put the mouse pointer over the node you wish to add a sublevel to, click the plus sign shown beside the node. 
<li>A pop-up appears with fields to enter a label (name) to the node that you wish to create and the class expression you wish to filter by. The class expression field contains a button which opens a class finder to help you select classes.
               </ol>
<li>To delete a node: Put the mouse pointer over the node that you wish to delete, click the <code>X</code> shown beside the node. 
<li>To edit a node:
               <ol type=1 start=1>
<li>Put the mouse pointer over the node that you wish to edit, click the <code>Pencil icon</code> shown beside the node. 
<li>A pop-up appears where you can edit the fields that you wish to change.
               </ol>
</ul>
     </ul>

<p class="noindent">The trees and nodes that a user creates will not be visible to other users of the Mission Portal.

   <p>Click on any host in the tree to get a quick overview of that host in the <i>Status</i>, <i>Vitals</i> or <i>Hosts Info</i> tabs.

<!--  -->
<div class="node">
<a name="Status-tab"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Reports-tab">Reports tab</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Navigation-Tree">Navigation Tree</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Hosts-App">Hosts App</a>

</div>

<h4 class="subsection">4.1.3 Status tab</h4>

<p>The Status tab shows the overall status of the hosts selected in the <i>Navigation Tree</i> and selected policy context (<i>{All}</i>, <i>{User}</i> or <i>{System}</i>).

   <pre class="sp">

</pre>
<div align="center"><img src="img-status-tab-3-0.png" alt="Status tab"></div>
<div align="center">Figure: Status tab</div>
   <pre class="sp">

</pre>

This section contains:

     <ul>
<li><i>Time series graph</i>: The row of bars shows the compliance of all registered hosts in blocks of six hours for the last week or in blocks of five minutes for the last six hours<a rel="footnote" href="#fn-5" name="fnd-5"><sup>5</sup></a>. The hosts are classified into red, yellow and green according to the status of their compliance. The height of a bar corresponds to the number of registered hosts. Note that the last column may have a lower height than the others in the six hour view (i.e. show information for fewer hosts)<a rel="footnote" href="#fn-6" name="fnd-6"><sup>6</sup></a>. Click on a bar to see which promises were repaired or not kept. 
<li><i>Host Compliance</i> and <i>Host Operations</i>: The hosts are classified into red, yellow and green according to the status of their compliance over the last hour as well as blue and black according to their operational status (host unreachable and host with scheduling deviation, respectively). 
<li>Clicking a link in any of the above categories (red/yellow/green/blue/black) produces a list of the hosts in that category (in the above mentioned context). 
</ul>

<!--  -->
<div class="node">
<a name="Reports-tab"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Events-tab">Events tab</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Status-tab">Status tab</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Hosts-App">Hosts App</a>

</div>

<h4 class="subsection">4.1.4 Reports tab</h4>

<p>Reports are sorted into five main categories that contain drop down menus to select default reports. All reports except <i>Accounting &gt; Benchmarks</i> and <i>Accounting &gt; Business value</i> are context sensitive, i.e. will change based on your selection in the navigation tree and the policy context selector. Clicking a report will bring up a search filter specific to that report.

   <pre class="sp">

</pre>
<div align="center"><img src="img-reports-tab-3-0.png" alt="Reports tab"></div>
<div align="center">Figure: Reports tab</div>
   <pre class="sp">

</pre>

Reports are updated at different intervals, the default values are every 5 minutes or every 6 hours. Below is a list of standard reports, updated every 5 minutes unless otherwise noted:

     <ul>
<li>Policy
          <ul>
    <li>Compliance by bundle: Status of promise bundles and when they were last verified
    <li>Compliance by promise: Compliance of each promise individually
    <li>Promises not kept (log): Log of individual promises that were not kept
    <li>Promises not kept (summary): Cumulative summary of promises not kept
    <li>Promises repaired (log): Log of individual promises that were repaired (fixes to the system)
    <li>Promises repaired (summary): Cumulative summary of promises repaired
</ul>
     <li>Accounting
          <ul>
    <li>Benchmarks: Execution time of selected promises (as defined in policy)
    <li>Business value report: Accumulated value of promises kept (6 hrs)
    <li>Compliance summary: Compliance of each agent run
</ul>
     <li>System
          <ul>
    <li>Context classes: User defined classes observed on the system
    <li>Last saw neighbors: Log of when neighboring hosts were last observed online
    <li>Variables: Table of variable values last observed (6 hrs)
    <li>Weakest hosts: Ranking of hosts according to the compliance over the last hour
</ul>
     <li>Software
          <ul>
    <li>Installed: List of software packages claimed to be installed according to the local package manager
    <li>Patches available: A list of patches currently claimed to be available by the local package manager
    <li>Patch installed: A list of (un)applied patches according to the local package manager
</ul>
     <li>File watch
          <ul>
    <li>Change summary: Log of all detected changes to files from changes promises
    <li>Setuid: Current list of observed setuid/setgid root programs (6 hrs)
    <li>Text changes: Delta/difference comparison showing file changes
</ul>
     </ul>

<!--  -->
<div class="node">
<a name="Events-tab"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Vitals-tab">Vitals tab</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Reports-tab">Reports tab</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Hosts-App">Hosts App</a>

</div>

<h4 class="subsection">4.1.5 Events tab</h4>

<p>The <i>Events tab</i> allows you to create trackers to follow selected promises or classes. The trackers are in real time and shows data as it is written to the database. They represent an easy way to monitor specific promises or trace the impact of policy changes and roll outs at a more detailed level. A classes tracker will list the hosts that satisfy the selected class.

   <pre class="sp">

</pre>
<div align="center"><img src="img-events-tab-3-0.png" alt="Events tab"></div>
<div align="center">Figure: Events tab</div>
   <pre class="sp">

</pre>

<!--  -->
<div class="node">
<a name="Vitals-tab"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Host-Info-tab">Host Info tab</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Events-tab">Events tab</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Hosts-App">Hosts App</a>

</div>

<h4 class="subsection">4.1.6 Vitals tab</h4>

<p>CFEngine has integrated monitoring capability where many parameters are measured on each client. These are presented visually in the <i>Vitals tab</i>. All parameters are listed if a single host is selected, otherwise the hosts are ranked according to a selected parameter.

   <pre class="sp">

</pre>
<div align="center"><img src="img-vitals-tab-3-0.png" alt="Vitals tab"></div>
<div align="center">Figure: Vitals tab</div>
   <pre class="sp">

</pre>

See also <a href="#Monitoring-extensions">Monitoring extensions</a>.

<!--  -->
<div class="node">
<a name="Host-Info-tab"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Vitals-tab">Vitals tab</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Hosts-App">Hosts App</a>

</div>

<h4 class="subsection">4.1.7 Host Info tab</h4>

<p>The <i>Host Info tab</i> is an inventory listing of discovered properties about a host. Includes host identity, operating system, architecture, CPU, interfaces, etc.

   <pre class="sp">

</pre>
<div align="center"><img src="img-hosts-info-tab-3-0.png" alt="Hosts Info tab"></div>
<div align="center">Figure: Hosts Info tab</div>
   <pre class="sp">

</pre>

<!--  -->
<div class="node">
<a name="SQL-Reports-App"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Docs-App">Docs App</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Hosts-App">Hosts App</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>

</div>

<h3 class="section">4.2 SQL Reports App</h3>

<p>The <i>SQL Reports</i> app gives the user full flexibility to create reports based on a simple customizable SQL interface. The workflow consists in choosing what fields you want to see in the report and how to filter them. You also have the option to save queries for later use or schedule queries to email reports to stakeholders. Be ready for instantaneous audits and inspections at low cost by reducing the time and work to gather reports.

   <pre class="sp">

</pre>
<div align="center"><img src="img-sql-reports-3-0.png" alt="SQL Reports"></div>
<div align="center">Figure: SQL Reports</div>
   <pre class="sp">

</pre>

There are two main areas of interaction in this app:

     <ul>
<li>Left menu: List of saved and scheduled searches
<li>Content area: Choose parameters for the report, view the result and save or schedule a query. 
</ul>

   <p>Items in the content area are used to create a query and generate reports according to the following description:
     <ul>
<li>Fields - Define your table columns (mandatory field)
<li>Filters - Filter the results of you query (use valid SQLite syntax)
<li>Group - Group your results according to selected criteria
<li>Sort - Sort your results according to a selected criteria
<li>Limit - Limit the number of entries in your report
<li>Show me the query - View and edit the SQL query directly
</ul>

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Please note that any queries containing the PromiseDefinitions table in combination with any other table in the schema will produce erroneous output without an intermediate join to the PromiseStatusLast table. See <a href="#SQLite-Database-Schema">SQLite Database Schema</a>. 
</td></tr></table>

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Please note that manual edits of the SQL query in the <i>Show me the query</i> field will invalidate input from the UI wizard. Conversely, any manual edit will be overwritten if you make changes in the UI wizard. 
</td></tr></table>

   <p>Once the query is defined you can run it to see the result, optionally save it for later use or schedule it to be emailed at a chosen interval. The report will appear below the UI wizard if you choose to run the query directly (limited to the number of entries chosen in the <i>Limit</i> field):

   <pre class="sp">

</pre>
<div align="center"><img src="img-sql-report-result-3-0.png" alt="SQL Report Result"></div>
<div align="center">Figure: SQL Report Table</div>
   <pre class="sp">

</pre>

<!--  -->
<!-- @node Docs App, Services App, SQL Reports App, Quickstart - The Mission Portal -->
<div class="node">
<a name="Docs-App"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Policies-App">Policies App</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SQL-Reports-App">SQL Reports App</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>

</div>

<h3 class="section">4.3 Docs App</h3>

<p>The <i>Docs</i> app gives access to both offline and online CFEngine documentation. The documents are scanned and parsed to be included in the integrated semantic index (see <a href="#Knowledge-App">Knowledge App</a>). Look up on the fly or study in depth. Learn about CFEngine concepts, syntax and inherent possibilities in CFEngine.

   <p>The left side shows an overview of all bundled documents, divided into categories that expand once clicked. The selected document is displayed in the main content area to the right.

   <pre class="sp">

</pre>
<div align="center"><img src="img-docs-app-3-0.png" alt="Docs"></div>
<div align="center">Figure: Docs</div>
   <pre class="sp">

</pre>

<!--  -->
<!-- @node Policies App, Knowledge App, Services App, Quickstart - The Mission Portal -->
<div class="node">
<a name="Policies-App"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Knowledge-App">Knowledge App</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Docs-App">Docs App</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>

</div>

<h3 class="section">4.4 Policies App</h3>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Please note that this is a beta app: it is under development and has basic intended functionality, but may have bugs and an incomplete functionality set. 
</td></tr></table>

   <p>The <i>Policies</i> app shows the promises that the system is currently trying to keep, with links to CFEngine's smart indexing and documentation. Show statistics about the quality and success of the intended state. Stay close to the intended
state of your system, by knowing what, where, when, how and why your infrastructure is defined, deployed and configured.

   <pre class="sp">

</pre>
<div align="center"><img src="img-policies-app-3-0.png" alt="Policies"></div>
<div align="center">Figure: Policies</div>
   <pre class="sp">

</pre>

The four tabs on the right content side give further insight into what the bundles on the left contain:

     <ul>
<li>Info: General information about what classes are used in the selected bundle, other affected bundles, and hosts affected by the bundle. 
<li>Stats: Overview of the number of promises made in the bundle and what promise types. 
<li>Compliance: Compliance of the selected bundle on the affected hosts. 
<li>Variables: List of variables used in the bundle. 
</ul>

<!--  -->
<!-- @node Knowledge App, Goals App, Policies App, Quickstart - The Mission Portal -->
<div class="node">
<a name="Knowledge-App"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#User-Management">User Management</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Policies-App">Policies App</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>

</div>

<h3 class="section">4.5 Knowledge App</h3>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Please note that this is a beta app: it is under development and has basic intended functionality, but may have bugs and an incomplete functionality set. 
</td></tr></table>

   <p>The <i>Knowledge</i> app embodies CFEngine's knowledge index, used to find answers and document references and reports. Use CFEngine's automated analysis of policy, collected data and local knowledge to comprehend your tools and infrastructure with greater authority.

   <pre class="sp">

</pre>
<div align="center"><img src="img-knowledge-3-0.png" alt="Knowledge App"></div>
<div align="center">Figure: Knowledge App</div>
   <pre class="sp">

</pre>

On the left you find a search field and a menu with foldable generic categories and list of documents and their content titles/headers. The right side presents the map itself, with references to the selected topic underneath. The map displays visual relations to other topics and is clickable, navigate and learn how topics are connected. The <i>See also</i> tab presents semantic links to other topics that might be related, as well as references to the selected topic. 
<!-- See also @url{https://cfengine.com/manuals/st-knowledge}. -->

<!-- todo -->
<!-- todo -->
<!--  -->
<!-- @node User Management, Settings, Compliance App, Quickstart - The Mission Portal -->
<div class="node">
<a name="User-Management"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Settings">Settings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Knowledge-App">Knowledge App</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>

</div>

<h3 class="section">4.6 User Management</h3>

<p>On a fresh install the default user <i>admin</i> belongs to the <i>admin</i> user group and has access everything in the Mission Portal. The <i>admin</i> user can add users to the internal database, set up external authentication and define roles to limit access.

   <p>The following shows how to add, edit and delete users from the internal database. See the respective sections, <a href="#Configuration-of-external-authentication">Configuration of external authentication</a> and <a href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a> for advanced user management.

   <pre class="sp">

</pre>
<img src="img-user-management-3-0.png" alt="User Management">
<div align="center">Figure: User Management</div>
<pre class="sp">

</pre>

Click the <b>Add User</b> button to add a new user to the internal database:

   <pre class="sp">

</pre>
<img src="img-add-user-3-0.png" alt="Add User">
<div align="center">Figure: Add User</div>
<pre class="sp">

</pre>

Enter the user information as requested in the fields. If user roles have been defined (see <a href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>), you can also choose to assign one or more roles to the user by selecting an available group and clicking the '<b>&lt;</b>' button located between the list of assigned and available roles. Finish by clicking <i>Create User</i>.

   <p>Users can be edited in the same way as above by clicking the <i>Pencil</i> button next to his or her user name. 
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
For resetting user passwords, please note that the Mission Portal will attempt to email the new password to the user. If this fails, the Mission Portal will display the new password on screen after the email server has given the fail message. Please note that this might take a while, you should verify that the recipient has gotten the email before moving on. If the password is displayed on the screen you will need to convey it to the user manually and check your Mission Portal email settings (see <a href="#Other-Settings">Other Settings</a>). 
</td></tr></table>

   <p>The information a user is authorized to see is determined from his or her
role memberships. A user may be member of an arbitrary number of
roles, each which may grant and deny access to certain
information. User-authentication is carried out when users log on to the Mission Portal, see also <a href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>.

<!--  -->
<div class="node">
<a name="Settings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#User-Management">User Management</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>

</div>

<h3 class="section">4.7 Settings</h3>

<ul class="menu">
<li><a accesskey="1" href="#Mission-Portal-Settings">Mission Portal Settings</a>
<li><a accesskey="2" href="#Manage-Apps">Manage Apps</a>
<li><a accesskey="3" href="#Hub-Replication-Status">Hub Replication Status</a>
<li><a accesskey="4" href="#Host-Identifier">Host Identifier</a>
<li><a accesskey="5" href="#Other-Settings">Other Settings</a>
</ul>

<!--  -->
<div class="node">
<a name="Mission-Portal-Settings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Manage-Apps">Manage Apps</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Settings">Settings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Settings">Settings</a>

</div>

<h4 class="subsection">4.7.1 Mission Portal Settings</h4>

<pre class="sp">

</pre>
<div align="center"><img src="img-mission-portal-settings-3-0.png" alt="Mission Portal Settings"></div>
<div align="center">Figure: Mission Portal Settings</div>
   <pre class="sp">

</pre>

Mission Portal settings allow the user to set and configure the following items:

   <pre class="sp">

</pre>
<b>Authentication method</b><br>
By default the Mission Portal will use the internal database to store user information. Default user name and password on the Mission Portal login page are "admin" and "admin".

   <p>External authentication (LDAP or Active Directory) is available for CFEngine 3 Nova 2.1 and later versions. See <a href="#Configuration-of-external-authentication">Configuration of external authentication</a> for how to set this up.

   <pre class="sp">

</pre>
<b>Role-Based Access Control</b><br>
CFEngine 3 Enterprise 2.2.0 introduced Role-Based Access Control (RBAC) for all hosts, reports and promises shown in the Mission Portal. RBAC does not cover access control for making policy changes. If you wish to use RBAC in combination with external authentication (LDAP or AD), we recommend that you wait to turn on RBAC until you log on with the LDAP or AD user that has been designated a Mission Portal admin (i.e do not turn RBAC on while logged in with an internal database user in this case). RBAC can be globally switched on or off, but see also <a href="#User-Management">User Management</a> for more details.

   <pre class="sp">

</pre>
<b>Unreachable host threshold</b><br>
Time after which a host is defined as unreachable (blue host; the hub is unable to reach this host due to connection problems). Default threshold is 15 minutes.

   <pre class="sp">

</pre>
<b>Turn on/off the Analytics feature</b><br>
Learn more about how users interact with the Mission Portal. This is completely anonymous and stored locally, you have to actively download and send the report to CFEngine if you whish to share it with us.

   <pre class="sp">

</pre>
<b>Set the Enterprise API log level</b> - Corresponds to the standard syslog levels.

   <pre class="sp">

</pre>
<b>Upload you company logo</b><br>
Image that will be shown on the top of PDF reports that are exported from the Mission Portal. Browse, choose and upload a file from your computer.

<!--  -->
<div class="node">
<a name="Manage-Apps"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Hub-Replication-Status">Hub Replication Status</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Settings">Mission Portal Settings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Settings">Settings</a>

</div>

<h4 class="subsection">4.7.2 Manage Apps</h4>

<p>Determine which apps should be active (on) or inactive (off) in the Mission Portal. The <i>Policy</i> and <i>Knowledge</i> apps are turned off by default. These are global settings that affect all users.

   <pre class="sp">

</pre>
<img src="img-manage-apps-3-0.png" alt="Manage Apps">
<div align="center">Figure: Manage Apps</div>
<pre class="sp">

</pre>

<!--  -->
<div class="node">
<a name="Hub-Replication-Status"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Host-Identifier">Host Identifier</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Manage-Apps">Manage Apps</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Settings">Settings</a>

</div>

<h4 class="subsection">4.7.3 Hub Replication Status</h4>

<p>Shows status of hub replication if it has been set through policy. Contact your sales representative if you wish help with setting this up.

<!--  -->
<div class="node">
<a name="Host-Identifier"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Other-Settings">Other Settings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Hub-Replication-Status">Hub Replication Status</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Settings">Settings</a>

</div>

<h4 class="subsection">4.7.4 Host Identifier</h4>

<p>The <i>Host Identifier</i> is used to choose what attribute will be used to identify hosts that are not directly addressable from the hub (e.g. hosts behind a network address translator (NAT) or where two-way initialization of communication is generally denied). See <a href="#Call_002dCollect">Call-Collect</a>.

   <pre class="sp">

</pre>
<img src="img-host-identifier-3-0.png" alt="Host Identifier">
<div align="center">Figure: Host Identifier</div>
<pre class="sp">

</pre>

<!--  -->
<div class="node">
<a name="Other-Settings"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Host-Identifier">Host Identifier</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Settings">Settings</a>

</div>

<h4 class="subsection">4.7.5 Other Settings</h4>

<p>These settings are not availble through the Mission Portal, but can be accessed through files in the web document root on the hub. 
They are related to default save path for CSV/PDF reports, timeout for exported report generation, Mission Portal email configuration, URL for the Enterprise REST API and default title for scheduled reports.

     <ul>
<li>Reports and Enterprise REST API (<samp><span class="file">&lt;DOCROOT&gt;/application/config/appsettings.php</span></samp>, section labelled "<code>User defined constants</code>"). You can specify:
          <ul>
<li>Path to save CSV and PDF files from reports on hosts page
<li>Path to save CSV and PDF files from scheduled reports
<li>Default FROM email address
<li>Default TITLE for scheduled reports
<li>Max allowed time for PDF generation in seconds
<li>URL for Enterprise REST API server
</ul>

     <li>Email settings (<samp><span class="file">&lt;DOCROOT&gt;/application/config/email.php</span></samp>). By editing this file you can specify custom email settings adapted to your setup. 
</ul>

<p class="noindent">The complete list of options for <samp><span class="file">&lt;DOCROOT&gt;/application/config/email.php</span></samp> are as follows:

   <pre class="sp">

</pre>
<pre class="verbatim">&lt;pre>
&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
/*
* method used to send email
*/

$config['useragent'] = 'cfengine'; // The "user agent".
$config['protocol'] = 'mail'; // The mail sending protocol. Values: mail, sendmail,
                               or smtp.
$config['mailpath'] = ''; // The server path to Sendmail.

$config['smtp_host'] = ''; // SMTP Server Address.
$config['smtp_user'] = ''; // SMTP Username.
$config['smtp_pass'] = ''; // SMTP Password.
$config['smtp_port'] = ''; // SMTP Port, f.e. 25
$config['smtp_timeout'] = ''; // SMTP Timeout (in seconds). f.e. 5

$config['wordwrap'] = TRUE; // Enable word-wrap. Values: TRUE or FALSE (boolean).
$config['wrapchars'] = 76; // Character count to wrap at. f.e. 76
$config['mailtype'] = 'text'; // Type of mail. values: text or html
$config['charset'] = 'utf-8'; // Character set (utf-8, iso-8859-1, etc.).
$config['validate'] = TRUE; // Whether to validate the email address. Values: TRUE
                            // or FALSE (boolean)
$config['priority'] = 3; // Email Priority. 1 = highest. 5 = lowest. 3 = normal. 
                         // Values: 1, 2, 3, 4, 5
$config['crlf'] = '\r\n'; // Newline character. (Use "\r\n" to comply with RFC 822). 
                          // Values: "\r\n" or "\n" or "\r"
$config['newline'] = '\r\n'; // Newline character. (Use "\r\n" to comply 
                             // with RFC 822). Values: \r\n" or "\n" or "\r"

$config['bcc_batch_mode'] = FALSE; // Enable BCC Batch Mode. Values: TRUE or
                                   // FALSE (boolean)
$config['bcc_batch_size'] = ''; // Number of emails in each BCC batch. f.e. 200

?>
&lt;/pre> 
</pre>
   <pre class="sp">


</pre>

Email configuration example:

   <pre class="sp">

</pre>
<pre class="verbatim">&lt;?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
/*
 * method used to send email
 */
$config['protocol'] = 'smtp';
$config['smtp_port'] = '25';
$config['user_agent']='cfengine';
$config['smtp_host']='10.10.10.10';
$config['smtp_user'] = 'user';
$config['smtp_pass'] = 'password';
$config['smtp_crypto'] = 'tls';
$config['charset'] = 'iso-8859-1';
$config['wordwrap'] = TRUE;

?>
</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<!-- @node  Role Based Access Control (RBAC), Virtualization and Cloud, Quickstart - CFEngine Policies, Top -->
<div class="node">
<a name="Role-Based-Access-Control-(RBAC)"></a>
<a name="Role-Based-Access-Control-_0028RBAC_0029"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Quickstart-_002d-The-Mission-Portal">Quickstart - The Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">5 Role Based Access Control (RBAC)</h2>

<p>Role-Based Access Control (RBAC) limits user access to the Mission Portal settings page and access to hosts, reports and promises in the different Mission Portal Apps. RBAC can be globally switched on or off in the Mission Portal settings (see <a href="#Mission-Portal-Settings">Mission Portal Settings</a>).

   <p>On a fresh install the default user "admin" belongs to the "admin" user group and has access everything in the Mission Portal. The "admin" user can add users to the internal database, set up external authentication (see <a href="#Configuration-of-external-authentication">Configuration of external authentication</a>) and define roles to limit access.

<ul class="menu">
<li><a accesskey="1" href="#Defining-Roles">Defining Roles</a>
<li><a accesskey="2" href="#Entities-Filtered">Entities Filtered</a>
<li><a accesskey="3" href="#Limitations">Limitations</a>
</ul>

<!--  -->
<div class="node">
<a name="Defining-Roles"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Entities-Filtered">Entities Filtered</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>

</div>

<h3 class="section">5.1 Defining Roles</h3>

<p>A role is defined as reporting
access to a set of hosts and promise bundles from the Mission Portal
and REST API. This does not give any rights with respect to changing
the content or execution of the policy. It should not be confused with
the <code>roles</code> promise-type that can be used by <code>cf-runagent</code>
and <code>cf-serverd</code>.

   <pre class="sp">

</pre>
<img src="img-user-roles-3-0.png" alt="User Roles">
<div align="center">Figure: User Roles</div>
<pre class="sp">

</pre>

Click the <b>Add Role</b> button to add a new user role to the Mission Portal:

   <pre class="sp">

</pre>
<img src="img-add-role-3-0.png" alt="Add Role">
<div align="center">Figure: Add Role</div>
<pre class="sp">

</pre>

Roles can be defined on either classes or bundles and involves setting permissions through an include and exclude list for each. The effective permissions of a user is the cumulative set of permission granted or denied by his roles, and is used to filter the information displayed in the following way:

     <ul>
<li>Create a union of the granted access for the roles. 
<li>Override with the rules that deny access for the roles. 
<li>If left unspecified, access is denied. 
</ul>

   <p>In order to scale, both entities are
defined as a set of <em>regular expressions</em> to allow and
deny.

   <p>Access to hosts is defined by regular expressions on <em>classes</em>,
not the hostname, ip, or any other name. This is done to ensure
maximum scalability. Classes can be arbitrarily defined in the
CFEngine policy language, so this incurs no loss of flexibility, but
ensures distributed computation.

   <p>In contrast to users, a role definition and membership can only be
obtained from the internal Mission Portal database. This means that
any roles must be defined through the Mission Portal web interface,
and can not be obtained from e.g. LDAP at this time. The rationale is
that querying complex LDAP structures for role membership is too
inefficient and error-prone. This may change in future releases, if
requested. Note that the <em>possible members</em> of a role can be
obtained from other sources, as described in the section on user
administration. However, assigning possible members to roles must be
done through the Mission Portal user-interface.

<!--  -->
<div class="node">
<a name="Entities-Filtered"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Limitations">Limitations</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Defining-Roles">Defining Roles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>

</div>

<h3 class="section">5.2 Entities Filtered</h3>

<p>The above discussion showed that RBAC is supported on the <em>host</em> and <em>promise bundle</em> level,
each applying to different parts of the Mission Portal. Both these
entities are atomic with respect to RBAC &mdash; either a user can see
everything they contain, or nothing of it.

   <p>Access to a host is required to see any information about it, e.g. all
its reports, host information, and compliance
category. If a user is not allowed access to a host, the Mission
Portal would look the same as if the host was not bootstrapped to that
hub.

   <p>Information about the running policy is also available in the Mission
Portal, either through the Promise Finder or
by clicking a promise handle from one of the reports. The searchable
promises in the Promise Finder and information pages about promises
and bundles are filtered in the same manner as the hosts, but defined
based on promise bundles instead.

   <p>Note that the host and promise filtering is independent &mdash; no attempt
is made to try to infer which promises a role should have access to
based on the hosts it has access to or vice versa.

<!--  -->
<div class="node">
<a name="Limitations"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Entities-Filtered">Entities Filtered</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>

</div>

<h3 class="section">5.3 Limitations</h3>

     <ul>
<li>Notes added in the Mission Portal are not filtered: they can be
seen by all users (including notes added to any host page).

     <li>The Knowledge Map is only available for members of the
&lsquo;<samp><span class="samp">admin</span></samp>&rsquo; role when RBAC is switched on.

     <li>Running <code>cf-report</code> from the command-line on the hub will
bypass all RBAC checks.

</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Virtualization-and-Cloud"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Windows_002dspecific-features-in-CFEngine-Enterprise">Windows-specific features in CFEngine Enterprise</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">6 Virtualization and Cloud</h2>

<ul class="menu">
<li><a accesskey="1" href="#What-are-virtualization-and-cloud-computing_003f">What are virtualization and cloud computing?</a>
<li><a accesskey="2" href="#Why-build-virtualization-support-into-CFEngine_003f">Why build virtualization support into CFEngine?</a>
<li><a accesskey="3" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>
<li><a accesskey="4" href="#Guest-environments-promises">Guest environments promises</a>
<li><a accesskey="5" href="#Virtualization-types-supported">Virtualization types supported</a>
<li><a accesskey="6" href="#Distinct-states">Distinct states</a>
<li><a accesskey="7" href="#Example-deployment">Example deployment</a>
</ul>

<!--  -->
<div class="node">
<a name="What-are-virtualization-and-cloud-computing%3f"></a>
<a name="What-are-virtualization-and-cloud-computing_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Why-build-virtualization-support-into-CFEngine_003f">Why build virtualization support into CFEngine?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>

</div>

<h3 class="section">6.1 What are virtualization and cloud computing?</h3>

<pre class="sp">

</pre>

Virtualization refers to the ability to run multiple host instances on
a single physical node. Cloud computing typically refers to what is
called `platform as a service', or deployment of virtual machines on
demand, often as an on-line service.

   <p>In this document, virtualization support refers specifically to
hypervisor technologies supported by the open source library layer <i>libvirt</i>
project, which includes interfaces for Xen, KVM, VMware-ESX, and more. 
CFEngine thus integrates freely with other tools based on this library, such
as <i>virsh</i> and the <i>Virtual Manager</i> graphical user interface.

<!--  -->
<div class="node">
<a name="Why-build-virtualization-support-into-CFEngine%3f"></a>
<a name="Why-build-virtualization-support-into-CFEngine_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-are-virtualization-and-cloud-computing_003f">What are virtualization and cloud computing?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>

</div>

<h3 class="section">6.2 Why build virtualization support into CFEngine?</h3>

<pre class="sp">

</pre>

Virtualization engines (usually called supervisors or hypervisors) are
seeing an explosion of development. They exist as a number of projects
in various stages of maturity. The libvirt project was designed as
an integration layer based on an XML specification.

   <p>The tools for management are still quite primitive and require much
manual work. CFEngine has a unique role to play in maintaining desired
state in virtual machine systems.

   <p>In the cloud, virtual machines may be rented from remote commercial
providers, and managed as disposable resources. Convergent or
`self-healing' maintenance is an essential method for managing
machines that are geographically remote and awkward to access, e.g. 
machines in other time-zones that it is impractical to monitor by
legacy methods.

<!--  -->
<div class="node">
<a name="What-can-CFEngine-do-with-virtual-machines%3f"></a>
<a name="What-can-CFEngine-do-with-virtual-machines_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Guest-environments-promises">Guest environments promises</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Why-build-virtualization-support-into-CFEngine_003f">Why build virtualization support into CFEngine?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>

</div>

<h3 class="section">6.3 What can CFEngine do with virtual machines?</h3>

<pre class="sp">

</pre>

The simple answer is: most things that <i>libvirt</i> can do, with added
convergence to a desired state: that means, creating, destroying and
starting and stopping machines. By starting virtual machines through
CFEngine, you can be sure that a given `virtual guest' is running on
one and only one physical host, thus avoiding conflicts that are
difficult to detect with centralized systems.

   <p>CFEngine does not support everything that libvirt does &ndash; it offers a
simplified interface that is meant for robustness, stability and
hands-free repeatability.

   <pre class="sp">

</pre>
<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
CFEngine does not use libvirt's TLS based web communication layer.  It
manages every host as an independent entity, in typical CFEngine
fashion, using CFEngine's own distributed cooperation to provide the
implicit communication.  CFEngine does not currently support so-called
`live migration' of virtual machines. 
</td></tr></table>

   <pre class="sp">

</pre>

<!--  -->
<div class="node">
<a name="Guest-environments-promises"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Virtualization-types-supported">Virtualization types supported</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#What-can-CFEngine-do-with-virtual-machines_003f">What can CFEngine do with virtual machines?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>

</div>

<h3 class="section">6.4 Guest environments promises</h3>

<pre class="sp">

</pre>

A virtual machine is one example of what CFEngine calls an `guest
environment'.  You can promise to create (and host) an guest
environment with certain attributes, just as you can promise to host a
file or a process. Here is a simple example:

<pre class="verbatim">body common control
{
bundlesequence  => { "my_vm_cloud" };   
}

#######################################################

bundle agent my_vm_cloud
{
guest_environments:

   "myUbuntu" # the running instance name, defined in XML

       environment_resources => virt_xml,
       environment_type      => "xen",
       environment_host      => "my_physical_computer", # ipv4_10_1_2_3
       environment_state     => "create";
}

#######################################################

body environment_resources virt_xml
{
env_spec_file => "/srv/xen/centos5-libvirt-create.xml";
}

</pre>

     <ul>
<li>The promiser (in this case &lsquo;<samp><span class="samp">myUbuntu</span></samp>&rsquo;) is the name of the virtual
machine. This should be a unique identifier, as we need to be able to
refer to machines uniquely.

     <li>The guest environment host is the name of the computer that
is the host for the virtual machine.

     <li>Normally when we want to ensure something on a machine, we use classes
to decide where the promise will be made. For guest environments, however,
we need to make promises about the uniqueness of the machine. When you
make a machine instance you normally want it to be running on one and
only one host. So you want <i>every</i> machine to make a promise. On the
guest environment's host, you want to promise that the guest environment is
running, and on every other machine you want to promise that it is
not. In CFEngine, you simply include a unique class belonging to host
in the promise using <code>environment_host</code> and CFEngine assumes that
rest. Unique classes might include
          <ul>
<li>Hostname class e.g. <code>myhost_CFEngine_com</code>
<li>IP address class e.g. <code>ipv4_123_456_789_123</code>
</ul>
     </ul>

   <p>An alternative way to write this example is to quote the XML
specification in CFEngine directly. This has a few advantages: you can
re-use the data and use it as a template, filling in
CFEngine-variables. You can thus adapt the configuration using
CFEngine's classes.

<pre class="verbatim">bundle agent my_vm_cloud
{
guest_environments:

   "myUbuntu" # the running instance name, defined in XML
       environment_resources => virt_xml("$(this.promiser)"),
       environment_type      => "xen",
       environment_host      => "myphysicalcomputer";
       environment_state     => "create"
}

#######################################################

body environment_resources virt_xml(host)
{
env_spec_file => 

"&lt;domain type='xen'>
  &lt;name>$(host)&lt;/name>
  &lt;os>
    &lt;type>linux&lt;/type>
    &lt;kernel>/var/lib/xen/install/vmlinuz-ubuntu10.4-x86_64&lt;/kernel>
    &lt;initrd>/var/lib/xen/install/initrd-vmlinuz-ubuntu10.4-x86_64&lt;/initrd>
    &lt;cmdline> kickstart=http://example.com/myguest.ks &lt;/cmdline>
  &lt;/os>
  &lt;memory>131072&lt;/memory>
  &lt;vcpu>1&lt;/vcpu>
  &lt;devices>
    &lt;disk type='file'>
      &lt;source file='/var/lib/xen/images/$(host).img'/>
      &lt;target dev='sda1'/>
    &lt;/disk>
    &lt;interface type='bridge'>
      &lt;source bridge='xenbr0'/>
      &lt;mac address='aa:00:00:00:00:11'/>
      &lt;script path='/etc/xen/scripts/vif-bridge'/>
    &lt;/interface>
    &lt;graphics type='vnc' port='-1'/>
    &lt;console tty='/dev/pts/5'/>
  &lt;/devices>
&lt;/domain>
";
}
</pre>

   <p>You should consult the libvirt documentation for the details of the XML specification.

<!--  -->
<div class="node">
<a name="Virtualization-types-supported"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Distinct-states">Distinct states</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Guest-environments-promises">Guest environments promises</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>

</div>

<h3 class="section">6.5 Virtualization types supported</h3>

<pre class="sp">

</pre>

CFEngine currently supports virtualization only through libvirt, so it supports
those technologies that libvirt supports. Currently this includes  most popular
technologies. You must choose the type of monitor that is to be responsible for
keeping the guest environment promise. In CFEngine, you should choose between a
machine environment or network environment of the following types:
     <dl>
<dt><code>xen</code><dd>A Xen hypervisor virtual domain. 
<br><dt><code>kvm</code><dd>A KVM hypervisor virtual domain. 
<br><dt><code>esx</code><dd>A VMware hypervisor virtual domain. 
<br><dt><code>test</code><dd>The libvirt test-hypervisor virtual domain. 
<br><dt><code>xen_net</code><dd>A Xen hypervisor virtual network. 
<br><dt><code>kvm_net</code><dd>A KVM hypervisor virtual network
<br><dt><code>esx_net</code><dd>An ESX/VMWare hypervisor virtual network. 
<br><dt><code>test_net</code><dd>The test hypervisor virtual network. 
<br><dt><code>zone</code><dd>A Solaris zone (future development)
<br><dt><code>ec2</code><dd>An Amazon EC2 instance (future development)
<br><dt><code>eucalyptus</code><dd>A Eucalyptus instance (future development)
</dl>

   <p>Once again, you must consult the libvirt documentation for details.

<!--  -->
<div class="node">
<a name="Distinct-states"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-deployment">Example deployment</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization-types-supported">Virtualization types supported</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>

</div>

<h3 class="section">6.6 Distinct states</h3>

<pre class="sp">

</pre>

Libvirt recognizes a number of distinct states are transliterated into CFEngine
as
     <dl>
<dt><code>create</code><dd>Build and start an guest environment. 
<br><dt><code>delete</code><dd>Halt and remove runtime resources associated with an guest environment. 
<br><dt><code>running</code><dd>An existing guest environment is in a running state. 
<br><dt><code>suspended</code><dd>An existing guest environment is in a `paused' state. 
<br><dt><code>down</code><dd>An existing guest environment is in a halted state. 
</dl>
   The default promised state is for a machine to be running
wherever the  <code>environment_host</code> class is true, and
suspended or down elsewhere.

<!--  -->
<div class="node">
<a name="Example-deployment"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Distinct-states">Distinct states</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>

</div>

<h3 class="section">6.7 Example deployment</h3>

<pre class="sp">

</pre>

Prerequisites: you need to make a `disk image' for the machine, or a
virtual disk of blocks that can be allocated. This image does not have to
contain any data, it will simply as a block device for the VM. You
can then install it by booting the machine from a network image, like a
PXE/kickstart installation.

   <p>If you want to allocate disk blocks as the file grows, you can create
a file with a hole. The following command will creates a file of
2048MB, but the actual data blocks are allocated in a lazy fashion:

<pre class="verbatim">
# dd if=/dev/zero of=/srv/xen/my.img oflag=direct bs=1M seek=2047 count=1

</pre>
To reserve all the data blocks right away:
<pre class="verbatim">
# dd if=/dev/zero of=/srv/xen/my.img oflag=direct bs=1M count=2048

</pre>

   <p>Libvirt uses an XML file format that cannot be circumvented. CFEngine
promises to honor the promises that are expressed in this file, as in
the examples above.  You need to find out about this file format from
the libvirt website.  To get CFEngine to Honor these promises, you
point it to the specification that it should promise using
<code>spec_file</code>.

   <p>You need to set up a network for virtual machines to communicate with
the outside world. This can also be done with CFEngine, using the
network promise types to build a bridge into a virtual network.

   <p>Then just run CFEngine to start, stop or manage the guest environments on
each localhost. Run in verbose mode to see how CFEngine maintains the states
convergently.
<pre class="verbatim"># cf-agent -v
</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Windows-specific-features-in-CFEngine-Enterprise"></a>
<a name="Windows_002dspecific-features-in-CFEngine-Enterprise"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#REST-API">REST API</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Virtualization-and-Cloud">Virtualization and Cloud</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">7 Windows-specific features in CFEngine Enterprise</h2>

<p>In this section, we will explore the Windows-specific features of the
native Windows version of CFEngine Enterprise, and how it integrates with
Windows. We will also consider features that are more interesting or
popular on Windows than on other platforms.

   <p>Feature highlights include Windows service management and integration,
event logging, Windows registry repair, and fine-tuned file security
support through access control lists. See the sections on databases
and ACLs to find information on Windows registry repair and NTFS ACLs,
respectively. We will look at some of the other added features next.

<h3 class="section">7.1 Windows service management</h3>

<p>CFEngine Enterprise can maintain complete control of the state of all
Windows services, in addition to Unix daemons. Services prone to
security issues or errors can easily be given a disabled state.

   <div class="block-image"><img src="winservice-disabled_policy.png" alt="Disabled Windows service"></div>

   <p>A service can also be given a running state, in which case CFEngine
3 Enterprise ensures that it is running, and starts it if it is not, with
parameters if desired. More advanced policy options are also
available, including support for starting and stopping dependencies,
and configuring when the services should be started (e.g. only when
they are being used).

   <p>Furthermore, the CFEngine executor in CFEngine Enterprise now runs as a Windows
service itself. This means it runs in the background an starts with
Windows, before any user logs in. It can be configured, started and
stopped from the &ldquo;Services&rdquo; listing in Windows.

   <p>Note that the name of a service in Windows may be different from its
&ldquo;Display name&rdquo;. CFEngine Enterprise policies use the name, not the display
name, due to the need of uniqueness.

   <div class="block-image"><img src="winservice-properties_name.png" alt="Windows service name and Display name"></div>

<h3 class="section">7.2 Windows event logging</h3>

<p>Event logs are the Windows counterpart to syslog from Unix. The main
difference is that event logs aim to group similar log messages,
giving each group an event id.

   <div class="block-image"><img src="winevent-repaired-acl-closeup.png" alt="Promise repaired in Event Viewer"></div>

   <p>A program that creates logs, such as CFEngine Enterprise, must define the
possible event IDs, and their meaning. In many applications, only one
event id is defined, a generic log message. However, CFEngine Enterprise
defines the following range of event IDs, which allows for automatic
handling of log messages.

   <p><table summary=""><tr align="left"><th valign="top" width="40%">Description </th><th valign="top" width="20%">Event ID </th><th valign="top" width="20%">Type
<br></th></tr><tr align="left"><td valign="top" width="40%">Promise kept </td><td valign="top" width="20%">100 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise repaired </td><td valign="top" width="20%">101 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise not repaired due warn only policy </td><td valign="top" width="20%">102 </td><td valign="top" width="20%">Error
<br></td></tr><tr align="left"><td valign="top" width="40%">Promise not repaired due to error </td><td valign="top" width="20%">103 </td><td valign="top" width="20%">Error
<br></td></tr><tr align="left"><td valign="top" width="40%">Report promise </td><td valign="top" width="20%">104 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic information </td><td valign="top" width="20%">105 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic verbose </td><td valign="top" width="20%">106 </td><td valign="top" width="20%">Information
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic warning </td><td valign="top" width="20%">107 </td><td valign="top" width="20%">Warning
<br></td></tr><tr align="left"><td valign="top" width="40%">Generic error </td><td valign="top" width="20%">108 </td><td valign="top" width="20%">Error
   <br></td></tr></table>

   <div class="block-image"><img src="winevent-notkept-storage.png" alt="Promise not kept in Event Viewer"></div>

   <p>The CFEngine Enterprise event logs can be found under the &ldquo;System&rdquo; logs.  Almost
all monitoring products for Windows supports reading event logs, and
they can thus monitor logs from CFEngine Enterprise as well. This makes it
possible to do more advanced querying on the status of a machine
running CFEngine Enterprise, e.g. to show all promises that have not been
kept in a certain time interval. However, we recommend using the
Knowledge Map to do more advanced things, as it is specifically made
for this purpose and supports all operating systems that CFEngine runs
on.

<h3 class="section">7.3 Windows special variables</h3>

<p>Three new special variables have been added to the Windows version of
CFEngine Enterprise.

     <ul>
<li><code>sys.windir</code> contains the Windows directory,
e.g. &ldquo;C:\WINDOWS&rdquo;.

     <li><code>sys.winsysdir</code> contains the Windows system directory,
e.g. &ldquo;C:\WINDOWS\system32&rdquo;.

     <li><code>sys.winprogdir</code> contains the program files directory,
e.g. &ldquo;C:\Program Files&rdquo;.

   </ul>

   <p>Note that these variables are not statically coded, but retrieved from
the current system. For example, <code>sys.winprogdir</code> is often
different on Windows versions in distinct languages.

<h3 class="section">7.4 Windows hard classes</h3>

<p>The Windows version of CFEngine Enterprise defines hard classes to pinpoint
the exact version of Windows that it is running on, the service pack
version and if it's a server or workstation.

   <p>First of all, the class <code>windows</code> is defined on all Windows
platforms. For Windows workstations, such as Windows XP,
<code>WinWorkstation</code> is defined. On Windows servers, such as Windows
Server 2003, <code>WinServer</code> is defined. In addition, if the server
is a domain controller, <code>DomainController</code> is defined. Note that
if <code>DomainController</code> is defined, then <code>WinServer</code> is also
defined, for natural reasons.

   <p>The class <code>Service_Pack_X_Y</code> is defined according to the service
pack version. For example, at the time of writing,
<code>Service_Pack_3_0</code> is set on an updated Windows XP operating
system.

   <p>To allow taking specific actions on different Windows versions, one
of the following hard classes is defined.

     <ul>
<li><code>Windows_7</code>
<li><code>Windows_Server_2008_R2</code>
<li><code>Windows_Server_2008</code>
<li><code>Windows_Vista</code>
<li><code>Windows_Server_2003_R2</code>
<li><code>Windows_Home_Server</code>
<li><code>Windows_Server_2003</code>
<li><code>Windows_XP_Professional_x64_Edition</code>
<li><code>Windows_XP</code>
<li><code>Windows_2000</code>
</ul>

   <p>Note that all defined hard classes for a given system is shown by
running <code>cf-promises -v</code>.

<h3 class="section">7.5 Notes on windows policies</h3>

<p>A potential problem source when writing policies for windows is that
paths to executables often contain spaces. This makes it impossible
for CFEngine to know where the executable ends and the parameters to
it starts. To solve this, we place escaped quotes around the
executable.

   <p>Additionally, Windows does not support that processes start themselves
in in the background (i.e. fork off a child process in the Unix
world). The result is that CFEngine is always waiting for the commands
to finish execution before checking the next promise. To avoid this,
use the background attribute in the action body-part.

   <p>Both these things are demonstrated in the following example.

<pre class="verbatim">
body common control
{
bundlesequence  => { "main" };
}

bundle agent main
{
commands:

"\"C:\Program Files\Some Dir\program name.bat\" --silent --batch"
  action => background;
}

body action background
{
background => "true";
}

</pre>

   <p>Finally, one should note that Windows lacks support for certain
features that are utilized in Unix versions of CFEngine. These include
symbolic links, file groups, user and group identifiers.

   <p>Thus, the parts of promises containing these features will be
ignored. For example, the <code>getgid()</code> function does not return
anything on Windows. The reference manual documents exactly which
promises are ignored and not.  Also, <code>cf-agent</code> from CFEngine
3 Enterprise prints warning messages on ignored attributes when run in verbose
mode.

<!-- ************************************************** -->
<!-- CHAPTER -->
<!-- ************************************************** -->
<div class="node">
<a name="REST-API"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Call_002dCollect">Call-Collect</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Windows_002dspecific-features-in-CFEngine-Enterprise">Windows-specific features in CFEngine Enterprise</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">8 REST API</h2>

<ul class="menu">
<li><a accesskey="1" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>
<li><a accesskey="2" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>
<li><a accesskey="3" href="#Checking-Status">Checking Status</a>
<li><a accesskey="4" href="#Managing-Settings">Managing Settings</a>
<li><a accesskey="5" href="#Managing-Users-and-Roles">Managing Users and Roles</a>
<li><a accesskey="6" href="#Browsing-Host-Information">Browsing Host Information</a>
<li><a accesskey="7" href="#SQL-Queries">SQL Queries</a>
<li><a accesskey="8" href="#API-Reference">API Reference</a>
</ul>

<p>The CFEngine Enterprise API allows HTTP clients to interact with the Hub of a CFEngine Enterprise 3.0 installation. With the Enterprise API, you can..

     <ul>
<li>Check installation status
<li>Manage users, groups and settings
<li>Browse host (agent) information and policy
<li>Issue flexible SQL queries against data collected by the Hub from agents
<li>Schedule reports for email and later download
</ul>

   <p>The Enterprise API is a REST API, but a central part of interacting with the API involves using SQL. This is new in 3.0 and was done to provide users with maximal flexibility for crafting custom reports based on the wealth of data residing on the Hub.

<!--  -->
<div class="node">
<a name="Basic-Properties-of-the-API"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#REST-API">REST API</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.1 Basic Properties of the API</h3>

<ul class="menu">
<li><a accesskey="1" href="#HTTP-_002b-JSON">HTTP + JSON</a>
<li><a accesskey="2" href="#Requests">Requests</a>
<li><a accesskey="3" href="#Responses">Responses</a>
<li><a accesskey="4" href="#Pagination">Pagination</a>
<li><a accesskey="5" href="#Time">Time</a>
<li><a accesskey="6" href="#Authentication">Authentication</a>
<li><a accesskey="7" href="#Authorization">Authorization</a>
</ul>

<!--  -->
<div class="node">
<a name="HTTP-+-JSON"></a>
<a name="HTTP-_002b-JSON"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Requests">Requests</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>

</div>

<h4 class="subsection">8.1.1 HTTP + JSON</h4>

<p>The Enterprise API is a conventional REST API in the sense that it has a number of URI resources that support one or more GET, PUT, POST, or DELETE operations. While reporting is done using SQL, this query is always wrapped in a JSON request.

<!--  -->
<div class="node">
<a name="Requests"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Responses">Responses</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#HTTP-_002b-JSON">HTTP + JSON</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>

</div>

<h4 class="subsection">8.1.2 Requests</h4>

<p><b>GET</b> requests are one of <b>listing</b> or <b>getting</b>. <b>Listing</b> resources means that a number of results will be returned, but each entry may contain limited information. An example of a <b>listing</b> query is <i>/api/user</i> to list users. Notice that URI components are always non-plural. An exception to this is <i>/api/settings</i>, which returns the singleton resource for settings. <b>Getting</b> a resource specifies an individual resource to return, e.g. <i>/api/user/homer</i>. <b>PUT</b> request typically create a new resource, e.g. a user. <b>POST</b> requests typically updates an existing resource. <b>DELETE</b> requests are also supported in some cases.

<!--  -->
<div class="node">
<a name="Responses"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Pagination">Pagination</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Requests">Requests</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>

</div>

<h4 class="subsection">8.1.3 Responses</h4>

<p>Enterprise 3.0 API responses are always of the following format, consisting of a <b>meta</b> object and a <b>data</b> array.
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1350922925
  },
  "data": [
     ... 
  ]
}
</pre>

   <p><b>page</b> refers to the current page number of the request. <b>count</b> is the number of results in the current page, equaling the length of the <b>data</b> array. <b>total</b> is the number of results in all available pages combined. <b>timestamp</b> is the time the request was processed by the API. The <b>data</b> array is resource dependent, but will always contain objects. Response objects typically do not contain error codes. If the response is not <i>200 OK</i>, the appropriate HTTP error code returned along with a (possibly non-JSON) payload.

<!--  -->
<div class="node">
<a name="Pagination"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Time">Time</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Responses">Responses</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>

</div>

<h4 class="subsection">8.1.4 Pagination</h4>

<p>Pagination is handled by <b>page</b> and <b>count</b> query parameters to a <b>GET</b> request, e.g. <i>/api/user?page=5&amp;count=30</i> to get the 5th page of pages of 30 entries each. The default <b>page</b> is 1 and the default <b>count</b> is 50 if these are not specified explicitly.

<!--  -->
<div class="node">
<a name="Time"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Authentication">Authentication</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Pagination">Pagination</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>

</div>

<h4 class="subsection">8.1.5 Time</h4>

<p>All timestamps are reported in <i>Unix Time</i>, i.e. seconds since 1970.

<!--  -->
<div class="node">
<a name="Authentication"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Authorization">Authorization</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Time">Time</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>

</div>

<h4 class="subsection">8.1.6 Authentication</h4>

<p>The API supports both internal and external authentication. The internal users table will always be consulted first, followed by an external source specified in the settings. External sources are <i>OpenLDAP</i> or <i>Active Directory</i> servers configurable through <i>POST /api/settings</i>.

<!--  -->
<div class="node">
<a name="Authorization"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Authentication">Authentication</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>

</div>

<h4 class="subsection">8.1.7 Authorization</h4>

<p>Some resources require that the request user is a member of the <i>admin</i> role. Roles are managed with <i>/api/role</i>. <a href="#Role-Based-Access-Control-_0028RBAC_0029">Role Based Access Control (RBAC)</a> is configurable through settings. Users typically have permission to access their own resources, e.g. their own scheduled reports.

<!--  -->
<div class="node">
<a name="Differences-between-the-CFEngine-Nova-2.2-REST-API-and-the-CFEngine-Enterprise-3.0-API"></a>
<a name="Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Checking-Status">Checking Status</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Basic-Properties-of-the-API">Basic Properties of the API</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.2 Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</h3>

<ul class="menu">
<li><a accesskey="1" href="#Read-vs_002e-Read_002fWrite">Read vs. Read/Write</a>
<li><a accesskey="2" href="#Built_002din-Reports-vs_002e-Reporting-Engine">Built-in Reports vs. Reporting Engine</a>
<li><a accesskey="3" href="#Content_002dType">Content-Type</a>
<li><a accesskey="4" href="#New-Users">New Users</a>
<li><a accesskey="5" href="#Base-Path">Base Path</a>
<li><a accesskey="6" href="#Still-available">Still available</a>
<li><a accesskey="7" href="#Mission-Portal">Mission Portal</a>
</ul>

<!--  -->
<div class="node">
<a name="Read-vs.-Read%2fWrite"></a>
<a name="Read-vs_002e-Read_002fWrite"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Built_002din-Reports-vs_002e-Reporting-Engine">Built-in Reports vs. Reporting Engine</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>

</div>

<h4 class="subsection">8.2.1 Read vs. Read/Write</h4>

<p>The 2.2 API was read-only and users, roles and settings was managed by the Mission Portal. By contrast, the 3.0 API is read/write and completely standalone from the Mission Portal. In the CFEngine Enterprise 3.0, users, roles and settings belong in the API, and the Mission Portal uses this to determine access to data. Additionally, some other resources support PUT, POST and DELETE, but most data collected from agents are read-only.

<!--  -->
<div class="node">
<a name="Built-in-Reports-vs.-Reporting-Engine"></a>
<a name="Built_002din-Reports-vs_002e-Reporting-Engine"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Content_002dType">Content-Type</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Read-vs_002e-Read_002fWrite">Read vs. Read/Write</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>

</div>

<h4 class="subsection">8.2.2 Built-in Reports vs. Reporting Engine</h4>

<p>The 2.2 API provided an almost one-to-one correspondence between the reports in the Mission Portal and the API. One of the big changes in CFEngine Enterprise 3.0 is the advent of SQL reports. This is provided to the Mission Portal through the API, and you can use it too. You may issue both synchronous and asynchronous reporting requests, and optionally schedule reports to be received by email.

<!--  -->
<div class="node">
<a name="Content-Type"></a>
<a name="Content_002dType"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#New-Users">New Users</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Built_002din-Reports-vs_002e-Reporting-Engine">Built-in Reports vs. Reporting Engine</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>

</div>

<h4 class="subsection">8.2.3 Content-Type</h4>

<p>The 2.2 API has a HTTP content-type <code>application/vnd.cfengine.nova-v1+json</code>. In the 3.0 API the content-type is <code>application/vnd.cfengine.enterprise-v1+json</code>. This reflects a branding change away from Nova to Enterprise.

<!--  -->
<div class="node">
<a name="New-Users"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Base-Path">Base Path</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Content_002dType">Content-Type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>

</div>

<h4 class="subsection">8.2.4 New Users</h4>

<p>The 2.2 API used credentials from the Mission Portal database to authenticate and authorize users. These users have been moved into the Hub database and security has been strengthened. We are now using salted SHA256 passwords for the user table. Unfortunately, this means that internal users need to be recreated. The Mission Portal now relies on the API for authentication and authorization. This was partially done to support multi-hub installations.

<!--  -->
<div class="node">
<a name="Base-Path"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Still-available">Still available</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#New-Users">New Users</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>

</div>

<h4 class="subsection">8.2.5 Base Path</h4>

<p>The 2.2 API had a base path <code>/rest</code>. In the 3.0 API the base path is <code>/api</code>.

<!--  -->
<div class="node">
<a name="Still-available"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Portal">Mission Portal</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Base-Path">Base Path</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>

</div>

<h4 class="subsection">8.2.6 Still available</h4>

<p>In 3.0, the old 2.2 API is still available along side the new 3.0 API, so you can keep calling the old API if needed.

<!--  -->
<div class="node">
<a name="Mission-Portal"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Still-available">Still available</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>

</div>

<h4 class="subsection">8.2.7 Mission Portal</h4>

<p>Starting in 3.0, most of the API is exercised by the Mission Portal web-UI.

<!--  -->
<div class="node">
<a name="Checking-Status"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Managing-Settings">Managing Settings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.3 Checking Status</h3>

<p>You can get basic info about the API by issuing <i>GET /api</i>. This status information may also be useful if you contact support, as it gives some basic diagnostics.

   <p><b>Request</b>
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/
</pre>

   <p><b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1351154889
  },
  "data": [
    {
      "apiName": "CFEngine Enterprise API",
      "apiVersion": "v1",
      "enterpriseVersion": "3.0.0a1.81c0d4c",
      "coreVersion": "3.5.0a1.f3649b2",
      "databaseHostname": "127.0.0.1",
      "databasePort": 27017,
      "authenticated": "internal",
      "license": {
        "expires": 1391036400,
        "installTime": 1329578143,
        "owner": "Stage Environment",
        "granted": 20,
        "licenseUsage": {
          "lastMeasured": 1351122120,
          "samples": 1905,
          "minObservedLevel": 7,
          "maxObservedLevel": 30,
          "meanUsage": 21.9689,
          "meanCumulativeUtilization": 109.8446,
          "usedToday": 7
        }
      }
    }
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Managing-Settings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Managing-Users-and-Roles">Managing Users and Roles</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Checking-Status">Checking Status</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.4 Managing Settings</h3>

<ul class="menu">
<li><a accesskey="1" href="#Viewing-settings">Viewing settings</a>
<li><a accesskey="2" href="#Example-_002d-Configuring-LDAP">Example - Configuring LDAP</a>
<li><a accesskey="3" href="#Example-_002d-Configuring-Active-Directory">Example - Configuring Active Directory</a>
<li><a accesskey="4" href="#Example-_002d-Changing-The-Log-Level">Example - Changing The Log Level</a>
</ul>

<p>Most of the settings configurable in the API relate to LDAP authentication of users. Settings support two operations, <b>GET</b> (view settings) and <b>POST</b> (update settings). When settings are updated, they are sanity checked individually and as a whole. All or no settings will be updated for a request.

<!--  -->
<div class="node">
<a name="Viewing-settings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Configuring-LDAP">Example - Configuring LDAP</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Managing-Settings">Managing Settings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Settings">Managing Settings</a>

</div>

<h4 class="subsection">8.4.1 Viewing settings</h4>

<p><b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/settings
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1350992335
  },
  "data": [
    {
      "rbacEnabled": true,
      "ldapEnabled": false,
      "ldapActiveDirectoryDomain": "ad.cfengine.com",
      "ldapBaseDN": "DC=ad,DC=cfengine,DC=com",
      "ldapEncryption": "plain",
      "ldapHost": "ldap-server.cfengine.com",
      "ldapLoginAttribute": "sAMAccountName",
      "ldapMode": "activeDirectory",
      "ldapPassword": "password",
      "ldapPort": 389,
      "ldapPortSSL": 636,
      "ldapUsername": "test",
      "ldapUsersDirectory": "CN=Users",
      "blueHostHorizon": 900,
      "logLevel": "error"
    }
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Configuring-LDAP"></a>
<a name="Example-_002d-Configuring-LDAP"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Configuring-Active-Directory">Example - Configuring Active Directory</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Viewing-settings">Viewing settings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Settings">Managing Settings</a>

</div>

<h4 class="subsection">8.4.2 Example: Configuring LDAP</h4>

<p>The setting <b>ldapEnabled</b> turns external authentication on or off. When turned on, the API will check to see that the other LDAP related settings make sense, and attempt to authenticate using the configured credentials. If it is not successful in doing this, no settings will be changed. The API will notify you with a return code an a message describing the error.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/settings -X POST -d
{
  "ldapEnabled": true,
  "ldapActiveDirectoryDomain": "ad.cfengine.com",
  "ldapBaseDN": "DC=ad,DC=example,DC=com",
  "ldapEncryption": "ssl",
  "ldapHost": "ldap-server.cfengine.com",
  "ldapLoginAttribute": "sAMAccountName",
  "ldapMode": "standard",
  "ldapPassword": "password",
  "ldapUsername": "test",
  "ldapUsersDirectory": "ou",
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content

</pre>

<!--  -->
<div class="node">
<a name="Example---Configuring-Active-Directory"></a>
<a name="Example-_002d-Configuring-Active-Directory"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Changing-The-Log-Level">Example - Changing The Log Level</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Configuring-LDAP">Example - Configuring LDAP</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Settings">Managing Settings</a>

</div>

<h4 class="subsection">8.4.3 Example: Configuring Active Directory</h4>

<p>Active Directory is configured in much the same way as OpenLDAP, but the additional field <b>ldapActiveDirectoryDomain</b> is required. <b>ldapMode</b> is also changed from <i>standard</i> to <i>activeDirectory</i>.

   <p><b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/settings -X POST -d
{
  "ldapEnabled": true,
  "ldapBaseDN": "DC=example,DC=com",
  "ldapEncryption": "plain",
  "ldapHost": "ad-server.cfengine.com",
  "ldapLoginAttribute": "uid",
  "ldapMode": "activeDirectory",
  "ldapPassword": "password",
  "ldapUsername": "test",
  "ldapUsersDirectory": "CN=Users",
}
</pre>

   <p><b>Response</b>
<pre class="verbatim">204 No Content
</pre>

<!--  -->
<div class="node">
<a name="Example---Changing-The-Log-Level"></a>
<a name="Example-_002d-Changing-The-Log-Level"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Configuring-Active-Directory">Example - Configuring Active Directory</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Settings">Managing Settings</a>

</div>

<h4 class="subsection">8.4.4 Example: Changing The Log Level</h4>

<p>The API uses standard Unix syslog to log a number of events. Additionally, log events are sent to stderr, which means they may also end up in your Apache log. Log events are filtered based on the log level in settings. Suppose you wanted to have greater visibility into the processing done at the backend. The standard log level is <i>error</i>. Changing it to <i>info</i> is done as follows.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/settings -X POST -d
{
  "logLevel": "info"
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content
</pre>

<!--  -->
<div class="node">
<a name="Managing-Users-and-Roles"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Browsing-Host-Information">Browsing Host Information</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Managing-Settings">Managing Settings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.5 Managing Users and Roles</h3>

<ul class="menu">
<li><a accesskey="1" href="#Example-_002d-Listing-Users">Example - Listing Users</a>
<li><a accesskey="2" href="#Example-_002d-Creating-a-New-User">Example - Creating a New User</a>
<li><a accesskey="3" href="#Example-_002d-Updating-an-Existing-User">Example - Updating an Existing User</a>
<li><a accesskey="4" href="#Example-_002d-Retrieving-a-User">Example - Retrieving a User</a>
<li><a accesskey="5" href="#Example-_002d-Adding-a-User-to-a-Role">Example - Adding a User to a Role</a>
<li><a accesskey="6" href="#Example-_002d-Deleting-a-User">Example - Deleting a User</a>
<li><a accesskey="7" href="#Example-_002d-Creating-a-New-Role">Example - Creating a New Role</a>
</ul>

<p>Users and Roles determine who has access to what data from the API. Roles are defined by regular expressions that determine which hosts the user can see, and what policy outcomes are restricted.

<!--  -->
<div class="node">
<a name="Example---Listing-Users"></a>
<a name="Example-_002d-Listing-Users"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Creating-a-New-User">Example - Creating a New User</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Managing-Users-and-Roles">Managing Users and Roles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Users-and-Roles">Managing Users and Roles</a>

</div>

<h4 class="subsection">8.5.1 Example: Listing Users</h4>

<pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/user
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 2,
    "total": 2,
    "timestamp": 1350994249
  },
  "data": [
    {
      "id": "calvin",
      "external": true,
      "roles": [
        "Huguenots", "Marketing"
      ]
    },
    {
      "id": "quinester",
      "name": "Willard Van Orman Quine",
      "email": "noreply@@aol.com",
      "external": false,
      "roles": [
        "admin"
      ]
    }
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Creating-a-New-User"></a>
<a name="Example-_002d-Creating-a-New-User"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Updating-an-Existing-User">Example - Updating an Existing User</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Listing-Users">Example - Listing Users</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Users-and-Roles">Managing Users and Roles</a>

</div>

<h4 class="subsection">8.5.2 Example: Creating a New User</h4>

<p>All users will be created for the internal user table. The API will never attempt to write to an external LDAP server.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/user/snookie -X PUT -d
{
  "email": "snookie@mtv.com",
  "roles": [
    "HR"
  ]
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">201 Created
}

</pre>

<!--  -->
<div class="node">
<a name="Example---Updating-an-Existing-User"></a>
<a name="Example-_002d-Updating-an-Existing-User"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Retrieving-a-User">Example - Retrieving a User</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Creating-a-New-User">Example - Creating a New User</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Users-and-Roles">Managing Users and Roles</a>

</div>

<h4 class="subsection">8.5.3 Example: Updating an Existing User</h4>

<p>Both internal and external users may be updated. When updating an external users, the API will essentially annotate metadata for the user, it will never write to LDAP. Consequently, passwords may only be updated for internal users. Users may only update their own records, as authenticated by their user credentials.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/user/calvin -X POST -d
{
  "name": "Calvin",
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Retrieving-a-User"></a>
<a name="Example-_002d-Retrieving-a-User"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Adding-a-User-to-a-Role">Example - Adding a User to a Role</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Updating-an-Existing-User">Example - Updating an Existing User</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Users-and-Roles">Managing Users and Roles</a>

</div>

<h4 class="subsection">8.5.4 Example: Retrieving a User</h4>

<p>It is possible to retrieve data on a single user instead of listing everything. The following query is similar to issuing <i>GET /api/user?id=calvin</i>, with the exception that the previous query accepts a regular expression for <i>id</i>.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/user/calvin
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1350994249
  },
  "data": [
    {
      "id": "calvin",
      "name": "Calvin",
      "external": true,
      "roles": [
        "Huguenots", "Marketing"
      ]
    },
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Adding-a-User-to-a-Role"></a>
<a name="Example-_002d-Adding-a-User-to-a-Role"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Deleting-a-User">Example - Deleting a User</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Retrieving-a-User">Example - Retrieving a User</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Users-and-Roles">Managing Users and Roles</a>

</div>

<h4 class="subsection">8.5.5 Example: Adding a User to a Role</h4>

<p>Adding a user to a role is just an update operation on the user. The full role-set is updated, so if you are only appending a role, you may want to fetch the user data first, append the role and then update. The same approach is used to remove a user from a role.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/user/snookie -X POST -d
{
  "roles": [
    "HR", "gcc-contrib"
  ]
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Deleting-a-User"></a>
<a name="Example-_002d-Deleting-a-User"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Creating-a-New-Role">Example - Creating a New Role</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Adding-a-User-to-a-Role">Example - Adding a User to a Role</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Users-and-Roles">Managing Users and Roles</a>

</div>

<h4 class="subsection">8.5.6 Example: Deleting a User</h4>

<p>Users can only be deleted from the internal users table.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/user/snookie -X DELETE
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content
</pre>

<!--  -->
<div class="node">
<a name="Example---Creating-a-New-Role"></a>
<a name="Example-_002d-Creating-a-New-Role"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Deleting-a-User">Example - Deleting a User</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Managing-Users-and-Roles">Managing Users and Roles</a>

</div>

<h4 class="subsection">8.5.7 Example: Creating a New Role</h4>

<p>Once you've learned how to manage users, managing roles is pretty much the same thing. Roles are defined by four fields that filter host data and policy data: <b>includeContext</b>, <b>excludeContext</b>, <b>includeBundles</b>, <b>excludeBundles</b>. Each field is a comma separated list of regular expressions. See the corresponding section on RBAC for an explanation of these fields. Updating, and deleting roles are similar to updating and deleting users, using POST and DELETE.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/user/solaris-admins -X PUT -d
{
  "email": "snookie@mtv.com",
  "roles": [
    "description": "Users managing 64-bit Solaris boxes",
    "includeContext": "solaris,x86_64",
  ]
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content
</pre>

<!--  -->
<div class="node">
<a name="Browsing-Host-Information"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SQL-Queries">SQL Queries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Managing-Users-and-Roles">Managing Users and Roles</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.6 Browsing Host Information</h3>

<ul class="menu">
<li><a accesskey="1" href="#Example-_002d-Listing-Hosts-With-A-Given-Context">Example - Listing Hosts With A Given Context</a>
<li><a accesskey="2" href="#Example-_002d-Looking-Up-Hosts-By-Hostname">Example - Looking Up Hosts By Hostname</a>
<li><a accesskey="3" href="#Example-_002d-Looking-Up-Hosts-By-IP">Example - Looking Up Hosts By IP</a>
<li><a accesskey="4" href="#Example-_002d-Removing-Host-Data">Example - Removing Host Data</a>
<li><a accesskey="5" href="#Example-_002d-Listing-Available-Vital-Signs-For-A-Host">Example - Listing Available Vital Signs For A Host</a>
<li><a accesskey="6" href="#Example-_002d-Retrieving-Vital-Sign-Data">Example - Retrieving Vital Sign Data</a>
</ul>

<p>A resource <i>/api/host</i> is added as an alternative interface for browsing host information. For full flexibility we recommend using SQL reports via <i>/api/query</i> for this, however, currently vital signs (data gathered from cf-monitord) is not part of the SQL reports data model.

<!--  -->
<div class="node">
<a name="Example---Listing-Hosts-With-A-Given-Context"></a>
<a name="Example-_002d-Listing-Hosts-With-A-Given-Context"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Looking-Up-Hosts-By-Hostname">Example - Looking Up Hosts By Hostname</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Browsing-Host-Information">Browsing Host Information</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Browsing-Host-Information">Browsing Host Information</a>

</div>

<h4 class="subsection">8.6.1 Example: Listing Hosts With A Given Context</h4>

<pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/host?context-include=windows.*
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 2,
    "total": 2,
    "timestamp": 1350997528
  },
  "data": [
    {
      "id": "1c8fafe478e05eec60fe08d2934415c81a51d2075aac27c9936e19012d625cb8",
      "hostname": "windows2008-2.test.cfengine.com",
      "ip": "172.20.100.43"
    },
    {
      "id": "dddc95486d97e4308f164ddc1fdbbc133825f35254f9cfbd59393a671015ab99",
      "hostname": "windows2003-2.test.cfengine.com",
      "ip": "172.20.100.42"
    }
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Looking-Up-Hosts-By-Hostname"></a>
<a name="Example-_002d-Looking-Up-Hosts-By-Hostname"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Looking-Up-Hosts-By-IP">Example - Looking Up Hosts By IP</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Listing-Hosts-With-A-Given-Context">Example - Listing Hosts With A Given Context</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Browsing-Host-Information">Browsing Host Information</a>

</div>

<h4 class="subsection">8.6.2 Example: Looking Up Hosts By Hostname</h4>

<p>Contexts are powerful, as you can use them to categorize hosts according to a rich set of tags. For example, each host is automatically tagged with a canonicalized version of its hostname and IP-address. So we could lookup the host with hostname <i>windows2003-2.test.cfengine.com</i> as follows (lines split and indented for presentability).

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/host?context-include=
   windows2003_2_stage_cfengine_com
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1350997528
  },
  "data": [
    {
      "id": "dddc95486d97e4308f164ddc1fdbbc133825f35254f9cfbd59393a671015ab99",
      "hostname": "windows2003-2.test.cfengine.com",
      "ip": "172.20.100.42"
    }
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Looking-Up-Hosts-By-IP"></a>
<a name="Example-_002d-Looking-Up-Hosts-By-IP"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Removing-Host-Data">Example - Removing Host Data</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Looking-Up-Hosts-By-Hostname">Example - Looking Up Hosts By Hostname</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Browsing-Host-Information">Browsing Host Information</a>

</div>

<h4 class="subsection">8.6.3 Example: Looking Up Hosts By IP</h4>

<p>Similarly we can lookup the host with hostname <i>windows2008-2.test.cfengine.com</i> by IP as follows (lines split and indented for presentability).

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/host?
   context-include=172_20_100_43
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1350997528
  },
  "data": [
    {
      "id": "1c8fafe478e05eec60fe08d2934415c81a51d2075aac27c9936e19012d625cb8",
      "hostname": "windows2008-2.stage.cfengine.com",
      "ip": "172.20.100.43"
    }
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Removing-Host-Data"></a>
<a name="Example-_002d-Removing-Host-Data"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Listing-Available-Vital-Signs-For-A-Host">Example - Listing Available Vital Signs For A Host</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Looking-Up-Hosts-By-IP">Example - Looking Up Hosts By IP</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Browsing-Host-Information">Browsing Host Information</a>

</div>

<h4 class="subsection">8.6.4 Example: Removing Host Data</h4>

<p>If a host has been decommissioned from a Hub, we can explicitly remove data associated with the host from the Hub, by issuing a DELETE request (lines split and indented for presentability).

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/host/
   1c8fafe478e05eec60fe08d2934415c81a51d2075aac27c9936e19012d625cb8 -X DELETE
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content
</pre>

<!--  -->
<div class="node">
<a name="Example---Listing-Available-Vital-Signs-For-A-Host"></a>
<a name="Example-_002d-Listing-Available-Vital-Signs-For-A-Host"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-_002d-Retrieving-Vital-Sign-Data">Example - Retrieving Vital Sign Data</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Removing-Host-Data">Example - Removing Host Data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Browsing-Host-Information">Browsing Host Information</a>

</div>

<h4 class="subsection">8.6.5 Example: Listing Available Vital Signs For A Host</h4>

<p>Each host record on the Hub has a set of vital signs collected by cf-monitord on the agent. We can view the list of vitals signs from as host as follows (lines split and indented for presentability).

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/host/
   4e913e2f5ccf0c572b9573a83c4a992798cee170f5ee3019d489a201bc98a1a/vital
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 4,
    "total": 4,
    "timestamp": 1351001799
  },
  "data": [
    {
      "id": "messages",
      "description": "New log entries (messages)",
      "units": "entries",
      "timestamp": 1351001400
    },
    {
      "id": "mem_swap",
      "description": "Total swap size",
      "units": "megabytes",
      "timestamp": 1351001400
    },
    {
      "id": "mem_freeswap",
      "description": "Free swap size",
      "units": "megabytes",
      "timestamp": 1351001400
    },
    {
      "id": "mem_free",
      "description": "Free system memory",
      "units": "megabytes",
      "timestamp": 1351001400
    },
}
</pre>

<!--  -->
<div class="node">
<a name="Example---Retrieving-Vital-Sign-Data"></a>
<a name="Example-_002d-Retrieving-Vital-Sign-Data"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Example-_002d-Listing-Available-Vital-Signs-For-A-Host">Example - Listing Available Vital Signs For A Host</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Browsing-Host-Information">Browsing Host Information</a>

</div>

<h4 class="subsection">8.6.6 Example: Retrieving Vital Sign Data</h4>

<p>Each vital sign has a collected time series of values for up to one week. Here we retrieve the time series for the <i>mem_free</i> vital sign at host <i>4e913e2f5ccf0c572b9573a83c4a992798cee170f5ee3019d489a201bc98a1a</i> for October 23rd 2012 12:20pm to 12:45pm GMT (lines split and indented for presentability).

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl --user admin:admin http://test.cfengine.com/api/host/
   4e913e2f5ccf0c572b9573a83c4a992798cee170f5ee3019d489a201bc98a1a/
   vital/mem_free?from=1350994800&amp;to=1350996300
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">"meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1351002265
  },
  "data": [
    {
      "id": "mem_free",
      "description": "Free system memory",
      "units": "megabytes",
      "timestamp": 1351001700,
      "values": [
        [
          1350994800,
          36.2969
        ],
        [
          1350995100,
          36.2969
        ],
        [
          1350995400,
          36.2969
        ],
        [
          1350995700,
          36.2969
        ],
        [
          1350996000,
          36.1758
        ],
        [
          1350996300,
          36.2969
        ]
      ]
    }
  ]

</pre>

<!--  -->
<div class="node">
<a name="SQL-Queries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#API-Reference">API Reference</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Browsing-Host-Information">Browsing Host Information</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.7 SQL Queries</h3>

<ul class="menu">
<li><a accesskey="1" href="#Synchronous-Queries">Synchronous Queries</a>
<li><a accesskey="2" href="#Asynchronous-Queries">Asynchronous Queries</a>
<li><a accesskey="3" href="#Subscribed-Queries">Subscribed Queries</a>
</ul>

<p>The standard way of creating reports in CFEngine Enterprise 3.0 is with SQL queries. See the chapter on SQL queries for an explanation. The API has a few ways of creating a report.

     <ul>
<li>Synchronous query, where we issue a query and wait for the table to be sent back with the response. 
<li>Asynchronous query, where we get a response immediately with an id that we can later query to download the report. 
<li>Subscribed query, where we specify a query to be run on a schedule and have the result emailed to someone. 
</ul>

<!--  -->
<div class="node">
<a name="Synchronous-Queries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Asynchronous-Queries">Asynchronous Queries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SQL-Queries">SQL Queries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#SQL-Queries">SQL Queries</a>

</div>

<h4 class="subsection">8.7.1 Synchronous Queries</h4>

<p>Issuing a synchronous query is the most straight forward way of running an SQL query. We simply issue the query and wait for a result to come back.

<h5 class="subsubsection">8.7.1.1 Example: Listing Hostname and IP for Ubuntu Hosts</h5>

<pre class="sp">

</pre>
<b>Request</b> (lines split and indented for presentability)
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/query -X POST -d
{
  "query": "SELECT Hosts.HostName, Hosts.IPAddress FROM Hosts JOIN Contexts 
     ON Hosts.Hostkey = Contexts.HostKey WHERE Contexts.ContextName = \"ubuntu\""
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1351003514
  },
  "data": [
    {
      "query": "SELECT Hosts.HostName, Hosts.IPAddress FROM Hosts JOIN Contexts ON 
          Hosts.Hostkey = Contexts.HostKey WHERE Contexts.ContextName = \"ubuntu\"",
      "header": [
        "HostName",
        "IPAddress"
      ],
      "rowCount": 3,
      "rows": [
        [
          "ubuntu10-2.stage.cfengine.com",
          "172.20.100.1"
        ],
        [
          "ubuntu10-3.stage.cfengine.com",
          "172.20.100.2"
        ],
        [
          "ubuntu10-4.stage.cfengine.com",
          "172.20.100.3"
        ]
      ],
      "cached": false,
      "sortDescending": false
    }
  ]
}
</pre>

   <p>The <b>cached</b> and <b>sortDescending</b> fields here mean that the the result was not retrieved from cache, and that post-processing sorting was not applied. It is also possible to specify <b>skip</b> and <b>limit</b> fields that will be applied to the result set after it is returned by the SQL engine. These fields are mainly used by the Mission Portal to paginate quickly on already processed queries.

<!--  -->
<div class="node">
<a name="Asynchronous-Queries"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Subscribed-Queries">Subscribed Queries</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Synchronous-Queries">Synchronous Queries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#SQL-Queries">SQL Queries</a>

</div>

<h4 class="subsection">8.7.2 Asynchronous Queries</h4>

<p>Because some queries may take some time to compute, it is possible to fire off a query and check the status of it later. This is useful for dumping a lot of data into CSV files for example. The sequence consists of three steps.

     <ol type=1 start=1>
<li>Issue the asynchronous query and get a job id
<li>Check status of processing using the id
<li>When the query is completed, get a download link using the id
        </ol>

<h5 class="subsubsection">8.7.2.1 Issuing The Query</h5>

<p><b>Request</b>
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/query/async -X POST -d
{
  "query": "SELECT Hosts.HostName, Hosts.IPAddress FROM Hosts JOIN Contexts ON Hosts.Hostkey = Contexts.HostKey WHERE Contexts.ContextName = \"ubuntu\""
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b> (lines split and indented for presentability)
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1351003514
  },
  "data": [
    {
      "id": "32ecb0a73e735477cc9b1ea8641e5552",
      "query": "SELECT Hosts.HostName, Hosts.IPAddress FROM Hosts JOIN Contexts ON 
          Hosts.Hostkey = Contexts.HostKey WHERE Contexts.ContextName = \"ubuntu\""
    }
  ]
]
</pre>

<h5 class="subsubsection">8.7.2.2 Checking Status</h5>

<p><b>Request</b>
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/query/async/:id
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1351003514
  },
  "data": [
    {
      "id": "32ecb0a73e735477cc9b1ea8641e5552",
      "percentageComplete": 42,
    ]
}
</pre>

<h5 class="subsubsection">8.7.2.3 Getting The Completed Report</h5>

<p>This is the same API call as checking the status. Eventually, the <b>percentageComplete</b> field will reach 100 and there will be a link to the completed report available for downloading.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/query/async/:id
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1351003514
  },
  "data": [
    {
      "id": "32ecb0a73e735477cc9b1ea8641e5552",
      "percentageComplete": 100,
      "href": "https://test.cfengine.com/api/static/32ecb0a73e735477cc9b1ea8641e5552.csv"
    }
  ]
}
</pre>

<!--  -->
<div class="node">
<a name="Subscribed-Queries"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Asynchronous-Queries">Asynchronous Queries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#SQL-Queries">SQL Queries</a>

</div>

<h4 class="subsection">8.7.3 Subscribed Queries</h4>

<p>Subscribed queries happen in the context of a user. Any user can create a query on a schedule and have it email to someone.

<h5 class="subsubsection">8.7.3.1 Example: Creating A Subscribed Query</h5>

<p>Here we create a new query to count file changes by name and have the result sent to us by email. The schedule field is any CFEngine context expression. The backend polls subscriptions in a loop and checks whether it's time to generate a report and send it out. In the following example, user <i>milton</i> creates a new subscription to a report which he names <i>file-changes-report</i>, which will be sent out every Monday night. His boss will get an email with a link to a PDF version of the report.

   <pre class="sp">

</pre>
<b>Request</b> (lines split and indented for presentability)
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/user/milton/
   subscription/query/file-changes-report -X PUT -d
{
  "to": "boss@megaco.com",
  "query": "SELECT Name Count(1) FROM FileChanges GROUP BY Name",
  "schedule": "Monday.Hr23.Min59",
  "title": "A very important file changes report"
  "description": "Text that will be included in email"
  "outputTypes": [ "pdf" ]
}
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content

</pre>

<h5 class="subsubsection">8.7.3.2 Example: Listing Report Subscriptions</h5>

<p>Milton can list all his current subscriptions by issuing the following.

   <pre class="sp">

</pre>
<b>Request</b>
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/user/milton/subscription/query
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">{
  "meta": {
    "page": 1,
    "count": 1,
    "total": 1,
    "timestamp": 1351003514
  },
  "data": [
    {
      "id": "file-changes-report"
      "to": "boss@megaco.com",
      "query": "SELECT Name Count(1) FROM FileChanges GROUP BY Name",
      "title": "A very important file changes report"
      "description": "Text that will be included in email"
      "schedule": "Monday.Hr23.Min59",
      "outputTypes": [ "pdf" ]
    }
]
</pre>

<h5 class="subsubsection">8.7.3.3 Example: Removing A Report Subscription</h5>

<p><b>Request</b> (lines split and indented for presentability)
<pre class="verbatim">curl -k --user admin:admin https://test.cfengine.com/api/user/milton/
   subscription/query/file-changes-report -X DELETE
</pre>

   <pre class="sp">

</pre>
<b>Response</b>
<pre class="verbatim">204 No Content
</pre>

<!--  -->
<div class="node">
<a name="API-Reference"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#SQL-Queries">SQL Queries</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#REST-API">REST API</a>

</div>

<h3 class="section">8.8 API Reference</h3>

<ul class="menu">
<li><a accesskey="1" href="#g_t_002fapi">/api</a>
<li><a accesskey="2" href="#g_t_002fapi_002fsettings">/api/settings</a>
<li><a accesskey="3" href="#g_t_002fapi_002fuser">/api/user</a>
<li><a accesskey="4" href="#g_t_002fapi_002fuser_002fid">/api/user/id</a>
<li><a accesskey="5" href="#g_t_002fapi_002frole">/api/role</a>
<li><a accesskey="6" href="#g_t_002fapi_002frole_002fid">/api/role/id</a>
<li><a accesskey="7" href="#g_t_002fapi_002fhost">/api/host</a>
<li><a accesskey="8" href="#g_t_002fapi_002fhost_002fhost_002did">/api/host/host-id</a>
<li><a accesskey="9" href="#g_t_002fapi_002fhost_002fhost_002did_002fcontext">/api/host/host-id/context</a>
<li><a href="#g_t_002fapi_002fhost_002fhost_002did_002fcontext_002fcontext_002did">/api/host/host-id/context/context-id</a>
<li><a href="#g_t_002fapi_002fhost_002fhost_002did_002fvital">/api/host/host-id/vital</a>
<li><a href="#g_t_002fapi_002fpromise">/api/promise</a>
<li><a href="#g_t_002fapi_002fpromise_002fpromise_002did">/api/promise/promise-id</a>
<li><a href="#g_t_002fapi_002fquery">/api/query</a>
<li><a href="#g_t_002fapi_002fquery_002fasync">/api/query/async</a>
<li><a href="#g_t_002fapi_002fquery_002fasync_002fasync_002dquery_002did">/api/query/async/async-query-id</a>
</ul>

<!--  -->
<div class="node">
<a name="%2fapi"></a>
<a name="g_t_002fapi"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fsettings">/api/settings</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#API-Reference">API Reference</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.1 /api</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>
   <pre class="sp">

</pre>
<i>Fields</i>:
     <ul>
<li><b>apiName</b> <i>(string)</i> Human-friendly API name. 
<li><b>apiVersion</b> <i>(string)</i> API version string. 
<li><b>enterpriseVersion</b> <i>(string)</i> Version of the CFEngine Enterprise build. 
<li><b>coreVersion</b> <i>(string)</i> The version of CFEngine Core (Community) the Enterprise version was built against. 
<li><b>databaseHostname</b> <i>(string)</i> Hostname (or IP) of the database the API is connected to. 
<li><b>databasePort</b> <i>(integer)</i> Port number of the database the API is connected to. 
<li><b>authenticated</b> <i>("internal", "external")</i>, Whether the request was authenticated using the internal users table or an external source. 
<li><b>license.expires</b> <i>(integer)</i> Time when the license expires. 
<li><b>license.installTime</b> <i>(integer)</i> Time when the license was installed. 
<li><b>license.owner</b> <i>(string)</i> The name of the license owner. 
<li><b>license.granted</b> <i>(integer)</i> Host number capacity granted by the license. 
<li><b>license.licenseUsage.lastMeasured</b> <i>(integer)</i> Time when license usage was last updated. 
<li><b>license.licenseUsage.samples</b> <i>(integer)</i> Number of samples collected for license usage. 
<li><b>license.licenseUsage.minObservedLevel</b> <i>(integer)</i> Minimum number of observed host licenses in use. 
<li><b>license.licenseUsage.minObservedLevel</b> <i>(integer)</i> Maximum number of observed host licenses in use. 
<li><b>license.licenseUsage.meanUsage</b> <i>(integer)</i> Average number of observed host licenses in use. 
<li><b>license.licenseUsage.meanCumulativeUtilization</b> <i>(integer)</i> (not sure)
<li><b>license.licenseUsage.usedToday</b> <i>(integer)</i> Total number of host licenses observed used today. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fsettings"></a>
<a name="g_t_002fapi_002fsettings"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fuser">/api/user</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi">/api</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.2 /api/settings</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>, <b>POST</b>
   <pre class="sp">

</pre>
<i>Fields</i>:
     <ul>
<li><b>rbacEnabled</b> <i>(boolean)</i> Whether RBAC is applied to requests. 
<li><b>ldapEnabled</b> <i>(boolean)</i> Whether external authentication is activated. 
<li><b>activeDirectoryDomain</b> <i>(string)</i> AD domain to use if AD is enabled in <b>ldapMode</b>. 
<li><b>ldapBaseDN</b> <i>(string)</i> LDAP BaseDN to use for external LDAP requests. 
<li><b>ldapEncryption</b> <i>("plain", "ssl", "tls")</i> Type of LDAP binding to establish to external LDAP server. (Default: "plain"). 
<li><b>ldapHost</b> <i>(string)</i> Hostname of external LDAP server. 
<li><b>ldapMode</b> <i>("standard", "activeDirectory")</i> Type of LDAP server to use. "standard" is effectively OpenLDAP. (Default: "standard"). 
<li><b>ldapLoginAttribute</b> <i>(string)</i> LDAP attribute to use for usernames. (default: "uid"). 
<li><b>ldapUsername</b> <i>(string)</i> LDAP username. 
<li><b>ldapPassword</b> <i>(string)</i> LDAP password. 
<li><b>ldapUsersDirectory</b> <i>(string)</i> Attribute and value to qualify the directory in which to look up users, e.g. "ou=people". 
<li><b>ldapPort</b> <i>(integer)</i> Port for external LDAP connections not using SSL. (default 389). 
<li><b>ldapPort</b> <i>(integer)</i> Port for external LDAP connections using SSL. (default 636). 
<li><b>blueHostHorizon</b> <i>(integer)</i> Time interval (seconds) for when to consider a host unreachable. (default 900). 
<li><b>logLevel</b> <i>("emergency", "alert", "critical", "error", "warning", "notice", "info", "debug")</i> Syslog filter specifying the severity level at which messages produced by the API should be emitted to syslog and apache.log. (default: error). 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fuser"></a>
<a name="g_t_002fapi_002fuser"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fuser_002fid">/api/user/id</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fsettings">/api/settings</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.3 /api/user</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>
   <pre class="sp">

</pre>
<i>Query Parameters</i>:
     <ul>
<li><b>id</b> <i>(regex string)</i> Regular expression for filtering usernames. 
<li><b>external</b> <i>("true", "false")</i> Returns only internal users (false) or only external (true), or all if not specified. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fuser%2fid"></a>
<a name="g_t_002fapi_002fuser_002fid"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002frole">/api/role</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fuser">/api/user</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.4 /api/user/:id</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>, <b>PUT</b>, <b>POST</b>, <b>DELETE</b>
   <pre class="sp">

</pre>
<i>Fields</i>:
     <ul>
<li><b>id</b> <i>(string)</i> ID of a user. 
<li><b>password</b> <i>(string)</i> Password of a user. (Never returned from API). 
<li><b>email</b> <i>(string)</i> Email address associated with user. 
<li><b>roles</b> <i>(array of strings)</i> Set of IDs of roles a user is in. (Default: empty)
<li><b>external</b> <i>(boolean)</i> Whether or not the user was found externally (LDAP). 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2frole"></a>
<a name="g_t_002fapi_002frole"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002frole_002fid">/api/role/id</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fuser_002fid">/api/user/id</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.5 /api/role</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>

<!--  -->
<div class="node">
<a name="%2fapi%2frole%2fid"></a>
<a name="g_t_002fapi_002frole_002fid"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fhost">/api/host</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002frole">/api/role</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.6 /api/role/:id</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>, <b>PUT</b>, <b>POST</b>, <b>DELETE</b>
   <pre class="sp">

</pre>
<i>Fields</i>:
     <ul>
<li><b>id</b> <i>(string)</i> ID of a role. 
<li><b>description</b> <i>(string)</i> Arbitrary text describing the role
<li><b>includeContext</b> <i>(comma delimited string of regular expression strings)</i> Includes hosts visible to the users in the role. 
<li><b>excludeContext</b> <i>(comma delimited string of regular expression strings)</i> Excludes bundles visible to the users in the role. 
<li><b>includeBundles</b> <i>(comma delimited string of regular expression strings)</i> Includes bundles visible to the users in the role. 
<li><b>excludeBundles</b> <i>(comma delimited string of regular expression strings)</i> Excludes bundles visible to the users in the role. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fhost"></a>
<a name="g_t_002fapi_002fhost"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fhost_002fhost_002did">/api/host/host-id</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002frole_002fid">/api/role/id</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.7 /api/host</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>
   <pre class="sp">

</pre>
<i>Query Parameters</i>:
     <ul>
<li><b>include-context</b> <i>(comma delimited string of regular expression strings)</i> Includes hosts having context matching the expression. 
<li><b>exclude-context</b> <i>(comma delimited string of regular expression strings)</i> Excludes hosts having context matching the expression. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fhost%2fhost-id"></a>
<a name="g_t_002fapi_002fhost_002fhost_002did"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fhost_002fhost_002did_002fcontext">/api/host/host-id/context</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fhost">/api/host</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.8 /api/host/:host-id</h4>

     <ul>
<li><b>id</b> <i>(string)</i> ID of a host. 
<li><b>hostname</b> <i>(string)</i> Hostname of a host. 
<li><b>ip</b> <i>(string)</i> IP address of a host. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fhost%2fhost-id%2fcontext"></a>
<a name="g_t_002fapi_002fhost_002fhost_002did_002fcontext"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fhost_002fhost_002did_002fcontext_002fcontext_002did">/api/host/host-id/context/context-id</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fhost_002fhost_002did">/api/host/host-id</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.9 /api/host/:host-id/context</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>

<!--  -->
<div class="node">
<a name="%2fapi%2fhost%2fhost-id%2fcontext%2fcontext-id"></a>
<a name="g_t_002fapi_002fhost_002fhost_002did_002fcontext_002fcontext_002did"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fhost_002fhost_002did_002fvital">/api/host/host-id/vital</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fhost_002fhost_002did_002fcontext">/api/host/host-id/context</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.10 /api/host/:host-id/context/:context-id</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>
   <pre class="sp">

</pre>
<i>Fields</i>:
     <ul>
<li><b>id</b> <i>(string)</i> ID of a context (class name)
<li><b>mean</b> <i>(real)</i> Occurrence probability of the context in an agent run. 
<li><b>stdv</b> <i>(real)</i> Standard deviation of occurrence probability. 
<li><b>timestamp</b> <i>(integer</i>) Last time context was activated on agent. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fhost%2fhost-id%2fvital"></a>
<a name="g_t_002fapi_002fhost_002fhost_002did_002fvital"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fpromise">/api/promise</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fhost_002fhost_002did_002fcontext_002fcontext_002did">/api/host/host-id/context/context-id</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.11 /api/host/:host-id/vital</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>

<h5 class="subsubsection">8.8.11.1 /api/host/:host-id/vital/:vital-id</h5>

<p><i>Supported Operations</i>:<br>
<b>GET</b>
   <pre class="sp">

</pre>
<i>Query Parameters</i>:
     <ul>
<li><b>from</b> <i>(integer)</i> Timestamp marking the start of the interval for which to fetch data. Data is only available going back one week. 
<li><b>to</b> <i>(integer)</i> End of data interval to be fetched. 
</ul>

   <pre class="sp">

</pre>
<i>Fields</i>:
     <ul>
<li><b>id</b> <i>(string)</i> ID of vital sign. 
<li><b>description</b> <i>(string)</i> Description of vital sign. 
<li><b>units</b> <i>(string)</i> Measurement unit of vital sign. 
<li><b>timestamp</b> <i>(integer)</i> Timestamp of the last received data point. 
<li><b>values</b> <i>(array of [ t, y ], where t is the sample timestamp)</i> Vital sign data. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fpromise"></a>
<a name="g_t_002fapi_002fpromise"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fpromise_002fpromise_002did">/api/promise/promise-id</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fhost_002fhost_002did_002fvital">/api/host/host-id/vital</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.12 /api/promise</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>

<!--  -->
<div class="node">
<a name="%2fapi%2fpromise%2fpromise-id"></a>
<a name="g_t_002fapi_002fpromise_002fpromise_002did"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fquery">/api/query</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fpromise">/api/promise</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.13 /api/promise/:promise-id</h4>

<p><i>Supported Operations</i>:<br>
<b>GET</b>
   <pre class="sp">

</pre>
<i>Fields</i>:
     <ul>
<li><b>id</b> <i>(string)</i> Promise handle. 
<li><b>type</b> <i>(string)</i> Promise type. 
<li><b>promiser</b> <i>(string)</i> Promiser of the promise. 
<li><b>promisees</b> <i>(array of strings)</i> A list of promisees of the promise. 
<li><b>bundle</b> <i>(string)</i> The bundle this promise belongs to
<li><b>comment</b> <i>(string)</i> Associated comment for the promise. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fquery"></a>
<a name="g_t_002fapi_002fquery"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fquery_002fasync">/api/query/async</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fpromise_002fpromise_002did">/api/promise/promise-id</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.14 /api/query</h4>

<p><i>Supported Operations</i>:<br>

   <b>POST</b>

<p class="noindent"><i>Fields</i>:
     <ul>
<li><b>query</b> <i>(string)</i> SQL query string. 
<li><b>sortColumn</b> <i>(string)</i> Column on which to sort results. This is applied to the result of the SQL query and can be considered post processing. The Mission Portal uses this to sort cached reports. 
<li><b>sortDescending</b> <i>(bool)</i> Apply post-sorting descendingly. 
<li><b>skip</b> <i>(integer)</i> Number of results to skip for the processed query. The Mission Portal uses this for pagination on cached results. 
<li><b>limit</b> <i>(integer)</i> Limit the number of results in the processed query. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fquery%2fasync"></a>
<a name="g_t_002fapi_002fquery_002fasync"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#g_t_002fapi_002fquery_002fasync_002fasync_002dquery_002did">/api/query/async/async-query-id</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fquery">/api/query</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.15 /api/query/async</h4>

<p><i>Supported Operations</i>:<br>

   <b>POST</b>

<p class="noindent"><i>Fields</i>:
     <ul>
<li><b>query</b> <i>(string)</i> SQL query string. 
<li><b>id</b> <i>(string)</i> ID of the query job. 
<li><b>error</b> <i>(string)</i> Error if anything went wrong. 
</ul>

<!--  -->
<div class="node">
<a name="%2fapi%2fquery%2fasync%2fasync-query-id"></a>
<a name="g_t_002fapi_002fquery_002fasync_002fasync_002dquery_002did"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#g_t_002fapi_002fquery_002fasync">/api/query/async</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#API-Reference">API Reference</a>

</div>

<h4 class="subsection">8.8.16 /api/query/async/:async-query-id</h4>

<p><i>Supported Operations</i>:<br>

   <b>GET</b>, <b>DELETE</b>

<p class="noindent"><i>Fields</i>:
     <ul>
<li><b>id</b> <i>(string)</i> ID of the query job. 
<li><b>percentageComplete</b> <i>(integer)</i> Processing status for the query. 
<li><b>href</b> <i>(string)</i> Download link for the finished report. 
<li><b>error</b> <i>(string)</i> Error if anything went wrong. 
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Call-Collect"></a>
<a name="Call_002dCollect"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Monitoring-extensions">Monitoring extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#REST-API">REST API</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">9 Call-Collect</h2>

<p>CFEngine Enterprise 3.0 includes functionality to allow report collection from hosts that are not directly addressable from a hub data-aggregation process. For example, if some of the clients of a policy hub are behind a network address translator (NAT) then the hub is not able to open a channel to address them directly. Another example is if a firewall denies a two-way initiation of communication between a satellite client and the hub. To remedy this problem the clients can place a 'collect call' with the policy hub.

   <p>What happens is that the client's <code>cf-serverd</code> will 'peer' with the server daemon on a policy hub. This means that <code>cf-serverd</code> on an unreachable (e.g. NATed) host will attempt to report in to the <code>cf-serverd</code> on its assigned policy hub and offer it a short time window in which to download reports over the established connection. The effect is to establish a temporary secure tunnel between hosts, initiated from the satellite host end. The connection is made in such a way that host autonomy is not compromised. Either the hub may refuse or decline to play their role at any time, in the usual way (avoiding DOS attacks). Normal access controls must be set for communication in both directions.

   <p>Collect calling cannot be as efficient as data collection by the <code>cf-hub</code> component, as the hub is not able to load balance.  Hosts that use this approach should exclude themselves from the <code>cf-hub</code> data collection.

   <p>The sequence of events is this:

     <ul>
<li>Satellite <code>cf-serverd</code> connects to its registered policy hub
<li>The satellite identifies itself to authentication and access control
and sends a collect-call 'pull' request to the hub
<li>The hub might honor this, if the access control grants access. 
<li>If access is granted, the hub has <code>collect_window</code> seconds
to initiate a query to the satellite for its reports. 
<li>The policy hub identifies itself to authentication and access control
and sends a query request to the satellite to collect the reports. 
<li>When finished the satellite closes the tunnel. 
</ul>

   <p>Call-collect is put in action if <code>call_collect_interval</code> is set. It causes the server daemon to attempt a connection to its policy hub at regular intervals equal to the value of the parameter in minutes:

<pre class="verbatim">
   call_collect_interval => "5";

</pre>

<p class="noindent">The full configuration would look something like this
<pre class="verbatim">
#########################################################
# Server config
#########################################################

body server control

{
  allowconnects         => { "10.10.10" , "::1" };
  allowallconnects      => { "10.10.10" , "::1" };
  trustkeysfrom         => { "10.10.10" , "::1" };

  call_collect_interval => "5";
}

#########################################################

bundle server access_rules()

{
access:

  policy_hub::

    "collect_calls"
       resource_type => "query",
             admit   => { "10.10.10" }; # the apparent NAT address of the satellite

  satellite_hosts::

    "delta"
            comment => "Grant access to cfengine hub to collect report deltas",
      resource_type => "query",
            admit   => { "policy_hub" };

    "full"
            comment => "Grant access to cfengine hub to collect full report dump",
      resource_type => "query",
            admit   => { "policy_hub"  };
}

</pre>

   <p>You also have to make sure that any firewalls allow these connections to pass.

   <p>In addition you should choose a <i>Host Identifier</i> in the Mission Portal, see <a href="#Host-Identifier">Host Identifier</a>. This is the attribute by which the hosts will be identified in views and reports.

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Monitoring-extensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Call_002dCollect">Call-Collect</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">10 Monitoring extensions</h2>

<p>CFEngine Enterprise incorporates a lightweight monitoring agent, whose aim
is to provide meaningful performance data about systems, in a scalable
fashion.  CFEngine Enterprise does not aim to replace specialized
rapid-update monitoring and alarm systems; it provides a context-aware
summary of current state that is always displayed in relation to
previous system behavior, for comparison. The aim is to offer useful
analytics rather than jump-to alarms.

   <p>CFEngine's monitoring component <code>cf-monitord</code> records a number of
performance data about the system by default. These include process
counts, service traffic, load average and CPU utilization and
temperature when available.  In the Community Edition, data are
only collected and stored for personal use, but users have to work to see
results.  CFEngine Enterprise improves on this in three ways.

     <ul>
<li>Data collected from the monitoring system are integrated into
the aggregate knowledge console.

     <li>It adds a three year life-cycle trend summary, based on
`shift'-averages.

     <li>It adds customizable promises to monitor or
log specific highly specific user data through the generic promise
interface.

   </ul>

   <p>The end result is to display time series traces of system performance, like the
above mentioned values, and customized logs feeding custom-defined
reports.

<ul class="menu">
<li><a accesskey="1" href="#Vital-Signs-Time-Series">Vital Signs Time Series</a>
<li><a accesskey="2" href="#Long-term-trends">Long term trends</a>
<li><a accesskey="3" href="#Custom-promises-to-measure">Custom promises to measure</a>
<li><a accesskey="4" href="#Uses-for-custom-monitoring">Uses for custom monitoring</a>
</ul>

<!--  -->
<div class="node">
<a name="Vital-Signs-Time-Series"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Long-term-trends">Long term trends</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Monitoring-extensions">Monitoring extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">10.1 Vital Signs Time Series</h3>

<p>Detailed time-series views can be collected and collated, providing
honest and accurate data that allow you to gauge your own confidence
level in system performance.  Unlike most monitoring solutions,
CFEngine shows you its own confidence in the measurements taken. It
takes a finite amount of time to measure and transport data from
systems to the knowledge console. That time also provides information
about system performance. CFEngine always promises to tell you how old
data are and how confident it is in the values.

   <pre class="sp">

</pre>
<div align="center"><img src="img-vitals-tab-3-0.png" alt="Vital Signs Time Series"></div>
<div align="center">Figure: Vitals Signs Time Series</div>
   <pre class="sp">

</pre>

Clicking on a view brings up a more detailed picture, including the possibility to view long term trends (see below).

<!--  -->
<div class="node">
<a name="Long-term-trends"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Vital-Signs-Time-Series">Vital Signs Time Series</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">10.2 Long term trends</h3>

<p>CFEngine normally operates with vital sign data represented in two forms:

     <ul>
<li>A weekly average, plotted on a periodogram, showing performance now in relation
to the same time of week in previous weeks. After about a month data are forgotten
to ensure a sufficient rate of adaptation to new patterns. 
<li>The past four hours in high resolution. 
</ul>

   <p>In addition, CFEngine Enterprise adds quarter day averages of recorded time-series which go back three
years in time. Three years is considered to be the lifetime of a computer. 
Summaries of the detailed performance are summarized by flat averages for
a four-shift day:
     <ul>
<li><b>Night shift</b>: from midnight 00:00 to 06:00
<li><b>Morning shift</b>: from 06:00 to 12:00
<li><b>Afternoon shift</b>: from 12:00 to 18:00
<li><b>Evening shift</b>: from 18:00 to 00:00
</ul>

<!--  -->
<div class="node">
<a name="Custom-promises-to-measure"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Uses-for-custom-monitoring">Uses for custom monitoring</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Long-term-trends">Long term trends</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">10.3 Custom promises to measure</h3>

<ul class="menu">
<li><a accesskey="1" href="#Extraction-strings-and-logging">Extraction strings and logging</a>
<li><a accesskey="2" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>
<li><a accesskey="3" href="#Extraction-to-list-variable">Extraction to list variable</a>
</ul>

<p>CFEngine Enterprise incorporates a promise type in bundles for the monitoring
agent. These are written just like all other promises within a bundle
destined for the agent concerned. In this case:

<pre class="verbatim">
bundle monitor watch

{
measurements:

  # promises ...

}

</pre>

   <p>See example usage in the following sections.

<!--  -->
<div class="node">
<a name="Extraction-strings-and-logging"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">10.3.1 Extraction strings and logging</h4>

<p>Let's take a generic example. Suppose we have a file of nonsense  <samp><span class="file">/tmp/testmeasure</span></samp>
and we want to extract some information that we call a `blonk'
from the file. A blonk is always on the second line of this file following
a prefix `Blonk blonk '. We would get the value like this:

<pre class="verbatim">
  "/tmp/testmeasure"

      handle => "blonk_watch",
      stream_type => "file",
      data_type => "string",
      history_type => "log",
      units => "blonks",
      match_value => find_blonks,
      action => sample_min("10");

</pre>

   <p>This promise body has several attributes.

     <dl>
<dt><code>handle</code><dd>It is essential to give measurement promises handles, as these are used to label the
log files that will store the values.

     <br><dt><code>stream_type</code><dd>Tells us that we are reading from what the system considered to be a regular file
on the file-system.

     <br><dt><code>data_type</code><dd>This says that data are to be treated as text with no other meaning.

     <br><dt><code>history_type</code><dd>This tells us that we want to log the values with a time stamp.

     <br><dt><code>units</code><dd>This string is used in documentation to explain the measurement units of this result.

     <br><dt><code>match_value</code><dd>This is a body reference that represents the algorithm by which we extract data from the file.

     <br><dt><code>action</code><dd>This is the generic action parameter that may be added to all promises. We use it
here to limit the sample rate of this promise; <code>cf-monitord</code> samples by default
at a rate of once per 2.5 minutes. 
</dl>

   <p>The matching body uses a method for selecting the correct line, and a way
for extracting a pattern from the line. In every case the value extracted
is described  by using a regular expression <i>back-reference</i>, i.e. 
a parenthesized expression  within a regular expression. The expression should
match the entire line and should contain exactly one parenthesis.

<pre class="verbatim">body match_value find_blonks
{
select_line_number => "2";
extraction_regex => "Blonk blonk ([blonk]+).*";
}
</pre>

   <p>The sampling rate is controlled by using the generic <code>action</code> constraint.
<pre class="verbatim">body action sample_min(x)
{
ifelapsed => "$(x)";
expireafter => "$(x)";
}
</pre>

<!--  -->
<div class="node">
<a name="Extracting-one-off-numerical-data"></a>
<a name="Extracting-one_002doff-numerical-data"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Extraction-to-list-variable">Extraction to list variable</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extraction-strings-and-logging">Extraction strings and logging</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">10.3.2 Extracting one-off numerical data</h4>

<p>In this example we extract an integer value from an existing file. 
Notice that CFEngine samples the process table during <code>processes</code>
promises so you might be able to save a new execution of a
shell command and use the cached data, depending on your need
for immediacy. It is always good practice to limit the system
load incurred by monitoring.

<pre class="verbatim">  # Test 2 - follow a special process over time
  # using CFEngine's process cache to avoid re-sampling

   "/var/cfengine/state/cf_rootprocs"

      handle => "monitor_self_watch",
      stream_type => "file",
      data_type => "int",
      history_type => "static",
      units => "kB",
      match_value => proc_value(".*cf-monitord.*",

         "root\s+[0-9.]+\s+[0-9.]+\s+[0-9.]+\s+[0-9.]+\s+([0-9]+).*");

</pre>

   <p>This match body selects a line matching a particular regular expression
and extracts the 6th column of the process table. The regular expression
skips first the root string and then five numerical values. 
The value is extracted into a one-off value

<pre class="verbatim">body match_value proc_value(x,y)
{
select_line_matching => "$(x)";
extraction_regex => "$(y)";
}
</pre>

<!--  -->
<div class="node">
<a name="Extraction-to-list-variable"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Extracting-one_002doff-numerical-data">Extracting one-off numerical data</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Custom-promises-to-measure">Custom promises to measure</a>

</div>

<h4 class="subsection">10.3.3 Extraction to list variable</h4>

<p>In this example we discover a list of disks attached to the system.
<pre class="verbatim">  # Test 3, discover disk device information

  "/bin/df"

      stream_type => "pipe",
      data_type => "slist",
      history_type => "static",
      units => "device",
      match_value => file_system,
      action => sample_min("480"); # this is not changing much!

</pre>

<pre class="verbatim">
body match_value file_system
{
select_line_matching => "/.*";
extraction_regex => "(.*)";
}

</pre>

<!--  -->
<div class="node">
<a name="Uses-for-custom-monitoring"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Custom-promises-to-measure">Custom promises to measure</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Monitoring-extensions">Monitoring extensions</a>

</div>

<h3 class="section">10.4 Uses for custom monitoring</h3>

<p>Unlike most other monitoring tools that use heavy-weight scripting
languages to extract data, often running many processes for each
measurement, CFEngine is a lightweight probe, using file interfaces
and regular expressions. Thus its impact on the
system is minimal. The possibilities for using this are therefore
extremely broad:

     <ul>
<li>Extracting accounting data from systems for charge-back. 
This could be useful in cloud scenarios. 
<li>Discovering memory leaks. 
<li>Looking for zombie processes relating to specific software. 
<li>Logging up-time. 
<li>System class-dependent discovery and extraction of any kind of text
for insertion into a CMDB. 
</ul>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="File-Access-Control-Lists"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Server-extensions">Server extensions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Monitoring-extensions">Monitoring extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">11 File Access Control Lists</h2>

<ul class="menu">
<li><a accesskey="1" href="#ACL-Introduction">ACL Introduction</a>
<li><a accesskey="2" href="#File-ACL-example">File ACL example</a>
<li><a accesskey="3" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>
<li><a accesskey="4" href="#POSIX-ACL-type">POSIX ACL type</a>
<li><a accesskey="5" href="#NT-ACL-type">NT ACL type</a>
</ul>

<!--  -->
<div class="node">
<a name="ACL-Introduction"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#File-ACL-example">File ACL example</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">11.1 ACL Introduction</h3>

<p>Access Control Lists (ACL) allow for a more fine-grained access control on
file system objects than standard Unix permissions. In spite of the success
of the POSIX model's simplicity the functionality is limited.

   <p>File permission security is a subtle topic. Users should take care
when experimenting with ACLs as the results can often be
counter-intuitive. In some cases the functioning of a system can be
compromised by changes of access rights.

   <p>Not all file systems support ACLs. In Unix systems there is a plethora
of different file system types, which have different models of ACLs. 
Be aware that the mount-options for a file-system may affect the ACL
semantics.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<i>Note that when adding a user to a group, this will not have any
effect until the next time the user logs in on many operating
systems.</i>
</td></tr></table>

   <p>As CFEngine works across multiple platforms and needs to support ACLs
with different APIs, a common ACL syntax has been abstracted to add a
layer of portability. This is a specific feature of CFEngine, not of
the host systems. A generic syntax ensures that the ACLs that are
commonly needed can be coded in a portable fashion. CFEngine Enterprise's
ACL model is translated into native permissions for implementation;
CFEngine does not interfere with native access mechanisms in any way. 
The CFEngine ACL syntax is similar to the POSIX ACL syntax, which is
supported by BSD, Linux, HP-UX and Solaris.

   <p>CFEngine also allows you to specify platform-dependent ACLs. Of
course, these ACLs will only work on the given platform, and must
therefore be shielded with classes that select the appropriate model
within the promise body.

   <p>Currently, CFEngine Enterprise supports the following ACL APIs and operating
systems.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">ACL type </th><th valign="top" width="30%">Operating system
<br></th></tr><tr align="left"><td valign="top" width="30%">NTFS </td><td valign="top" width="30%">Windows Server 2003, 2008
<br></td></tr><tr align="left"><td valign="top" width="30%">POSIX </td><td valign="top" width="30%">Linux
   <br></td></tr></table>

<!--  -->
<div class="node">
<a name="File-ACL-example"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#ACL-Introduction">ACL Introduction</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">11.2 File ACL example</h3>

<p>The form of a CFEngine files promise that uses ACLs is as follows:
<pre class="verbatim">
#
# test_acl.cf
#

body common control
{
bundlesequence => { "acls" };
}

#########################################

bundle agent acls

{
files:

  "/office/shared"

    acl => template;
}

#########################################

body acl template

{
acl_method => "overwrite";
acl_directory_inherit => "parent";

 linux|solaris::

  acl_type => "posix";

  aces => {
          "user:*:rw",
          "user:root:rw",
          "group:*:r",
          "mask:rwx",
          "all:r"
          };

 windows::

  acl_type => "ntfs";

  aces => {
          "user:Administrator:rw(po)",
          "all:r"
          };
}

</pre>

<ul class="menu">
<li><a accesskey="1" href="#Concepts">Concepts</a>
<li><a accesskey="2" href="#Entity-types">Entity types</a>
<li><a accesskey="3" href="#Owners">Owners</a>
<li><a accesskey="4" href="#Changing-owner">Changing owner</a>
<li><a accesskey="5" href="#Permissions">Permissions</a>
<li><a accesskey="6" href="#Deny-permissions">Deny permissions</a>
<li><a accesskey="7" href="#Changing-permissions">Changing permissions</a>
<li><a accesskey="8" href="#Effective-permissions">Effective permissions</a>
<li><a accesskey="9" href="#Inheritance">Inheritance</a>
</ul>

<!--  -->
<div class="node">
<a name="Concepts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Entity-types">Entity types</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-ACL-example">File ACL example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.1 Concepts</h4>

<p>As mentioned, there are many different ACL APIs. For example, the
POSIX draft standard, NTFS and NFSv4 have different and incompatible
ACL APIs. As CFEngine is cross-platform, these differences should, for
the most usual cases, be transparent to the user. However, some
distinctions are impossible to make transparent, and thus the user
needs to know about them.

   <p>We will explore the different concepts of ACL implementations that are
critical to understanding how permissions are defined and enforced in
the different file systems. As a running example, we will consider
NTFS ACLs and POSIX ACLs, because the distinction between these ACL
APIs is strong.

<!--  -->
<div class="node">
<a name="Entity-types"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Owners">Owners</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Concepts">Concepts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.2 Entity types</h4>

<p>All ACL APIs support three basic entity types: user, group and
all. User and group are simply users and groups of the system, where a
group may contain multiple users. all is all users of the system, this
type is called "other" in POSIX and "Everyone" in NTFS.

<!--  -->
<div class="node">
<a name="Owners"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Changing-owner">Changing owner</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Entity-types">Entity types</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.3 Owners</h4>

<p>All file system objects have an owner, which by default is the entity
that created the object. The owner can always be a user. However, in
some file systems, groups can also be owners (e.g. the
"Administrators" group in NTFS). In some ACL APIs (e.g POSIX),
permissions can be set explicitly for the owner, i.e. the owner has an
independent ACL entry.

<!--  -->
<div class="node">
<a name="Changing-owner"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Permissions">Permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Owners">Owners</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.4 Changing owner</h4>

<p>It is generally not possible for user A to set user B as the
owner of a file system object, even if A owns the object. The
superuser ("root" in POSIX, "Administrator" in NTFS) can however
always set itself as the owner of an object. In POSIX, the superuser
may in fact set any user as the owner, but it NTFS it can only take
ownership.

<!--  -->
<div class="node">
<a name="Permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Deny-permissions">Deny permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Changing-owner">Changing owner</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.5 Permissions</h4>

<p>An entity can be given a set of permissions on a file system object
(e.g. read and write). The data structure holding the permissions for
one entity is called an "Access Control Entry" (ACE). As many users
and groups may have sets of permissions on a given object, multiple
Access Control Entries are combined to an Access Control List, which
is associated with the object.

   <p>The set of available permissions differ with ACL APIs. For example,
the "Take Ownership" permission in NTFS has no equivalent in
POSIX. However, for the most common situations, it is possible to get
equivalent security properties by mapping a set of permissions in one
API to another set in a second API.

   <p>There are however different rules for the access to the contents of a
directory with no access. In POSIX, no sub-objects of a directory with
no access can be accessed. However, in NTFS, sub-objects that the entity
has access rights to can be accessed, regardless of whether the entity
has access rights to the containing directory.

<!--  -->
<div class="node">
<a name="Deny-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Changing-permissions">Changing permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Permissions">Permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.6 Deny permissions</h4>

<p>If no permissions are given to a particular entity, the entity will be
denied any access to the object. But in some file systems, like NTFS,
it is also possible to explicitly deny specific permissions to
entities. Thus, two types of permissions exist in these systems: allow
and deny.

   <p>It is generally good practice to design the ACLs to specify who is
allowed to do some operations, in contrary to who is not allowed to do
some operations, if possible. The reason for this is that describing
who is not allowed to do things tend to lead to more complex
rules and could therefore more easily lead to mis-configurations and
security holes. A good rule is to only define that users should not be
able to access a resource in the following two scenarios:

     <ul>
<li>Denying access to a subset of a group which is allowed access
<li>Denying a specific permission when a user or a group has full access
</ul>

   <p>If you think about it, this is the same principle that applies to
firewall configuration: it is easier to white-list, specify who should
have access, than to blacklist, specify who should not have access. In
addition, since CFEngine is designed to be cross-platform and some ACL
permissions are not available on all platforms, we should strive to
keep the ACLs as simple as possible. This helps us avoid surprises
when the ACLs are enforced by different platforms.

<!--  -->
<div class="node">
<a name="Changing-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Effective-permissions">Effective permissions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Deny-permissions">Deny permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.7 Changing permissions</h4>

<p>Generally, only the owner may change permissions on a file system
object. However, superusers can also indirectly change permissions by
taking ownership first. In POSIX, superusers can change permissions
without taking ownership. In NTFS, either ownership or a special
permission ("Change Permissions") is needed to alter permissions.

<!--  -->
<div class="node">
<a name="Effective-permissions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Inheritance">Inheritance</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Changing-permissions">Changing permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.8 Effective permissions</h4>

<p>Unfortunately, even though two ACL APIs support all the permissions
listed in an ACL, the ACL may be interpreted differently. For a given
entity and object with ACL, there are two conceptually different ways
to interpret which permissions the entity obtains: ACE precedence and
cumulative ACL.

<!-- TODO: create figure of example? -->
   <p>For example, let &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; be a user of the group
&lsquo;<samp><span class="samp">staff</span></samp>&rsquo;. There is an ACL on the file <samp><span class="file">schedule</span></samp>, giving
&lsquo;<samp><span class="samp">alice</span></samp>&rsquo; write permission, and the group &lsquo;<samp><span class="samp">staff</span></samp>&rsquo; read
permission. We will consider two ways to determine the effective
permissions of &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; to <samp><span class="file">schedule</span></samp>.

   <p>Firstly, by taking the most precise match in the ACL, &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; will be
granted write permission only. This is because an ACE describing &lsquo;<samp><span class="samp">alice</span></samp>&rsquo;
is more precise than an ACE describing a group &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; is member
of. However, note that some ACEs may have the same precedence, like
two ACEs describing permissions for groups &lsquo;<samp><span class="samp">alice</span></samp>&rsquo; is member of. Then,
cumulative matching will be done on these ACEs (explained next). This
is how POSIX does it.

   <p>Secondly, we can take the cumulative permissions, which yields a user
permissions from all the ACE entries with his user name, groups he is
member of or the ACE entry specifying all users. In this case,
&lsquo;<samp><span class="samp">alice</span></samp>&rsquo; would get read and write on <samp><span class="file">schedule</span></samp>. NTFS
computes the effective permissions in this way.

<!--  -->
<div class="node">
<a name="Inheritance"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Effective-permissions">Effective permissions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-ACL-example">File ACL example</a>

</div>

<h4 class="subsection">11.2.9 Inheritance</h4>

<!-- TODO: Correct to inherit to someone ? -->
<p>Directories have ACLs associated with them, but they also have the
ability to inherit an ACL to sub-objects created within them. POSIX
calls the former ACL type "access ACL" and the latter "default ACL",
and we will use the same terminology.

<!-- TODO: Create tool to output effective permissions if ACL is applied ? -->
<!--  -->
<div class="node">
<a name="CFEngine-3-Generic-ACL-Syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#POSIX-ACL-type">POSIX ACL type</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-ACL-example">File ACL example</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">11.3 CFEngine 3 Generic ACL Syntax</h3>

<!-- FIXME: TODO: Say which OS's we are supporting, and which ACL types -->
<!-- we are supporting on them. -->
<p>The CFEngine 3 ACL syntax is divided into two main parts, a generic
and an API specific (native). The generic syntax can be used on any
file system for which CFEngine supports ACLs, while the native syntax
gives access to all the permissions available under a particular ACL
API.

   <p>An ACL can contain both generic and native syntax. However, if it
contains native syntax, it can only be enforced on systems supporting
the given ACL API. Thus, only the generic syntax is portable.

   <p>Note that even though the same generic ACL is set on two systems with
different ACL APIs, it may be enforced differently because the ACE
matching algorithms differ. For instance, as discussed earlier, NTFS
uses cumulative matching, while POSIX uses precedence
matching. CFEngine cannot alter the matching algorithms, and
simulating one or the other by changing ACL definitions is not
possible in all cases, and would probably lead to confusion. Thus, if
an ACL is to be used on two systems with different ACL APIs, the user
is encouraged to check that any differences in matching algorithms do
not lead to mis-configurations.

   <p>The CFEngine generic ACL syntax explained next, and native syntax is
described in following sections.

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="smallexample">     body acl acl_alias:
     {
     acl_type              =&gt; "<var>generic</var>"/"<var>ntfs</var>"/"<var>posix</var>";
     acl_method            =&gt; "<var>append</var>"/"<var>overwrite</var>";
     acl_directory_inherit =&gt; "<var>nochange</var>"/"<var>clear</var>"/"<var>parent</var>"/"<var>specify</var>";
     aces                  =&gt; {
                               "user:uid:mode[:perm_type]", ...,
                               "group:gid:mode[:perm_type]", ...,
                               "all:mode[:perm_type]"
                              };
     specify_inherit_aces  =&gt; {
                               "user:uid:mode[:perm_type]", ...,
                               "group:gid:mode[:perm_type]", ...,
                               "all:mode[:perm_type]"
                              };
     }
</pre>
   </td></tr></table>

     <ul>
<li><code>acl_alias</code> is the name of the specified ACL. It can be any
  identifier containing alphanumeric characters and underscores. We
will use this name when referring to the ACL.

     <li><code>acl_type</code> (optional) specifies the ACL API used to
describe the ACL. It defaults to <code>generic</code>, which allows only
CFEngine generic ACL syntax, but is valid on all supported
systems. <code>acl_type</code> only needs to be specified if native
permissions are being used in the ACL (see <code>nperms</code> below). If
<code>acl_type</code> is set to anything other than <code>generic</code>, the
system on which it is enforced must support this ACL API.

     <li><code>acl_method</code> (optional) can be set to either
  <code>append</code> or <code>overwrite</code>, and defaults to
  <code>append</code>. Setting it to <code>append</code> only adds or modifies the
  ACEs that are specified in <code>aces</code> (and
  <code>specify_inherit_aces</code>, see below). If set to
  <code>overwrite</code>, the specified ACL will completely replace the
  currently set ACL. All required fields must then be set in the
  specified ACL (e.g. <code>all</code> in POSIX), see the following sections
  describing the supported native APIs.

     <!-- TODO: Support acl_method:append for specify_inherit_aces independently? -->
     <li><code>acl_directory_inherit</code> (optional) specifies the ACL of
  newly created sub-objects. Only valid if the ACL is set on a
directory. On directories, <code>nochange</code> is the default and
indicates that the ACL that is currently given to newly created child
objects is left unchanged. If set to <code>clear</code>, no ACL will be
inherited, but the file system specifies a default ACL, which varies
with the file system (see the following sections on the supported ACL
APIs). <code>parent</code> indicates that the ACL set in <code>aces</code> (see
below) should be inherited to sub-objects.  If set to <code>specify</code>,
<code>specify_inherit_aces</code> specifies the inherited ACL, and
<code>acl_method</code> applies for <code>specify_inherit_aces</code> too.

     <li><code>aces</code> is a list of access control entries. It is parsed
  from left to right, and multiple entries with the same entity-type
  and id is allowed. This is necessary to specify permissions with
  different <code>perm_type</code> for the same entity (e.g. to allow read
  permission but explicitly deny write).

     <li><code>specify_inherit_aces</code> (optional) is a list of access control
  entries that are set on child objects. It is also parsed from left
  to right and allows multiple entries with same entity-type and
  id. Only valid if <code>acl_directory_inherit</code> is set to
  <code>specify</code>.

     <li><code>user</code> indicates that the line applies to a user specified
  by the user identifier <code>uid</code>. <code>mode</code> is the permission
  mode string.

     <li><code>group</code> indicates that the line applies to a group specified
  by the group identifier <code>gid</code>. <code>mode</code> is the permission
  mode string.

     <li><code>all</code> indicates that the line applies to every
  user. <code>mode</code> is the permission mode string.

     <li><code>uid</code> is a valid user name for the system and
  cannot be empty. However, if <code>acl_type</code> is <code>posix</code>,
<code>uid</code> can be set to * to indicate the user that owns the file
system object.

     <li><code>gid</code> is a valid group name for the system and
  cannot be empty. However, if <code>acl_type</code> is <code>posix</code>,
<code>gid</code> can be set to * to indicate the file group.

     <li><code>mode</code> is one or more strings
  <code>op</code>|<code>gperms</code>|(<code>nperms</code>); a concatenation of <code>op</code>,
  <code>gperms</code> and optionally (<code>nperms</code>), see below, separated
  with commas (e.g. +rx,-w(s)). <code>mode</code> is parsed from left to
  right. 
<!-- TODO: include support for @code{fullaccess}, @code{noaccess}, -->
<!-- and @code{remove} -->

     <li><code>op</code> specifies the operation on any existing permissions,
  if the specified ACE already exists. <code>op</code> can be =, empty, + or
  -. = or empty sets the permissions to the ACE as stated, + adds and
  - removes the permissions from any existing ACE.

     <li><code>nperms</code> (optional) specifies ACL API specific
  (native) permissions. Only valid if <code>acl_type</code> is not
  <code>generic</code>. Valid values for <code>nperms</code> varies with different
  ACL types, and are specified in subsequent sections.

     <li><code>perm_type</code> (optional) can be set to either <code>allow</code> or
  <code>deny</code>, and defaults to <code>allow</code>. <code>deny</code> is only valid
  if <code>acl_type</code> is set to an ACL type that support deny
  permissions.

     <li><code>gperms</code> (generic permissions) is a concatenation of zero
  or more of the characters shown in the table below. If left empty,
  none of the permissions are set. 
</ul>

   <p><table summary=""><tr align="left"><th valign="top" width="5%">Flag </th><th valign="top" width="20%">Description </th><th valign="top" width="30%">Semantics on file </th><th valign="top" width="40%">Semantics on directory

<p><br></th></tr><tr align="left"><td valign="top" width="5%"><code>r</code> </td><td valign="top" width="20%">Read </td><td valign="top" width="30%">Read data, permissions, attributes </td><td valign="top" width="40%">Read
directory contents, permissions, attributes
<br></td></tr><tr align="left"><td valign="top" width="5%"><code>w</code> </td><td valign="top" width="20%">Write </td><td valign="top" width="30%">Write data </td><td valign="top" width="40%">Create, delete, rename sub-objects
<br></td></tr><tr align="left"><td valign="top" width="5%"><code>x</code> </td><td valign="top" width="20%">Execute </td><td valign="top" width="30%">Execute file </td><td valign="top" width="40%">Access sub-objects
   <br></td></tr></table>

   <p>Note that the <code>r</code> permission is not necessary to read an object's
permissions and attributes in all file systems (e.g. in POSIX, having
<code>x</code> on its containing directory is sufficient).

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#Generic-syntax-examples">Generic syntax examples</a>
</ul>

<div class="node">
<a name="Generic-syntax-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>

</div>

<h4 class="subsection">11.3.1 Generic syntax examples</h4>

<pre class="verbatim">body common control
{
bundlesequence => { "acls" };
}

bundle agent acls
{
files:
  "/office/schedule"
    acl => small;

  "/office/audit_dir"
    acl => dirinherit;
}

body acl small
{
aces => {"user:alice:w", "group:staff:r", "all:"};
}

body acl dirinherit
{
acl_directory_inherit => "parent";
aces => {"user:alice:+w,-x", "user:bob:+r,-w", "group:staff:=rx", "all:-w"};
}
</pre>
See the following sections on native ACL types for more examples.

<!-- TODO: include support for the following as mode -->
<!-- Keywords: -->
<!-- remove              = setting mode = remove removes any existing -->
<!-- ACE with the given user or group. Only valid if -->
<!-- @code{method}:@code{overwrite}. -->
<!-- fullaccess  = setting mode = fullaccess grants every permission -->
<!-- supported by the file system to the given entity -->
<!-- (user, group, all). The owner of the object and -->
<!-- properties like suid, sgid and -->
<!-- sticky are left unchanged. -->
<!-- noaccess    = setting mode = noaccess denies every permission for -->
<!-- the entity (user, group, all). The entity is left -->
<!-- with no access rights to the object. Note that the -->
<!-- entity might nonetheless be able to change the -->
<!-- permissions (e.g. by being the owner of the object -->
<!-- or a superuser). -->
<!-- TODO: Define user, group, mask and other to u, g, m, o instead / also? -->
<!-- TODO: Examples: ACLs, console output, screen-shots -->
<!--  -->
<div class="node">
<a name="POSIX-ACL-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#NT-ACL-type">NT ACL type</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-3-Generic-ACL-Syntax">CFEngine 3 Generic ACL Syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">11.4 POSIX ACL type</h3>

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#POSIX_002dspecific-ACL-syntax">POSIX-specific ACL syntax</a>
<li><a accesskey="2" href="#Generic-syntax-mapping">Generic syntax mapping</a>
<li><a accesskey="3" href="#POSIX-ACL-examples">POSIX ACL examples</a>
</ul>

<div class="node">
<a name="POSIX-specific-ACL-syntax"></a>
<a name="POSIX_002dspecific-ACL-syntax"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Generic-syntax-mapping">Generic syntax mapping</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#POSIX-ACL-type">POSIX ACL type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#POSIX-ACL-type">POSIX ACL type</a>

</div>

<h4 class="subsection">11.4.1 POSIX-specific ACL syntax</h4>

<p><b>Native permissions</b>
The valid values for <code>nperms</code> in POSIX are <code>r</code>,<code>w</code>, and
<code>x</code>. These are in fact the same as the generic permissions, so
specifying them as generic or native gives the same effect.

   <p><b>File owner and group</b>
A user-ACE with uid set to * indicates file object owner. A group-ACE
with gid set to * indicates file group.

   <p><b>mask</b> mask can be specified as a normal ACE, as
<code>mask:mode</code>. mask specifies the maximum permissions that are
granted to named users (not owning user), file group and named
groups. mask is optional, if it is left unspecified it will will be
computed as the union of the permissions granted to named users, file
group and named groups (see acl_calc_mask(3)).

   <p><b>Required ACEs</b> POSIX requires existence of an ACE for the file
owner, (<code>user:*:mode</code>), the file group (<code>group:*:mode</code>),
other (<code>all:mode</code>) and mask (<code>mask:mode</code>). As mentioned,
CFEngine automatically creates a mask-ACE, if missing. However, if
<code>method</code> is set to <code>overwrite</code>, the user must ensure that
the rest of the required entries are specified.

<!--  -->
<div class="node">
<a name="Generic-syntax-mapping"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#POSIX-ACL-examples">POSIX ACL examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#POSIX_002dspecific-ACL-syntax">POSIX-specific ACL syntax</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#POSIX-ACL-type">POSIX ACL type</a>

</div>

<h4 class="subsection">11.4.2 Generic syntax mapping</h4>

<p><b>Entity types</b>
All entity types in the generic syntax are mapped to the corresponding
entity types with the same name in POSIX, except <code>all</code> which
corresponds to <code>other</code> in POSIX.

   <p><b>Generic permissions</b>

   <p>As shown in the table below, <code>gperms</code> is mapped straightforward
from generic to POSIX permission flags.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">Generic flag  </th><th valign="top" width="30%">POSIX flag
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>r</code> </td><td valign="top" width="30%"><code>r</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>w</code> </td><td valign="top" width="30%"><code>w</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>x</code> </td><td valign="top" width="30%"><code>x</code>
   <br></td></tr></table>

   <p><b>Inheritance</b> POSIX supports <code>acl_directory_inherit</code> set to
<code>specify</code>. The <code>specify_inherit_aces</code> list is then set as the
default ACL in POSIX (see acl(5)).

   <p>If <code>acl_directory_inherit</code> is set to <code>parent</code>, CFEngine
copies the access ACL to the default ACL. Thus, newly created objects
get the same access ACL as the containing directory.

   <p><code>acl_directory_inherit</code> set to <code>clear</code> corresponds to no
POSIX default ACL. This results in that newly created objects get ACEs
for owning user, group and other. The permissions are set in
accordance with the mode parameter to the creating function and the
umask (usually results in 644 for files and 755 for directories).

   <p><b>Further reading</b> The manual page <code>acl(5)</code> contains much
information on POSIX ACLs, including the access check algorithm. In
particular, this shows that POSIX uses ACE precedence matching, and
exactly how it is done. Operating systems usually bundle tools for
manipulating ACLs, for example <code>getfacl(1)</code> and
<code>setfacl(1)</code>.

<div class="node">
<a name="POSIX-ACL-examples"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Generic-syntax-mapping">Generic syntax mapping</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#POSIX-ACL-type">POSIX ACL type</a>

</div>

<h4 class="subsection">11.4.3 POSIX ACL examples</h4>

<pre class="verbatim">body common control
{
bundlesequence => { "acls" };
}

bundle agent acls
{
files:

  "/office/timetable"
    acl => nativeperms;

  "/office/user_dir"
    acl => specifyinherit;
}

body acl nativeperms
{
acl_type => "posix";
aces => {"user:alice:r(w)", "user:root:=(rwx)",
         "group:staff:-r(x)", "all:-(w)", "mask:(rx)"};
}

body acl specifyinherit
{
acl_type => "posix";
acl_method => "overwrite";
acl_directory_inherit => "specify";
aces => {"user:*:rwx", "group:*:rx", "user:alice:rwx",
         "user:root:rx", "group:staff:r", "all:rx"};
specify_inherit_aces => {"user:*:", "group:*:", "all:"};
}
</pre>

<!--  -->
<div class="node">
<a name="NT-ACL-type"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#POSIX-ACL-type">POSIX ACL type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#File-Access-Control-Lists">File Access Control Lists</a>

</div>

<h3 class="section">11.5 NT ACL type</h3>

<!--  -->
<ul class="menu">
<li><a accesskey="1" href="#NT_002dspecific-ACL-syntax">NT-specific ACL syntax</a>
</ul>

<div class="node">
<a name="NT-specific-ACL-syntax"></a>
<a name="NT_002dspecific-ACL-syntax"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#NT-ACL-type">NT ACL type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#NT-ACL-type">NT ACL type</a>

</div>

<h4 class="subsection">11.5.1 NT-specific ACL syntax</h4>

<p><b>Native permissions</b>
NTFS supports fourteen so-called special file permissions. However, we
do not consider the <code>Synchronize</code> permission because it is used
for a different purpose than the other permissions. In order to give
access to the thirteen relevant permissions, CFEngine defines a native
permission flag for each of them. This one-to-one mapping is as
follows.

   <p><table summary=""><tr align="left"><th valign="top" width="40%">NTFS Special Permission </th><th valign="top" width="20%">CFEngine nperm
<br></th></tr><tr align="left"><td valign="top" width="40%">Execute File / Traverse Folder </td><td valign="top" width="20%">x
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Data / List Folder </td><td valign="top" width="20%">r
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Attributes </td><td valign="top" width="20%">t
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Extended Attributes </td><td valign="top" width="20%">T
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Data / Create Files </td><td valign="top" width="20%">w
<br></td></tr><tr align="left"><td valign="top" width="40%">Append Data / Create Folders </td><td valign="top" width="20%">a
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Attributes </td><td valign="top" width="20%">b
<br></td></tr><tr align="left"><td valign="top" width="40%">Write Extended Attributes </td><td valign="top" width="20%">B
<br></td></tr><tr align="left"><td valign="top" width="40%">Delete Sub-folders and Files </td><td valign="top" width="20%">D
<br></td></tr><tr align="left"><td valign="top" width="40%">Delete </td><td valign="top" width="20%">d
<br></td></tr><tr align="left"><td valign="top" width="40%">Read Permissions </td><td valign="top" width="20%">p
<br></td></tr><tr align="left"><td valign="top" width="40%">Change Permissions </td><td valign="top" width="20%">c
<br></td></tr><tr align="left"><td valign="top" width="40%">Take Ownership </td><td valign="top" width="20%">o
   <br></td></tr></table>

   <p>The semantics of these special permissions can be found in the
references for further reading below.

   <p><b>Denying permissions</b>
NTFS supports setting <code>perm_type</code> to <code>deny</code> in addition to
<code>allow</code>, which is the default. This can for instance be used to
denying a user a particular permission that a group membership grants
him. It is important to note that the precedence of allow and deny
permissions is as follows:

     <ol type=1 start=1>
<li>Explicit Deny
<li>Explicit Allow
<li>Inherited Deny from parent
<li>Inherited Allow from parent
<li>Inherited Deny from grandparent
<li>Inherited Allow from grandparent
<li>...
        </ol>

   <p>Thus, the closer the permission is to the object in the directory
path, the greater precedence it is given.

   <p>An important point here is that even though a user is denied access in
a parent directory and this permission is inherited, but one of the
groups he is member of is explicitly allowed access to a file in that
directory, he is actually allowed to access the file.

   <p><b>Ownership</b>
In NTFS, the default owner is the user who is currently logged on. The
only exceptions occur when the user is a member of either the
&lsquo;<samp><span class="samp">Administrators</span></samp>&rsquo; group or the &lsquo;<samp><span class="samp">Domain Admins</span></samp>&rsquo; group.

   <p>Owners of NTFS objects can allow another user to take ownership by
giving that user Take Ownership permission. Owners can also give other
users the Change Permissions flag. In addition, members of the
&lsquo;<samp><span class="samp">Administrator</span></samp>&rsquo; group can always take ownership. It is never
possible to give ownership of an object to a user, but members of
the &lsquo;<samp><span class="samp">Administrator</span></samp>&rsquo; group can give ownership to that group.

<h4 class="subsection">11.5.2 Generic syntax mapping</h4>

<p><b>Entity types</b>
The three entity types of NTFS are called user, group and
Everyone. The user and group entity types in NTFS are mapped to the
user and group entity types in CFEngine. Everyone is mapped to all in
CFEngine.

   <p><b>Generic permissions</b>
For NTFS, CFEngine maps the <code>gperms</code> to <code>nperms</code> as
follows.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">Generic flag  </th><th valign="top" width="30%">Native flags
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>r</code> </td><td valign="top" width="30%"><code>rtTp</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>w</code> </td><td valign="top" width="30%"><code>wabB</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>x</code> </td><td valign="top" width="30%"><code>x</code>
   <br></td></tr></table>

   <p>The rationale for this mapping is discussed next.

   <p>NTFS groups the thirteen special permissions to create five sets of
permissions:
     <ul>
<li>Read
<li>Read &amp; Execute
<li>Write
<li>Modify
<li>Full Control
</ul>
   In addition, we have the List Folder Contents set, which is equivalent
to the Read &amp; Execute set but is only available to- and inherited by
directories. The Full Control set is unsurprisingly all the thirteen
special permissions. An overview of the NTFS mapping of special
permissions to sets is given in the references stated as further
reading below. The NTFS permission sets can be expressed in CFEngine
syntax as follows.

   <p><table summary=""><tr align="left"><th valign="top" width="30%">NTFS sets  </th><th valign="top" width="40%">CFEngine gperms|(nperms)
<br></th></tr><tr align="left"><td valign="top" width="30%"><code>Read</code> </td><td valign="top" width="40%"><code>r</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Write</code> </td><td valign="top" width="40%"><code>w</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Read &amp; Execute</code> </td><td valign="top" width="40%"><code>rx</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Modify</code> </td><td valign="top" width="40%"><code>rwx(d)</code>
<br></td></tr><tr align="left"><td valign="top" width="30%"><code>Full Control</code> </td><td valign="top" width="40%"><code>rwx(dDco)</code>
   <br></td></tr></table>

   <p><b>Inheritance</b>
<code>acl_directory_inherit</code> set to <code>clear</code> disables
inheritance, such that child objects get a default ACL specified by
the operating system, namely Full control for the file object creator and
<code>SYSTEM</code> accounts.

   <p><b>POSIX compatibility</b>
Be aware that setting <code>gperms</code> to &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; on directories is
more restrictive in NTFS than in POSIX ACLs. This is because NTFS does
not allow deletion of objects within a directory without a Delete
Sub-folders and Files permission on the directory (or a Delete
permission on the object itself), while in POSIX, &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; on the
directory is sufficient to delete any file or directory within it
(except when the sticky-flag is set on the directory). Thus, on
directories, the NTFS-equivalent to POSIX <code>gperms</code> set to
&lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; is &lsquo;<samp><span class="samp">rwx(D)</span></samp>&rsquo;. However, for files, &lsquo;<samp><span class="samp">rwx</span></samp>&rsquo; is
equivalent in POSIX and NTFS semantics.

   <p>In POSIX ACLs, there is no explicit delete permission, but the
execute, write and sticky permissions on the containing directory
determines if a user has privileges to delete. In POSIX, the owner and
root can change permissions, while usually only the root may change
the ownership, so there is no direct equivalent to the Change
Permission and Take Ownership in POSIX.

   <p><b>Further reading</b>
A description of the fourteen NTFS permission and the mapping of these
into sets is given at <a href="http://support.microsoft.com/kb/308419">http://support.microsoft.com/kb/308419</a>.

<h4 class="subsection">11.5.3 NT ACL examples</h4>

<pre class="verbatim">body common control
{
bundlesequence => { "acls" };
}

bundle agent acls
{
files:

  "C:\Program Files\Secret Program"
    acl => restrictive;

  "D:\Shared"
    acl => sharespace;
}

body acl restrictive
{
acl_type => "ntfs";
acl_method => "overwrite";
acl_directory_inherit => "parent";
aces => {"user:Administrator:r"};
}

body acl sharespace
{
acl_type => "ntfs";
acl_method => "overwrite";
acl_directory_inherit => "specify";
aces => { "user:Administrator:rwx(dDco)",
          "group:Hackers:rwx(dDco):deny",
          "all:rw" };
specify_inherit_aces => {"user:Administrator:r"};
}
</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Server-extensions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Upgrading-CFEngine-Enterprise">Upgrading CFEngine Enterprise</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#File-Access-Control-Lists">File Access Control Lists</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">12 Server extensions</h2>

<p>CFEngine Enterprise adds a simple server extension to the Community Edition
server, namely the ability to encode data directly in policy. 
This feature is useful for distributing password hashes
to systems.

<ul class="menu">
<li><a accesskey="1" href="#Server-access-resource-type">Server access resource type</a>
<li><a accesskey="2" href="#Function-remotescalar">Function remotescalar</a>
<li><a accesskey="3" href="#Example-remote-scalar-lookup">Example remote scalar lookup</a>
</ul>

<div class="node">
<a name="Server-access-resource-type"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-remotescalar">Function remotescalar</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-extensions">Server extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">12.1 Server access resource type</h3>

<p>By default, access to resources granted by the server are
files. However, sometimes it is useful to cache <code>literal</code>
strings, hints and data in the server, e.g. the contents of variables,
hashed passwords etc for easy access. In the case of literal data, the
promise handle serves as the reference identifier for queries. Queries
are instigated by function calls by any agent.

<pre class="verbatim">access:

  "This is a string with a $(localvar) for remote collection"

        handle  => "test_scalar",
  resource_type => "literal",
        admit   => { "127.0.0.1" };

</pre>

   <p>The promise looks exactly like a promise for a file object, but the data
are literal and entered into the policy. This is a useful approach for
distributing password hashes on a need-to-know basis from a central location. 
The server configuration file need not be distributed to any client, thus
only authorized systems will have access to the hashes.

<div class="node">
<a name="Function-remotescalar"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Example-remote-scalar-lookup">Example remote scalar lookup</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-access-resource-type">Server access resource type</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">12.2 Function <code>remotescalar</code></h3>

<p>The client side of the literal look up function is:

   <p><table class="cartouche" summary="cartouche" border="1"><tr><td>
<pre class="example">     
     (string) remotescalar(<var>resource handle</var>,<var>host/IP address</var>,<var>encrypt</var>);
     
</pre>
   </td></tr></table>

   <p>This function downloads a string from a remote server, using the promise handle
as a variable identifier.

<p class="noindent"><b>ARGUMENTS</b>:

     <dl>
<dt>&lsquo;<samp><span class="samp">resource handle</span></samp>&rsquo;<dd>The name of the promise on the server side
<br><dt>&lsquo;<samp><span class="samp">host or IP address</span></samp>&rsquo;<dd>The location of the server on which the resource resides. 
<br><dt>&lsquo;<samp><span class="samp">encrypt</span></samp>&rsquo;<dd>Whether to encrypt the connection to the server.
     <pre class="smallexample">               true
               yes
               false
               no
</pre>
     </dl>

<div class="node">
<a name="Example-remote-scalar-lookup"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-remotescalar">Function remotescalar</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Server-extensions">Server extensions</a>

</div>

<h3 class="section">12.3 Example remote scalar lookup</h3>

<pre class="verbatim">########################################################
#
# Remote value from server connection to cf-serverd
#
########################################################

body common control

{
bundlesequence  => { "testbundle"  };

version => "1.2.3";
}

########################################################

bundle agent testbundle

{
vars:

 "remote" string => remotescalar("test_scalar","127.0.0.1","yes");

reports:

  linux::

    "Receive value $(remote)";
}

#########################################################
# Server config
#########################################################

body server control

{
allowconnects         => { "127.0.0.1" , "::1" };
allowallconnects      => { "127.0.0.1" , "::1" };
trustkeysfrom         => { "127.0.0.1" , "::1" };
allowusers            => { "mark" };
}

#########################################################

bundle server access_rules()

{
vars:

  "localvar" string => "literal string";

access:

  "This is a $(localvar) for remote access"

        handle  => "test_scalar",
  resource_type => "literal",
        admit   => { "127.0.0.1" };
}

</pre>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Upgrading-CFEngine-Enterprise"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Server-extensions">Server extensions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">13 Upgrading CFEngine Enterprise</h2>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Please see INSTALLATION.TXT for how to upgrade (found on the CFEngine software download page)
</td></tr></table>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Frequently-Asked-Questions"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Troubleshooting">Troubleshooting</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Upgrading-CFEngine-Enterprise">Upgrading CFEngine Enterprise</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">14 Frequently Asked Questions</h2>

<ul class="menu">
<li><a accesskey="1" href="#How-do-I-install-the-prerequisites-for-the-hub-manually_003f">How do I install the prerequisites for the hub manually?</a>
<li><a accesskey="2" href="#I-did-bootstrap-the-hub-before-obtaining-a-license-file-_002d-what-should-I-do_003f">I did bootstrap the hub before obtaining a license file - what should I do?</a>
</ul>

<!--  -->
<div class="node">
<a name="How-do-I-install-the-prerequisites-for-the-hub-manually%3f"></a>
<a name="How-do-I-install-the-prerequisites-for-the-hub-manually_003f"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#I-did-bootstrap-the-hub-before-obtaining-a-license-file-_002d-what-should-I-do_003f">I did bootstrap the hub before obtaining a license file - what should I do?</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>

</div>

<h3 class="section">14.1 How do I install the prerequisites for the hub manually?</h3>

<p>See INSTALLATION.TXT for a list of dependencies for the hub (found on the CFEngine software download page):
     <dl>
<dt><i>Commercial customers</i><dd><a href="https://cfengine.com/software/">https://cfengine.com/software/</a>
<br><dt><i>CFEngine Free Enterprise</i><dd><a href="https://cfengine.com/enterprise-download/packages">https://cfengine.com/enterprise-download/packages</a>
</dl>

   <p>To install the packages you might want to use <code>yum</code> on Red Hat/CentOS/Fedora,
<code>zypper</code> on SUSE or <code>apt</code> on Debian/Ubuntu.

<!--  -->
<div class="node">
<a name="I-did-bootstrap-the-hub-before-obtaining-a-license-file---what-should-I-do%3f"></a>
<a name="I-did-bootstrap-the-hub-before-obtaining-a-license-file-_002d-what-should-I-do_003f"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#How-do-I-install-the-prerequisites-for-the-hub-manually_003f">How do I install the prerequisites for the hub manually?</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>

</div>

<h3 class="section">14.2 I did bootstrap the hub <em>before</em> obtaining a license file - what should I do?</h3>

<p>Four steps need to be followed to correct this minor issue.
     <ol type=1 start=1>
<li>obtain a working license file and copy it to <samp><span class="file">/var/cfengine/masterfiles</span></samp>
<pre class="verbatim">      hub # cp /tmp/license.dat /var/cfengine/masterfiles
</pre>
<li>killall CFEngine running processes
<pre class="verbatim">      hub # killall cf-execd cf-serverd cf-monitord cf-hub
</pre>
<li>wipe out <samp><span class="file">/var/cfengine/inputs </span></samp>
<pre class="verbatim">      hub # rm -rf /var/cfengine/inputs
</pre>
<li>bootstrap the policy hub
<pre class="verbatim">      hub # /var/cfengine/bin/cf-agent --bootstrap --policy-server 123.456.789.123
</pre>
        </ol>

<!-- ***************************************************** -->
<!-- * CHAPTER -->
<!-- ***************************************************** -->
<div class="node">
<a name="Troubleshooting"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configuration-of-external-authentication">Configuration of external authentication</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Frequently-Asked-Questions">Frequently Asked Questions</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="chapter">15 Troubleshooting</h2>

<ul class="menu">
<li><a accesskey="1" href="#Problems-bootstrapping">Problems bootstrapping</a>
<li><a accesskey="2" href="#Mission-Portal-Logs">Mission Portal Logs</a>
<li><a accesskey="3" href="#Apache-HTTP-error_005flog-is-your-friend">Apache HTTP error_log is your friend</a>
<li><a accesskey="4" href="#Some-report-pages-return-HTTP-error-404">Some report pages return HTTP error 404</a>
<li><a accesskey="5" href="#CFEngine-processes-are-running-but-I-cannot-connect-to-the-Mission-Portal-web-page">CFEngine processes are running but I cannot connect to the Mission Portal web page</a>
<li><a accesskey="6" href="#First-time-login-to-Mission-Portal-fails">First time login to Mission Portal fails</a>
<li><a accesskey="7" href="#Cannot-send-emails-from-the-Mission-Portal">Cannot send emails from the Mission Portal</a>
<li><a accesskey="8" href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">Warning messages on web pages in SLES/OpenSuSE Hub</a>
<li><a accesskey="9" href="#Knowledge-map-remains-unpopulated">Knowledge map remains unpopulated</a>
<li><a href="#I-get-a-promise-failed-with-the-message-_0022Can_0027t-stat-_002fvar_002fcfengine_002fmaster_005fsoftware_005fupdates_002fSOME_002dOS_0022-on-some-hosts">I get a promise failed with the message "Can't stat /var/cfengine/master_software_updates/SOME-OS" on some hosts</a>
<li><a href="#I-get-messages-of-connection-failures-to-a-database-on-my-hub">I get messages of connection failures to a database on my hub</a>
</ul>

<!--  -->
<div class="node">
<a name="Problems-bootstrapping"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Mission-Portal-Logs">Mission Portal Logs</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Troubleshooting">Troubleshooting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.1 Problems bootstrapping</h3>

<p>The most common problems with bootstrapping are related to:

     <dl>
<dt><i>Firewall</i><dd>Make sure port 5308 is open for both incoming and outgoing traffic. 
<br><dt><i>Policy access control list (acl)</i><dd>By default, the hub is available to clients that reside in the same class B network. If some clients are not part of that network, make sure the IPs are added to the acl in <samp><span class="file">/var/cfengine/masterfiles/def.cf</span></samp>, <code>bundle common def</code>:
<pre class="verbatim">      "acl" slist => {
     
                # Assume /16 LAN clients to start with 
                 "$(sys.policy_hub)/16",
                # Add clients' IP addresses (or IP range) here (for
                # example: an acl of 192.168.0.0/16 would allow all
                # clients that have an IP address that starts with 
                # 192.168 to connect to the hub)
</pre>
<br><dt><i>cf-serverd is not running on the hub</i><dd>The CFEngine component <code>cf-serverd</code> takes care of all CFEngine communication. It can take a few minutes after you bootstrapped the hub to itself before this component is started, just wait a bit and retry. 
</dl>

<!--  -->
<div class="node">
<a name="Mission-Portal-Logs"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Apache-HTTP-error_005flog-is-your-friend">Apache HTTP error_log is your friend</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Problems-bootstrapping">Problems bootstrapping</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.2 Mission Portal Logs</h3>

<p>The Mission Portal will log php errors, errors related to the configuration of external authentication (LDAP/Active Directory) and occurrences of the fall-back solution if external authentication fails. The log can be found in DOCROOT/application/logs (i.e. <code>/var/www/application/logs</code> for Ubuntu and <code>/var/www/html/application/logs</code> for Red Hat). The logs folder must be writable by apache, i.e. by 'www-data' user.

<!--  -->
<div class="node">
<a name="Apache-HTTP-error_log-is-your-friend"></a>
<a name="Apache-HTTP-error_005flog-is-your-friend"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Some-report-pages-return-HTTP-error-404">Some report pages return HTTP error 404</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Mission-Portal-Logs">Mission Portal Logs</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.3 Apache HTTP error_log is your friend</h3>

<p>The first place to diagnose (if all CFEngine processes and mongod are up and running) is:<br>
<i>RHEL 5,6 / CentOS 5</i>
<pre class="verbatim">   /var/log/httpd/error_log
</pre>
<i>SLES 11 / OpenSuSE 11 / Debian 5,6 / Ubuntu 8,10</i>
<pre class="verbatim">   /var/log/apache2/error_log
</pre>

<p class="noindent">This log file will often provide useful information on which components are not operating properly.

<!--  -->
<div class="node">
<a name="Some-report-pages-return-HTTP-error-404"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#CFEngine-processes-are-running-but-I-cannot-connect-to-the-Mission-Portal-web-page">CFEngine processes are running but I cannot connect to the Mission Portal web page</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Apache-HTTP-error_005flog-is-your-friend">Apache HTTP error_log is your friend</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.4 Some report pages return HTTP error 404</h3>

<p>Confirm that Apache REWRITE module is ON. Restarting httpd/apache2 service is required if rewrite was disabled.

<!--  -->
<div class="node">
<a name="CFEngine-processes-are-running-but-I-cannot-connect-to-the-Mission-Portal-web-page"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#First-time-login-to-Mission-Portal-fails">First time login to Mission Portal fails</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Some-report-pages-return-HTTP-error-404">Some report pages return HTTP error 404</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.5 CFEngine processes are running but I cannot connect to the Mission Portal web page</h3>

<p>There can be several reasons for this, please check the following:

     <ul>
<li>Check that apache is running (the process should appear in the list when you run this command):
<pre class="verbatim">        $ ps waux | grep apache
</pre>

     <li>Ensure that port 80 is open on the hub and not blocked by a firewall (the following telenet connection should succeed):
<pre class="verbatim">        $ telnet &lt;IP-ADDRESS> 80
</pre>

     <li>Check that there are no problems with php-mod by looking for error messages in the httpd error log or apache_error log. 
</ul>

<!--  -->
<div class="node">
<a name="First-time-login-to-Mission-Portal-fails"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Cannot-send-emails-from-the-Mission-Portal">Cannot send emails from the Mission Portal</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#CFEngine-processes-are-running-but-I-cannot-connect-to-the-Mission-Portal-web-page">CFEngine processes are running but I cannot connect to the Mission Portal web page</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.6 First time login to Mission Portal fails</h3>

<p>MongoDB needs to be initialized for authentication of the default user. Run the following command (line has been split and indented for presentability):
   <pre class="sp">

</pre>
<pre class="verbatim">   $ /var/cfengine/bin/mongo phpcfengine 
	/var/cfengine/share/GUI/phpcfenginenova/export.js
</pre>
   <pre class="sp">

</pre>
Default user name and password on the Mission Portal login page are 'admin' and 'admin'.

<!--  -->
<div class="node">
<a name="Cannot-send-emails-from-the-Mission-Portal"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">Warning messages on web pages in SLES/OpenSuSE Hub</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#First-time-login-to-Mission-Portal-fails">First time login to Mission Portal fails</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.7 Cannot send emails from the Mission Portal</h3>

<p>The default email address used by the system is "admin@cfengine.com". To change this, edit <samp><span class="file">application/config/ion_auth.php</span></samp> at the line containing:
<pre class="verbatim">   $config['admin_email'] = "admin@cfengine.com";
</pre>

<!--  -->
<div class="node">
<a name="Warning-messages-on-web-pages-in-SLES%2fOpenSuSE-Hub"></a>
<a name="Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Knowledge-map-remains-unpopulated">Knowledge map remains unpopulated</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Cannot-send-emails-from-the-Mission-Portal">Cannot send emails from the Mission Portal</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.8 Warning messages on web pages in SLES/OpenSuSE Hub</h3>

<p>Warnings appear because the default environment is set to "Development" and in this context the Mission Portal will show all php errors to the user. Set the environment to "Production" to silence these warnings, they will still be logged in Apache Error_log. To edit the default environment, visit "index.php" in your default web root directory and change the following line to suit your needs:
<pre class="verbatim">   define('ENVIRONMENT', 'Development');
</pre>

<!--  -->
<div class="node">
<a name="Knowledge-map-remains-unpopulated"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#I-get-a-promise-failed-with-the-message-_0022Can_0027t-stat-_002fvar_002fcfengine_002fmaster_005fsoftware_005fupdates_002fSOME_002dOS_0022-on-some-hosts">I get a promise failed with the message &quot;Can't stat /var/cfengine/master_software_updates/SOME-OS&quot; on some hosts</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">Warning messages on web pages in SLES/OpenSuSE Hub</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.9 Knowledge map remains unpopulated</h3>

<p>Try building the Knowledge map manually:<br>
   <i>RHEL 5 / CentOS 5</i>
<pre class="verbatim">   $ /var/cfengine/bin/cf-promises -r &amp;&amp; /var/cfengine/bin/cf-know -f 
       /var/www/html/docs/enterprise_build.cf -b
</pre>
   <i>SLES 11 / OpenSuSE 11</i>
<pre class="verbatim">   $ /var/cfengine/bin/cf-promises -r &amp;&amp; /var/cfengine/bin/cf-know -f 
       /srv/www/htdocs/docs/enterprise_build.cf -b
</pre>
   <i>Debian 5,6 / Ubuntu 8,10</i>
<pre class="verbatim">   $ /var/cfengine/bin/cf-promises -r &amp;&amp; /var/cfengine/bin/cf-know -f 
       /srv/www/htdocs/docs/enterprise_build.cf -b
</pre>

<!--  -->
<div class="node">
<a name="I-get-a-promise-failed-with-the-message-%22Can't-stat-%2fvar%2fcfengine%2fmaster_software_updates%2fSOME-OS%22-on-some-hosts"></a>
<a name="I-get-a-promise-failed-with-the-message-_0022Can_0027t-stat-_002fvar_002fcfengine_002fmaster_005fsoftware_005fupdates_002fSOME_002dOS_0022-on-some-hosts"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#I-get-messages-of-connection-failures-to-a-database-on-my-hub">I get messages of connection failures to a database on my hub</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Knowledge-map-remains-unpopulated">Knowledge map remains unpopulated</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.10 I get a promise failed with the message <code>Can't stat /var/cfengine/master_software_updates/SOME-OS</code> on some hosts</h3>

<p>There is a built-in promise to automatically upgrade the CFEngine Enterprise
binaries. By default, the clients will check for an update package
every time CFEngine Enterprise runs. So if the clients find that there is no source
directory to download the files from, the message will be displayed.

   <p>To fix the problem, simply create an empty directory mentioned in the
message on the hub.
<pre class="verbatim"> hub # mkdir /var/cfengine/master_software_updates/SOME-OS
</pre>

<!--  -->
<div class="node">
<a name="I-get-messages-of-connection-failures-to-a-database-on-my-hub"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#I-get-a-promise-failed-with-the-message-_0022Can_0027t-stat-_002fvar_002fcfengine_002fmaster_005fsoftware_005fupdates_002fSOME_002dOS_0022-on-some-hosts">I get a promise failed with the message &quot;Can't stat /var/cfengine/master_software_updates/SOME-OS&quot; on some hosts</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Troubleshooting">Troubleshooting</a>

</div>

<h3 class="section">15.11 I get messages of connection failures to a database on my hub</h3>

<p>For example, in <code>messages</code>, I can see something like <code>!! Could not open connection to report database for saving</code>. What should I do?

   <p>This message comes from the <code>cf-hub</code> process. It is responsible
for pulling reports from hosts that have contacted the hub to get
policy updates. When these reports are fetched, they are stored in a local MongoDB database on the hub. This message is produced when there is a failure in the connection to the database.

   <p>Probably, the issue is that the database server is not running on your
hub. Run the <code>ps</code>-command to check this.
<pre class="verbatim"> hub # ps -e | grep mongod
</pre>

   <p>If the <code>mongod</code> process <em>is</em> running, it must be
misconfigured or in some bad state. Please look at the newest entry in
<samp><span class="file">/var/log/mongod.log</span></samp> to diagnose the problem, and contact
CFEngine Technical Support if necessary.

   <p>If the <code>mongod</code> process <em>is not</em> running, please follow the
steps below.

     <ol type=1 start=1>
<li>Run
  hub # <code>/var/cfengine/bin/cf-twin -Kvf failsafe.cf &gt; /tmp/cfout</code>
<li>Check again if the <code>mongod</code> is running, if so, the problem
is probably fixed now. 
<li>If <code>mongod</code> is still not running, please search the output
file for lines starting as follows.

     <pre class="verbatim">     ...
     nova>  -> Making a one-time restart promise for mongod
     ...
     ...
     nova>  -> Executing '/var/cfengine/bin/mongod....
     nova>  -> Backgrounding job /var/cfengine/bin/mongod...
     nova>  -> Completed execution of /var/cfengine/bin/mongod...
     ...
</pre>

     <p>If you don't see the first line above, CFEngine Enterprise does not try to start
<code>mongod</code> &mdash; so check if you bootstrapped your hub correctly. If
you see all lines, it means that CFEngine Enterprise starts <code>mongod</code>, but the process just
terminates immediately after. If so, continue to the next step.

     <li>Look at the newest entry in <samp><span class="file">/var/log/mongod.log</span></samp>. It
should give you more details of why the <code>mongod</code> process refuses
to start. The two most common scenarios are described next.

     <li>If <code>mongod</code> has been terminated unexpectedly, it might have
left a lock-file behind that stops it from starting again. Try
deleting <samp><span class="file">/var/cfengine/state/mongod.lock</span></samp> if it exists.

     <li>If the database is corrupted, you can have <samp><span class="file">mongod</span></samp> create a new one by moving
<samp><span class="file">/var/cfengine/state/cf-report.*</span></samp> out of the way. There are also
tools and documentation for repairing a database at
<a href="http://www.mongodb.org/">http://www.mongodb.org/</a>.

     <p>Note that almost all of the <code>cfreport</code> database is recreated with data collected from clients. This happens every 5 minutes or 6 hours (depending on the probe), you may consider whether deleting the database is an acceptable solution. CFEngine AS or CFEngine Inc can not be held responsible for data loss in this respect.
        </ol>

<!-- ***************************************************** -->
<!-- * APPENDIX A -->
<!-- ***************************************************** -->
<div class="node">
<a name="Configuration-of-external-authentication"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#SQLite-Database-Schema">SQLite Database Schema</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Troubleshooting">Troubleshooting</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix A Configuration of external authentication</h2>

<p>External authentication is available for CFEngine 3 Nova 2.1 and later versions, but by default the Mission Portal will use the embedded database to store user information (default user name and password on the Mission Portal login page are "admin" and "admin"). Note that users in the default database will be locked out of the Mission Portal upon configuration of external authentication. They will regain access if external authentication is deactivated by selecting the Database button on the Mission Portal Settings page (see below).

   <p>To enable external authentication on a fresh install, log on to the Mission Portal with the default user and password and go to <a href="#Settings">Settings</a>). Click "Mission Portal Settings" and enter the appropriate configuration for LDAP or Active Directory as described below. Note that the actual setup of LDAP or Active Directory (definition of users, directory hierarchy, etc.) has to be done independently and is not covered in this document.

<ul class="menu">
<li><a accesskey="1" href="#Configure-LDAP">Configure LDAP</a>
<li><a accesskey="2" href="#Configure-Active-Directory">Configure Active Directory</a>
</ul>

<!--  -->
<div class="node">
<a name="Configure-LDAP"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Configure-Active-Directory">Configure Active Directory</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configuration-of-external-authentication">Configuration of external authentication</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration-of-external-authentication">Configuration of external authentication</a>

</div>

<h3 class="section">A.1 Configure LDAP</h3>

<p>Select the LDAP button and enter the appropriate configuration settings for your system.

   <pre class="sp">

</pre>
<div align="center"><img src="img-config-ldap-3-0.png" alt="Configure LDAP"></div>
<div align="center">Figure: Configure LDAP</div>
   <pre class="sp">

</pre>

Form fields:

     <ul>
<li>LDAP host: Address of the LDAP machine
<li>Base dn: LDAP root, the top entry (starting point) in the directory
<li>Login attribute: Field name used to match user name, e.g. uid. 
<li>User directory: Directory name where user names are stored, e.g. cn=users or ou=people
<li>Encryption: Chose the encryption protocol to be used for authentication
<li>LDAP user name: Enter the LDAP user name of the person that is supposed to have admin rights
<li>LDAP password: Enter the LDAP password of the above user
</ul>

   <p>If you wish to use RBAC in combination with external authentication, we recommend that you wait to turn on RBAC until you log on with the LDAP user that has been designated a Mission Portal admin (i.e do not turn RBAC on while logged on with an internal database user in this case).

<!--  -->
<div class="node">
<a name="Configure-Active-Directory"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configure-LDAP">Configure LDAP</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Configuration-of-external-authentication">Configuration of external authentication</a>

</div>

<h3 class="section">A.2 Configure Active Directory</h3>

<p>Select the Active Directory button and enter the appropriate configuration settings for you system.

   <pre class="sp">

</pre>
<div align="center"><img src="img-config-active-directory-3-0.png" alt="Configure Active Directory"></div>
<div align="center">Figure: Configure Active Directory</div>
   <pre class="sp">

</pre>

Form fields:

     <ul>
<li>LDAP host: Address of the Active Directory machine
<li>Base dn: LDAP root, the top entry (starting point) in the directory
<li>Login attribute: Field name used to match user name, e.g. uid. 
<li>User directory: Directory name where user names are stored, e.g. cn=users or ou=people
<li>Active directory domain: Field name used to match directory domain on Windows machines, e.g. windows1.test.cfengine.com
<li>Encryption: Chose the encryption protocol to be used for authentication
<li>LDAP user name: Enter the LDAP user name of the person that is supposed to have admin rights
<li>LDAP password: Enter the LDAP password of the above user
</ul>

   <p>If you wish to use RBAC in combination with external authentication, we recommend that you wait to turn on RBAC until you log on with the AD user that has been designated a Mission Portal admin (i.e do not turn RBAC on while logged on with an internal database user in this case).

<!-- ***************************************************** -->
<!-- * APPENDIX B -->
<!-- ***************************************************** -->
<div class="node">
<a name="SQLite-Database-Schema"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Configuration-of-external-authentication">Configuration of external authentication</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<h2 class="appendix">Appendix B SQLite Database Schema</h2>

<p>The following figure shows the database schema used in the <i>SQL Reports App</i> (<a href="#SQL-Reports-App">SQL Reports App</a>):

   <pre class="sp">

</pre>
<div align="center"><img src="img-sql-db-schema-3-0.png" alt="SQLite Database Schema"></div>
<div align="center">Figure: SQLite Database Schema</div>
   <pre class="sp">

</pre>

<p><table class="cartouche" summary="cartouche" border="1"><tr><td>
Please note that any queries containing the PromiseDefinitions table in combination with any other table in the schema will produce erroneous output without an intermediate join to the PromiseStatusLast table. 
</td></tr></table>

<!-- ========================================================================= -->
<!-- @node Index,  , CFEngine Methods, Top -->
<!-- @unnumbered Concept Index -->
<!-- @printindex cp -->
<!-- ========================================================================= -->
   <p><a name="Contents">
   <div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">CFEngine Enterprise 3.0 Owner's Manual</a>
<li><a name="toc_Introduction" href="#Introduction">1 Introduction</a>
<ul>
<li><a href="#About-CFEngine-Enterprise">1.1 About CFEngine Enterprise</a>
</li></ul>
<li><a name="toc_Requirements" href="#Requirements">2 Requirements</a>
<ul>
<li><a href="#Hardware-requirements">2.1 Hardware requirements</a>
<li><a href="#Operating-system-support">2.2 Operating system support</a>
</li></ul>
<li><a name="toc_Installing-CFEngine-Enterprise" href="#Installing-CFEngine-Enterprise">3 Installing CFEngine Enterprise</a>
<ul>
<li><a href="#Installation-procedure">3.1 Installation procedure</a>
<li><a href="#How-to-assess-success-of-this-procedure">3.2 How to assess success of this procedure</a>
</li></ul>
<li><a name="toc_Quickstart-_002d-The-Mission-Portal" href="#Quickstart-_002d-The-Mission-Portal">4 Quickstart - The Mission Portal</a>
<ul>
<li><a href="#Hosts-App">4.1 Hosts App</a>
<ul>
<li><a href="#Policy-Context-Selector">4.1.1 Policy Context Selector</a>
<li><a href="#Navigation-Tree">4.1.2 Navigation Tree</a>
<li><a href="#Status-tab">4.1.3 Status tab</a>
<li><a href="#Reports-tab">4.1.4 Reports tab</a>
<li><a href="#Events-tab">4.1.5 Events tab</a>
<li><a href="#Vitals-tab">4.1.6 Vitals tab</a>
<li><a href="#Host-Info-tab">4.1.7 Host Info tab</a>
</li></ul>
<li><a href="#SQL-Reports-App">4.2 SQL Reports App</a>
<li><a href="#Docs-App">4.3 Docs App</a>
<li><a href="#Policies-App">4.4 Policies App</a>
<li><a href="#Knowledge-App">4.5 Knowledge App</a>
<li><a href="#User-Management">4.6 User Management</a>
<li><a href="#Settings">4.7 Settings</a>
<ul>
<li><a href="#Mission-Portal-Settings">4.7.1 Mission Portal Settings</a>
<li><a href="#Manage-Apps">4.7.2 Manage Apps</a>
<li><a href="#Hub-Replication-Status">4.7.3 Hub Replication Status</a>
<li><a href="#Host-Identifier">4.7.4 Host Identifier</a>
<li><a href="#Other-Settings">4.7.5 Other Settings</a>
</li></ul>
</li></ul>
<li><a name="toc_Role-Based-Access-Control-_0028RBAC_0029" href="#Role-Based-Access-Control-_0028RBAC_0029">5 Role Based Access Control (RBAC)</a>
<ul>
<li><a href="#Defining-Roles">5.1 Defining Roles</a>
<li><a href="#Entities-Filtered">5.2 Entities Filtered</a>
<li><a href="#Limitations">5.3 Limitations</a>
</li></ul>
<li><a name="toc_Virtualization-and-Cloud" href="#Virtualization-and-Cloud">6 Virtualization and Cloud</a>
<ul>
<li><a href="#What-are-virtualization-and-cloud-computing_003f">6.1 What are virtualization and cloud computing?</a>
<li><a href="#Why-build-virtualization-support-into-CFEngine_003f">6.2 Why build virtualization support into CFEngine?</a>
<li><a href="#What-can-CFEngine-do-with-virtual-machines_003f">6.3 What can CFEngine do with virtual machines?</a>
<li><a href="#Guest-environments-promises">6.4 Guest environments promises</a>
<li><a href="#Virtualization-types-supported">6.5 Virtualization types supported</a>
<li><a href="#Distinct-states">6.6 Distinct states</a>
<li><a href="#Example-deployment">6.7 Example deployment</a>
</li></ul>
<li><a name="toc_Windows_002dspecific-features-in-CFEngine-Enterprise" href="#Windows_002dspecific-features-in-CFEngine-Enterprise">7 Windows-specific features in CFEngine Enterprise</a>
<ul>
<li><a href="#Windows_002dspecific-features-in-CFEngine-Enterprise">7.1 Windows service management</a>
<li><a href="#Windows_002dspecific-features-in-CFEngine-Enterprise">7.2 Windows event logging</a>
<li><a href="#Windows_002dspecific-features-in-CFEngine-Enterprise">7.3 Windows special variables</a>
<li><a href="#Windows_002dspecific-features-in-CFEngine-Enterprise">7.4 Windows hard classes</a>
<li><a href="#Windows_002dspecific-features-in-CFEngine-Enterprise">7.5 Notes on windows policies</a>
</li></ul>
<li><a name="toc_REST-API" href="#REST-API">8 REST API</a>
<ul>
<li><a href="#Basic-Properties-of-the-API">8.1 Basic Properties of the API</a>
<ul>
<li><a href="#HTTP-_002b-JSON">8.1.1 HTTP + JSON</a>
<li><a href="#Requests">8.1.2 Requests</a>
<li><a href="#Responses">8.1.3 Responses</a>
<li><a href="#Pagination">8.1.4 Pagination</a>
<li><a href="#Time">8.1.5 Time</a>
<li><a href="#Authentication">8.1.6 Authentication</a>
<li><a href="#Authorization">8.1.7 Authorization</a>
</li></ul>
<li><a href="#Differences-between-the-CFEngine-Nova-2_002e2-REST-API-and-the-CFEngine-Enterprise-3_002e0-API">8.2 Differences between the CFEngine Nova 2.2 REST API and the CFEngine Enterprise 3.0 API</a>
<ul>
<li><a href="#Read-vs_002e-Read_002fWrite">8.2.1 Read vs. Read/Write</a>
<li><a href="#Built_002din-Reports-vs_002e-Reporting-Engine">8.2.2 Built-in Reports vs. Reporting Engine</a>
<li><a href="#Content_002dType">8.2.3 Content-Type</a>
<li><a href="#New-Users">8.2.4 New Users</a>
<li><a href="#Base-Path">8.2.5 Base Path</a>
<li><a href="#Still-available">8.2.6 Still available</a>
<li><a href="#Mission-Portal">8.2.7 Mission Portal</a>
</li></ul>
<li><a href="#Checking-Status">8.3 Checking Status</a>
<li><a href="#Managing-Settings">8.4 Managing Settings</a>
<ul>
<li><a href="#Viewing-settings">8.4.1 Viewing settings</a>
<li><a href="#Example-_002d-Configuring-LDAP">8.4.2 Example: Configuring LDAP</a>
<li><a href="#Example-_002d-Configuring-Active-Directory">8.4.3 Example: Configuring Active Directory</a>
<li><a href="#Example-_002d-Changing-The-Log-Level">8.4.4 Example: Changing The Log Level</a>
</li></ul>
<li><a href="#Managing-Users-and-Roles">8.5 Managing Users and Roles</a>
<ul>
<li><a href="#Example-_002d-Listing-Users">8.5.1 Example: Listing Users</a>
<li><a href="#Example-_002d-Creating-a-New-User">8.5.2 Example: Creating a New User</a>
<li><a href="#Example-_002d-Updating-an-Existing-User">8.5.3 Example: Updating an Existing User</a>
<li><a href="#Example-_002d-Retrieving-a-User">8.5.4 Example: Retrieving a User</a>
<li><a href="#Example-_002d-Adding-a-User-to-a-Role">8.5.5 Example: Adding a User to a Role</a>
<li><a href="#Example-_002d-Deleting-a-User">8.5.6 Example: Deleting a User</a>
<li><a href="#Example-_002d-Creating-a-New-Role">8.5.7 Example: Creating a New Role</a>
</li></ul>
<li><a href="#Browsing-Host-Information">8.6 Browsing Host Information</a>
<ul>
<li><a href="#Example-_002d-Listing-Hosts-With-A-Given-Context">8.6.1 Example: Listing Hosts With A Given Context</a>
<li><a href="#Example-_002d-Looking-Up-Hosts-By-Hostname">8.6.2 Example: Looking Up Hosts By Hostname</a>
<li><a href="#Example-_002d-Looking-Up-Hosts-By-IP">8.6.3 Example: Looking Up Hosts By IP</a>
<li><a href="#Example-_002d-Removing-Host-Data">8.6.4 Example: Removing Host Data</a>
<li><a href="#Example-_002d-Listing-Available-Vital-Signs-For-A-Host">8.6.5 Example: Listing Available Vital Signs For A Host</a>
<li><a href="#Example-_002d-Retrieving-Vital-Sign-Data">8.6.6 Example: Retrieving Vital Sign Data</a>
</li></ul>
<li><a href="#SQL-Queries">8.7 SQL Queries</a>
<ul>
<li><a href="#Synchronous-Queries">8.7.1 Synchronous Queries</a>
<ul>
<li><a href="#Synchronous-Queries">8.7.1.1 Example: Listing Hostname and IP for Ubuntu Hosts</a>
</li></ul>
<li><a href="#Asynchronous-Queries">8.7.2 Asynchronous Queries</a>
<ul>
<li><a href="#Asynchronous-Queries">8.7.2.1 Issuing The Query</a>
<li><a href="#Asynchronous-Queries">8.7.2.2 Checking Status</a>
<li><a href="#Asynchronous-Queries">8.7.2.3 Getting The Completed Report</a>
</li></ul>
<li><a href="#Subscribed-Queries">8.7.3 Subscribed Queries</a>
<ul>
<li><a href="#Subscribed-Queries">8.7.3.1 Example: Creating A Subscribed Query</a>
<li><a href="#Subscribed-Queries">8.7.3.2 Example: Listing Report Subscriptions</a>
<li><a href="#Subscribed-Queries">8.7.3.3 Example: Removing A Report Subscription</a>
</li></ul>
</li></ul>
<li><a href="#API-Reference">8.8 API Reference</a>
<ul>
<li><a href="#_002fapi">8.8.1 /api</a>
<li><a href="#_002fapi_002fsettings">8.8.2 /api/settings</a>
<li><a href="#_002fapi_002fuser">8.8.3 /api/user</a>
<li><a href="#_002fapi_002fuser_002fid">8.8.4 /api/user/:id</a>
<li><a href="#_002fapi_002frole">8.8.5 /api/role</a>
<li><a href="#_002fapi_002frole_002fid">8.8.6 /api/role/:id</a>
<li><a href="#_002fapi_002fhost">8.8.7 /api/host</a>
<li><a href="#_002fapi_002fhost_002fhost_002did">8.8.8 /api/host/:host-id</a>
<li><a href="#_002fapi_002fhost_002fhost_002did_002fcontext">8.8.9 /api/host/:host-id/context</a>
<li><a href="#_002fapi_002fhost_002fhost_002did_002fcontext_002fcontext_002did">8.8.10 /api/host/:host-id/context/:context-id</a>
<li><a href="#_002fapi_002fhost_002fhost_002did_002fvital">8.8.11 /api/host/:host-id/vital</a>
<ul>
<li><a href="#_002fapi_002fhost_002fhost_002did_002fvital">8.8.11.1 /api/host/:host-id/vital/:vital-id</a>
</li></ul>
<li><a href="#_002fapi_002fpromise">8.8.12 /api/promise</a>
<li><a href="#_002fapi_002fpromise_002fpromise_002did">8.8.13 /api/promise/:promise-id</a>
<li><a href="#_002fapi_002fquery">8.8.14 /api/query</a>
<li><a href="#_002fapi_002fquery_002fasync">8.8.15 /api/query/async</a>
<li><a href="#_002fapi_002fquery_002fasync_002fasync_002dquery_002did">8.8.16 /api/query/async/:async-query-id</a>
</li></ul>
</li></ul>
<li><a name="toc_Call_002dCollect" href="#Call_002dCollect">9 Call-Collect</a>
<li><a name="toc_Monitoring-extensions" href="#Monitoring-extensions">10 Monitoring extensions</a>
<ul>
<li><a href="#Vital-Signs-Time-Series">10.1 Vital Signs Time Series</a>
<li><a href="#Long-term-trends">10.2 Long term trends</a>
<li><a href="#Custom-promises-to-measure">10.3 Custom promises to measure</a>
<ul>
<li><a href="#Extraction-strings-and-logging">10.3.1 Extraction strings and logging</a>
<li><a href="#Extracting-one_002doff-numerical-data">10.3.2 Extracting one-off numerical data</a>
<li><a href="#Extraction-to-list-variable">10.3.3 Extraction to list variable</a>
</li></ul>
<li><a href="#Uses-for-custom-monitoring">10.4 Uses for custom monitoring</a>
</li></ul>
<li><a name="toc_File-Access-Control-Lists" href="#File-Access-Control-Lists">11 File Access Control Lists</a>
<ul>
<li><a href="#ACL-Introduction">11.1 ACL Introduction</a>
<li><a href="#File-ACL-example">11.2 File ACL example</a>
<ul>
<li><a href="#Concepts">11.2.1 Concepts</a>
<li><a href="#Entity-types">11.2.2 Entity types</a>
<li><a href="#Owners">11.2.3 Owners</a>
<li><a href="#Changing-owner">11.2.4 Changing owner</a>
<li><a href="#Permissions">11.2.5 Permissions</a>
<li><a href="#Deny-permissions">11.2.6 Deny permissions</a>
<li><a href="#Changing-permissions">11.2.7 Changing permissions</a>
<li><a href="#Effective-permissions">11.2.8 Effective permissions</a>
<li><a href="#Inheritance">11.2.9 Inheritance</a>
</li></ul>
<li><a href="#CFEngine-3-Generic-ACL-Syntax">11.3 CFEngine 3 Generic ACL Syntax</a>
<ul>
<li><a href="#Generic-syntax-examples">11.3.1 Generic syntax examples</a>
</li></ul>
<li><a href="#POSIX-ACL-type">11.4 POSIX ACL type</a>
<ul>
<li><a href="#POSIX_002dspecific-ACL-syntax">11.4.1 POSIX-specific ACL syntax</a>
<li><a href="#Generic-syntax-mapping">11.4.2 Generic syntax mapping</a>
<li><a href="#POSIX-ACL-examples">11.4.3 POSIX ACL examples</a>
</li></ul>
<li><a href="#NT-ACL-type">11.5 NT ACL type</a>
<ul>
<li><a href="#NT_002dspecific-ACL-syntax">11.5.1 NT-specific ACL syntax</a>
<li><a href="#NT_002dspecific-ACL-syntax">11.5.2 Generic syntax mapping</a>
<li><a href="#NT_002dspecific-ACL-syntax">11.5.3 NT ACL examples</a>
</li></ul>
</li></ul>
<li><a name="toc_Server-extensions" href="#Server-extensions">12 Server extensions</a>
<ul>
<li><a href="#Server-access-resource-type">12.1 Server access resource type</a>
<li><a href="#Function-remotescalar">12.2 Function <code>remotescalar</code></a>
<li><a href="#Example-remote-scalar-lookup">12.3 Example remote scalar lookup</a>
</li></ul>
<li><a name="toc_Upgrading-CFEngine-Enterprise" href="#Upgrading-CFEngine-Enterprise">13 Upgrading CFEngine Enterprise</a>
<li><a name="toc_Frequently-Asked-Questions" href="#Frequently-Asked-Questions">14 Frequently Asked Questions</a>
<ul>
<li><a href="#How-do-I-install-the-prerequisites-for-the-hub-manually_003f">14.1 How do I install the prerequisites for the hub manually?</a>
<li><a href="#I-did-bootstrap-the-hub-before-obtaining-a-license-file-_002d-what-should-I-do_003f">14.2 I did bootstrap the hub <em>before</em> obtaining a license file - what should I do?</a>
</li></ul>
<li><a name="toc_Troubleshooting" href="#Troubleshooting">15 Troubleshooting</a>
<ul>
<li><a href="#Problems-bootstrapping">15.1 Problems bootstrapping</a>
<li><a href="#Mission-Portal-Logs">15.2 Mission Portal Logs</a>
<li><a href="#Apache-HTTP-error_005flog-is-your-friend">15.3 Apache HTTP error_log is your friend</a>
<li><a href="#Some-report-pages-return-HTTP-error-404">15.4 Some report pages return HTTP error 404</a>
<li><a href="#CFEngine-processes-are-running-but-I-cannot-connect-to-the-Mission-Portal-web-page">15.5 CFEngine processes are running but I cannot connect to the Mission Portal web page</a>
<li><a href="#First-time-login-to-Mission-Portal-fails">15.6 First time login to Mission Portal fails</a>
<li><a href="#Cannot-send-emails-from-the-Mission-Portal">15.7 Cannot send emails from the Mission Portal</a>
<li><a href="#Warning-messages-on-web-pages-in-SLES_002fOpenSuSE-Hub">15.8 Warning messages on web pages in SLES/OpenSuSE Hub</a>
<li><a href="#Knowledge-map-remains-unpopulated">15.9 Knowledge map remains unpopulated</a>
<li><a href="#I-get-a-promise-failed-with-the-message-_0022Can_0027t-stat-_002fvar_002fcfengine_002fmaster_005fsoftware_005fupdates_002fSOME_002dOS_0022-on-some-hosts">15.10 I get a promise failed with the message <code>Can't stat /var/cfengine/master_software_updates/SOME-OS</code> on some hosts</a>
<li><a href="#I-get-messages-of-connection-failures-to-a-database-on-my-hub">15.11 I get messages of connection failures to a database on my hub</a>
</li></ul>
<li><a name="toc_Configuration-of-external-authentication" href="#Configuration-of-external-authentication">Appendix A Configuration of external authentication</a>
<ul>
<li><a href="#Configure-LDAP">A.1 Configure LDAP</a>
<li><a href="#Configure-Active-Directory">A.2 Configure Active Directory</a>
</li></ul>
<li><a name="toc_SQLite-Database-Schema" href="#SQLite-Database-Schema">Appendix B SQLite Database Schema</a>
</li></ul>
</div>



<!-- The file is structured like a programming language. Each chapter -->
<!-- starts with a chapter comment. -->
<!-- Menus list the subsections so that an online info-reader can parse -->
<!-- the file hierarchically. -->
   <p><script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-2576171-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>

   <div class="footnote">
<hr>
<a name="texinfo-footnotes-in-document"></a><h4>Footnotes</h4><p class="footnote"><small>[<a name="fn-1" href="#fnd-1">1</a>]</small> Major version 3</p>

   <p class="footnote"><small>[<a name="fn-2" href="#fnd-2">2</a>]</small> You will obtain credentials to the CFEngine Support ticketing system and software download repository as a part of your purchase.</p>

   <p class="footnote"><small>[<a name="fn-3" href="#fnd-3">3</a>]</small> You may have to wait as long as 30 minutes</p>

   <p class="footnote"><small>[<a name="fn-4" href="#fnd-4">4</a>]</small> Make sure to change the password to prevent unauthorized access; see also Appendix A on configuration of external authentication.</p>

   <p class="footnote"><small>[<a name="fn-5" href="#fnd-5">5</a>]</small> Blue or black hosts will not appear here</p>

   <p class="footnote"><small>[<a name="fn-6" href="#fnd-6">6</a>]</small> This is because hosts check in at different times and some hosts may not yet be accounted for at the time of generation of the graph.</p>

   <hr></div>

</body></html>

